<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

        <title>
            
    
    2.0 Changelog
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="../index.html" />
        <link rel="up" title="Changes and Migration" href="index.html" />
        <link rel="next" title="1.4 Changelog" href="changelog_14.html" />
        <link rel="prev" title="What’s New in SQLAlchemy 2.0?" href="whatsnew_20.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.0b2</span>


        | Release Date: October 20, 2022

    </div>

    <h1><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="Changes and Migration">Changes and Migration</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></span></li>
<li><span class="link-container"><a class="reference external" href="whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></span></li>
<li class="selected"><span class="link-container"><strong>2.0 Changelog</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2">2.0.0b2</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-orm-declarative">orm declarative</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b2-mssql">mssql</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1">2.0.0b1</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-general">general</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-platform">platform</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-mariadb">mariadb</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-sqlite">sqlite</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-oracle">oracle</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.0.0b1-misc">misc</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="changelog_14.html">1.4 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_13.html">1.3 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_12.html">1.2 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_11.html">1.1 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_10.html">1.0 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_09.html">0.9 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_08.html">0.8 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_07.html">0.7 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_06.html">0.6 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_05.html">0.5 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_04.html">0.4 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_03.html">0.3 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_02.html">0.2 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_01.html">0.1 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_14.html">What’s New in SQLAlchemy 1.4?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_13.html">What’s New in SQLAlchemy 1.3?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_12.html">What’s New in SQLAlchemy 1.2?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_11.html">What’s New in SQLAlchemy 1.1?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_10.html">What’s New in SQLAlchemy 1.0?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_09.html">What’s New in SQLAlchemy 0.9?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_08.html">What’s New in SQLAlchemy 0.8?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_07.html">What’s New in SQLAlchemy 0.7?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_06.html">What’s New in SQLAlchemy 0.6?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html">What’s new in SQLAlchemy 0.5?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_04.html">What’s new in SQLAlchemy 0.4?</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>
                <li><b>Previous:</b>
                <a href="whatsnew_20.html" title="previous chapter">What’s New in SQLAlchemy 2.0?</a></li>
                <li><b>Next:</b>
                <a href="changelog_14.html" title="next chapter">1.4 Changelog</a></li>

            <li><b>Up:</b> <a href="../index.html">Home</a></li>
                    <ul><li><a href="index.html" title="Changes and Migration">Changes and Migration</a></li>
                </ul>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#changelog">2.0 Changelog</a><ul>
<li><a class="reference internal" href="#change-2.0.0b2">2.0.0b2</a><ul>
<li><a class="reference internal" href="#change-2.0.0b2-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0b2-orm-declarative">orm declarative</a></li>
<li><a class="reference internal" href="#change-2.0.0b2-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.0b2-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0b2-mssql">mssql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-2.0.0b1">2.0.0b1</a><ul>
<li><a class="reference internal" href="#change-2.0.0b1-general">general</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-platform">platform</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-mariadb">mariadb</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-sqlite">sqlite</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-oracle">oracle</a></li>
<li><a class="reference internal" href="#change-2.0.0b1-misc">misc</a></li>
</ul>
</li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar changelog-changelog_20" >
        
<section id="changelog">
<h1>2.0 Changelog<a class="headerlink" href="#changelog" title="Permalink to this heading">¶</a></h1>
<section id="change-2.0.0b2">
<h2 class="release-version">2.0.0b2<a class="headerlink" href="#change-2.0.0b2" title="Permalink to this heading">¶</a></h2>
Released: October 20, 2022<section id="change-2.0.0b2-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0b2-orm" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-0"><span class="target" id="change-61e17d30f696859f761f6e77d0830efd"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-61e17d30f696859f761f6e77d0830efd">¶</a></span><p>Removed the warning that emits when using ORM-enabled update/delete
regarding evaluation of columns by name, first added in <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4073">#4073</a>;
this warning actually covers up a scenario that otherwise could populate
the wrong Python value for an ORM mapped attribute depending on what the
actual column is, so this deprecated case is removed. In 2.0, ORM enabled
update/delete uses “auto” for “synchronize_session”, which should do the
right thing automatically for any given UPDATE expression.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8656">#8656</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b2-orm-declarative">
<h3>orm declarative<a class="headerlink" href="#change-2.0.0b2-orm-declarative" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-1"><span class="target" id="change-df54ee51146a6453004f20ddc378fd4f"><strong>[orm] [declarative] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-df54ee51146a6453004f20ddc378fd4f">¶</a></span><p>Added support for mapped classes that are also <code class="docutils literal notranslate"><span class="pre">Generic</span></code> subclasses,
to be specified as a <code class="docutils literal notranslate"><span class="pre">GenericAlias</span></code> object (e.g. <code class="docutils literal notranslate"><span class="pre">MyClass[str]</span></code>)
within statements and calls to <a class="reference internal" href="../core/inspection.html#sqlalchemy.inspect" title="sqlalchemy.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8665">#8665</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-2"><span class="target" id="change-f337b60caf3808ff5627b5913d7a3394"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f337b60caf3808ff5627b5913d7a3394">¶</a></span><p>Improved the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase" title="sqlalchemy.orm.DeclarativeBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeBase</span></code></a> class so that when combined with
other mixins like <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a>, the order of the classes may
be in either order.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8665">#8665</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-3"><span class="target" id="change-3b9e5b143d9382865b1e0dc317bb4326"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3b9e5b143d9382865b1e0dc317bb4326">¶</a></span><p>Fixed bug in new ORM typed declarative mappings where the ability
to use <code class="docutils literal notranslate"><span class="pre">Optional[MyClass]</span></code> or similar forms such as <code class="docutils literal notranslate"><span class="pre">MyClass</span> <span class="pre">|</span> <span class="pre">None</span></code>
in the type annotation for a many-to-one relationship was not implemented,
leading to errors.   Documentation has also been added for this use
case to the relationship configuration documentation.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8668">#8668</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-4"><span class="target" id="change-4b0a7639e6298e796e977489add9fd1f"><strong>[orm] [declarative] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4b0a7639e6298e796e977489add9fd1f">¶</a></span><p>Fixed issue with new dataclass mapping feature where arguments passed to
the dataclasses API could sometimes be mis-ordered when dealing with mixins
that override <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> declarations, leading to
initializer problems.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8688">#8688</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b2-sql">
<h3>sql<a class="headerlink" href="#change-2.0.0b2-sql" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-5"><span class="target" id="change-bde0bffffdcd582dbcba03460b29c172"><strong>[sql] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bde0bffffdcd582dbcba03460b29c172">¶</a></span><p>Fixed bug in new “insertmanyvalues” feature where INSERT that included a
subquery with <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal notranslate"><span class="pre">bindparam()</span></code></a> inside of it would fail to render
correctly in “insertmanyvalues” format. This affected psycopg2 most
directly as “insertmanyvalues” is used unconditionally with this driver.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8639">#8639</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b2-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0b2-typing" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-6"><span class="target" id="change-4e9c1adabeacc4566f5b82d2ea29734b"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4e9c1adabeacc4566f5b82d2ea29734b">¶</a></span><p>Fixed typing issue where pylance strict mode would report “instance
variable overrides class variable” when using a method to define
<code class="docutils literal notranslate"><span class="pre">__tablename__</span></code>, <code class="docutils literal notranslate"><span class="pre">__mapper_args__</span></code> or <code class="docutils literal notranslate"><span class="pre">__table_args__</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8645">#8645</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-7"><span class="target" id="change-646cd41d331eac6081609752021fc0bf"><strong>[typing] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-646cd41d331eac6081609752021fc0bf">¶</a></span><p>Fixed typing issue where pylance strict mode would report “partially
unknown” datatype for the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8644">#8644</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b2-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.0b2-mssql" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b2-8"><span class="target" id="change-058f12296f87b8e24427ea647806d4a7"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-058f12296f87b8e24427ea647806d4a7">¶</a></span><p>Fixed regression caused by SQL Server pyodbc change <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8177">#8177</a> where we
now use <code class="docutils literal notranslate"><span class="pre">setinputsizes()</span></code> by default; for VARCHAR, this fails if the
character size is greater than 4000 (or 2000, depending on data) characters
as the incoming datatype is NVARCHAR, which has a limit of 4000 characters,
despite the fact that VARCHAR can handle unlimited characters. Additional
pyodbc-specific typing information is now passed to <code class="docutils literal notranslate"><span class="pre">setinputsizes()</span></code>
when the datatype’s size is &gt; 2000 characters. The change is also applied
to the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> type which was also impacted by this issue for large
JSON serializations.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8661">#8661</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b2-9"><span class="target" id="change-64d74c994eed139fc9c9111c98431a16"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-64d74c994eed139fc9c9111c98431a16">¶</a></span><p>The <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> construct restores itself to the DDL behavior it
had prior to the 1.4 series, where creating a <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> with
no additional arguments will emit a simple <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">SEQUENCE</span></code> instruction
<strong>without</strong> any additional parameters for “start value”.   For most backends,
this is how things worked previously in any case; <strong>however</strong>, for
MS SQL Server, the default value on this database is
<code class="docutils literal notranslate"><span class="pre">-2**63</span></code>; to prevent this generally impractical default
from taking effect on SQL Server, the <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence.params.start" title="sqlalchemy.schema.Sequence"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Sequence.start</span></code></a> parameter
should be provided.   As usage of <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> is unusual
for SQL Server which for many years has standardized on <code class="docutils literal notranslate"><span class="pre">IDENTITY</span></code>,
it is hoped that this change has minimal impact.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7211"><span class="std std-ref">The Sequence construct reverts to not having any explicit default “start” value; impacts MS SQL Server</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7211">#7211</a></p>
</p>
</li>
</ul>
</section>
</section>
<section id="change-2.0.0b1">
<h2 class="release-version">2.0.0b1<a class="headerlink" href="#change-2.0.0b1" title="Permalink to this heading">¶</a></h2>
Released: October 13, 2022<section id="change-2.0.0b1-general">
<h3>general<a class="headerlink" href="#change-2.0.0b1-general" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-0"><span class="target" id="change-c4886b74af98b72892877aefa7d6a6a4"><strong>[general] [changed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c4886b74af98b72892877aefa7d6a6a4">¶</a></span><p>Migrated the codebase to remove all pre-2.0 behaviors and architectures
that were previously noted as deprecated for removal in 2.0, including,
but not limited to:</p>
<ul>
<li><p>removal of all Python 2 code, minimum version is now Python 3.7</p></li>
<li><p><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> now use the
new 2.0 style of working, which includes “autobegin”, library level
autocommit removed, subtransactions and “branched” connections
removed</p></li>
<li><p>Result objects use 2.0-style behaviors; <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> is fully
a named tuple without “mapping” behavior, use <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a>
for “mapping” behavior</p></li>
<li><p>All Unicode encoding/decoding architecture has been removed from
SQLAlchemy.  All modern DBAPI implementations support Unicode
transparently thanks to Python 3, so the <code class="docutils literal notranslate"><span class="pre">convert_unicode</span></code> feature
as well as related mechanisms to look for bytestrings in
DBAPI <code class="docutils literal notranslate"><span class="pre">cursor.description</span></code> etc. have been removed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">.bind</span></code> attribute and parameter from <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a>,
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>, and from all DDL/DML/DQL elements that previously could
refer to a “bound engine”</p></li>
<li><p>The standalone <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.mapper()</span></code> function is removed; all
classical mapping should be done through the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.map_imperatively" title="sqlalchemy.orm.registry.map_imperatively"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.map_imperatively()</span></code></a> method of <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry" title="sqlalchemy.orm.registry"><code class="xref py py-class docutils literal notranslate"><span class="pre">registry</span></code></a>.</p></li>
<li><p>The <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a> method no longer accepts strings for
relationship names; the long-documented approach of using
<code class="docutils literal notranslate"><span class="pre">Class.attrname</span></code> for join targets is now standard.</p></li>
<li><p><a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a> no longer accepts the “aliased” and
“from_joinpoint” arguments</p></li>
<li><p><a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a> no longer accepts chains of multiple join
targets in one method call.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Query.from_self()</span></code>, <code class="docutils literal notranslate"><span class="pre">Query.select_entity_from()</span></code> and
<code class="docutils literal notranslate"><span class="pre">Query.with_polymorphic()</span></code> are removed.</p></li>
<li><p>The <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.cascade_backrefs" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.cascade_backrefs</span></code></a> parameter must now
remain at its new default of <code class="docutils literal notranslate"><span class="pre">False</span></code>; the <code class="docutils literal notranslate"><span class="pre">save-update</span></code> cascade
no longer cascades along a backref.</p></li>
<li><p>the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.future" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.future</span></code></a> parameter must always be set to
<code class="docutils literal notranslate"><span class="pre">True</span></code>.  2.0-style transactional patterns for <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
are now always in effect.</p></li>
<li><p>Loader options no longer accept strings for attribute names.  The
long-documented approach of using <code class="docutils literal notranslate"><span class="pre">Class.attrname</span></code> for loader option
targets is now standard.</p></li>
<li><p>Legacy forms of <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> removed, including
<code class="docutils literal notranslate"><span class="pre">select([cols])</span></code>, the “whereclause” and keyword parameters of
<code class="docutils literal notranslate"><span class="pre">some_table.select()</span></code>.</p></li>
<li><p>Legacy “in-place mutator” methods on <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> such as
<code class="docutils literal notranslate"><span class="pre">append_whereclause()</span></code>, <code class="docutils literal notranslate"><span class="pre">append_order_by()</span></code> etc are removed.</p></li>
<li><p>Removed the very old “dbapi_proxy” module, which in very early
SQLAlchemy releases was used to provide a transparent connection pool
over a raw DBAPI connection.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7257">#7257</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-1"><span class="target" id="change-27a555b2407a0a7fb6c97ed9490b0078"><strong>[general] [changed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-27a555b2407a0a7fb6c97ed9490b0078">¶</a></span><p>The <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.instances" title="sqlalchemy.orm.Query.instances"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.instances()</span></code></a> method is deprecated.  The behavioral
contract of this method, which is that it can iterate objects through
arbitrary result sets, is long obsolete and no longer tested.
Arbitrary statements can return objects by using constructs such
as :meth`.Select.from_statement` or <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a>.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-platform">
<h3>platform<a class="headerlink" href="#change-2.0.0b1-platform" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-2"><span class="target" id="change-2f9f17ad539804610815f3faf3adcd4c"><strong>[platform] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2f9f17ad539804610815f3faf3adcd4c">¶</a></span><p>The SQLAlchemy C extensions have been replaced with all new implementations
written in Cython.  Like the C extensions before, pre-built wheel files
for a wide range of platforms are available on pypi so that building
is not an issue for common platforms.  For custom builds, <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build_ext</span></code>
works as before, needing only the additional Cython install.  <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>
is also part of the source now which will establish the proper build dependencies
when using pip.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7256"><span class="std std-ref">C Extensions now ported to Cython</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7256">#7256</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-3"><span class="target" id="change-6eb4219c6e02e4693782ee2f7eb02ceb"><strong>[platform] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6eb4219c6e02e4693782ee2f7eb02ceb">¶</a></span><p>SQLAlchemy’s source build and installation now includes a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file
for full <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0517/"><strong>PEP 517</strong></a> support.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7311"><span class="std std-ref">Installation is now fully pep-517 enabled</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7311">#7311</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-orm">
<h3>orm<a class="headerlink" href="#change-2.0.0b1-orm" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-4"><span class="target" id="change-f12558924108e03cb08f6bbe45eb824c"><strong>[orm] [feature] [sql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f12558924108e03cb08f6bbe45eb824c">¶</a></span><p>Added new feature to all included dialects that support RETURNING
called “insertmanyvalues”.  This is a generalization of the
“fast executemany” feature first introduced for the psycopg2 driver
in 1.4 at <a class="reference internal" href="migration_14.html#change-5263"><span class="std std-ref">ORM Batch inserts with psycopg2 now batch statements with RETURNING in most cases</span></a>, which allows the ORM to batch INSERT
statements into a much more efficient SQL structure while still being
able to fetch newly generated primary key and SQL default values
using RETURNING.</p>
<p>The feature now applies to the many dialects that support RETURNING along
with multiple VALUES constructs for INSERT, including all PostgreSQL
drivers, SQLite, MariaDB, MS SQL Server. Separately, the Oracle dialect
also gains the same capability using native cx_Oracle or OracleDB features.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6047">#6047</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-5"><span class="target" id="change-74303da55dd244d5d559530a765ca3f5"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-74303da55dd244d5d559530a765ca3f5">¶</a></span><p>Added new parameter <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a>, which
will include the dictionary or list key for operations such as
<code class="docutils literal notranslate"><span class="pre">__setitem__()</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">obj[key]</span> <span class="pre">=</span> <span class="pre">value</span></code>) and <code class="docutils literal notranslate"><span class="pre">__delitem__()</span></code> (e.g.
<code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">obj[key]</span></code>), using a new keyword parameter “key” or “keys”, depending
on event, e.g. <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.AttributeEvents.append.params.key" title="sqlalchemy.orm.AttributeEvents.append"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.append.key</span></code></a>,
<a class="reference internal" href="../orm/events.html#sqlalchemy.orm.AttributeEvents.bulk_replace.params.keys" title="sqlalchemy.orm.AttributeEvents.bulk_replace"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.bulk_replace.keys</span></code></a>. This allows event
handlers to take into account the key that was passed to the operation and
is of particular importance for dictionary operations working with
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.MappedCollection" title="sqlalchemy.orm.MappedCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedCollection</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8375">#8375</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-6"><span class="target" id="change-1fa7cc08ed5ba8b5efd57d4844447b6b"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1fa7cc08ed5ba8b5efd57d4844447b6b">¶</a></span><p>Added new parameter <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.op.params.python_impl" title="sqlalchemy.sql.expression.Operators.op"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Operators.op.python_impl</span></code></a>, available
from <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.op" title="sqlalchemy.sql.expression.Operators.op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.op()</span></code></a> and also when using the
<code class="xref py py-class docutils literal notranslate"><span class="pre">custom_op</span></code> constructor directly, which allows an
in-Python evaluation function to be provided along with the custom SQL
operator. This evaluation function becomes the implementation used when the
operator object is used given plain Python objects as operands on both
sides, and in particular is compatible with the
<code class="docutils literal notranslate"><span class="pre">synchronize_session='evaluate'</span></code> option used with
<a class="reference internal" href="../orm/queryguide/dml.html#orm-expression-update-delete"><span class="std std-ref">ORM-Enabled INSERT, UPDATE, and DELETE statements</span></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/3162">#3162</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-7"><span class="target" id="change-7dd1eb09c9bb980d33c286dda4a38121"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7dd1eb09c9bb980d33c286dda4a38121">¶</a></span><p>The <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> (and by extension <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a>) now has
new state-tracking functionality that will proactively trap any unexpected
state changes which occur as a particular transactional method proceeds.
This is to allow situations where the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> is being used
in a thread-unsafe manner, where event hooks or similar may be calling
unexpected methods within operations, as well as potentially under other
concurrency situations such as asyncio or gevent to raise an informative
message when the illegal access first occurs, rather than passing silently
leading to secondary failures due to the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> being in an
invalid state.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7433"><span class="std std-ref">Session raises proactively when illegal concurrent or reentrant access is detected</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7433">#7433</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-8"><span class="target" id="change-b6ba8eb8ec6162c5ac960b4f753d012d"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b6ba8eb8ec6162c5ac960b4f753d012d">¶</a></span><p>The <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-func docutils literal notranslate"><span class="pre">composite()</span></code></a> mapping construct now supports automatic
resolution of values when used with a Python <code class="docutils literal notranslate"><span class="pre">dataclass</span></code>; the
<code class="docutils literal notranslate"><span class="pre">__composite_values__()</span></code> method no longer needs to be implemented as this
method is derived from inspection of the dataclass.</p>
<p>Additionally, classes mapped by <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-class docutils literal notranslate"><span class="pre">composite</span></code></a> now support
ordering comparison operations, e.g. <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, etc.</p>
<p>See the new documentation at <a class="reference internal" href="../orm/composites.html#mapper-composite"><span class="std std-ref">Composite Column Types</span></a> for examples.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-9"><span class="target" id="change-99d129e8d8b273e33b33f6a1b0476c75"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-99d129e8d8b273e33b33f6a1b0476c75">¶</a></span><p>Added very experimental feature to the <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> and
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a> loader options called
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload.params.recursion_depth" title="sqlalchemy.orm.selectinload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">selectinload.recursion_depth</span></code></a> /
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.immediateload.params.recursion_depth" title="sqlalchemy.orm.immediateload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">immediateload.recursion_depth</span></code></a> , which allows a single
loader option to automatically recurse into self-referential relationships.
Is set to an integer indicating depth, and may also be set to -1 to
indicate to continue loading until no more levels deep are found.
Major internal changes to <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> and
<a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a> allow this feature to work while continuing
to make correct use of the compilation cache, as well as not using
arbitrary recursion, so any level of depth is supported (though would
emit that many queries).  This may be useful for
self-referential structures that must be loaded fully eagerly, such as when
using asyncio.</p>
<p>A warning is also emitted when loader options are connected together with
arbitrary lengths (that is, without using the new <code class="docutils literal notranslate"><span class="pre">recursion_depth</span></code>
option) when excessive recursion depth is detected in related object
loading. This operation continues to use huge amounts of memory and
performs extremely poorly; the cache is disabled when this condition is
detected to protect the cache from being flooded with arbitrary statements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8126">#8126</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-10"><span class="target" id="change-145691f7df81b956c74d61fd78e686d0"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-145691f7df81b956c74d61fd78e686d0">¶</a></span><p>Added new parameter <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.autobegin" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.autobegin</span></code></a>, which when set to
<code class="docutils literal notranslate"><span class="pre">False</span></code> will prevent the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> from beginning a
transaction implicitly. The <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.begin" title="sqlalchemy.orm.Session.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.begin()</span></code></a> method must be
called explicitly first in order to proceed with operations, otherwise an
error is raised whenever any operation would otherwise have begun
automatically. This option can be used to create a “safe”
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> that won’t implicitly start new transactions.</p>
<p>As part of this change, also added a new status variable
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.SessionTransaction.origin" title="sqlalchemy.orm.SessionTransaction.origin"><code class="xref py py-class docutils literal notranslate"><span class="pre">origin</span></code></a> which may be useful for event
handling code to be aware of the origin of a particular
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6928">#6928</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-11"><span class="target" id="change-74ed78137559052bea03bee665199a75"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-74ed78137559052bea03bee665199a75">¶</a></span><p>Declarative mixins which use <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects that contain
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> references no longer need to use
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.declared_attr" title="sqlalchemy.orm.declared_attr"><code class="xref py py-func docutils literal notranslate"><span class="pre">declared_attr()</span></code></a> to achieve this mapping; the
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> object is copied along with the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> itself when the column is applied to the declared
mapping.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-12"><span class="target" id="change-306405301540860fb6efa2da3761049a"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-306405301540860fb6efa2da3761049a">¶</a></span><p>Added <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.load_only.params.raiseload" title="sqlalchemy.orm.load_only"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">load_only.raiseload</span></code></a> parameter to the
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> loader option, so that the unloaded attributes may
have “raise” behavior rather than lazy loading. Previously there wasn’t
really a way to do this with the <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> option directly.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-13"><span class="target" id="change-8201ae6068dd0b6b37e8869afcb4ad24"><strong>[orm] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8201ae6068dd0b6b37e8869afcb4ad24">¶</a></span><p>To better accommodate explicit typing, the names of some ORM constructs
that are typically constructed internally, but nonetheless are sometimes
visible in messaging as well as typing, have been changed to more succinct
names which also match the name of their constructing function (with
different casing), in all cases maintaining aliases to the old names for
the forseeable future:</p>
<ul>
<li><p><a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.RelationshipProperty" title="sqlalchemy.orm.RelationshipProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">RelationshipProperty</span></code></a> becomes an alias for the primary name
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Relationship" title="sqlalchemy.orm.Relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">Relationship</span></code></a>, which is constructed as always from the
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> function</p></li>
<li><p><a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.SynonymProperty" title="sqlalchemy.orm.SynonymProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">SynonymProperty</span></code></a> becomes an alias for the primary name
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Synonym" title="sqlalchemy.orm.Synonym"><code class="xref py py-class docutils literal notranslate"><span class="pre">Synonym</span></code></a>, constructed as always from the
<a class="reference internal" href="../orm/mapped_attributes.html#sqlalchemy.orm.synonym" title="sqlalchemy.orm.synonym"><code class="xref py py-func docutils literal notranslate"><span class="pre">synonym()</span></code></a> function</p></li>
<li><p><a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.CompositeProperty" title="sqlalchemy.orm.CompositeProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeProperty</span></code></a> becomes an alias for the primary name
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Composite" title="sqlalchemy.orm.Composite"><code class="xref py py-class docutils literal notranslate"><span class="pre">Composite</span></code></a>, constructed as always from the
<a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-func docutils literal notranslate"><span class="pre">composite()</span></code></a> function</p></li>
</ul>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-14"><span class="target" id="change-5620cb287386007c5480691a3c29bdba"><strong>[orm] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5620cb287386007c5480691a3c29bdba">¶</a></span><p>For consistency with the prominent ORM concept <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a>, the
names of the dictionary-oriented collections,
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_mapped_collection" title="sqlalchemy.orm.attribute_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_mapped_collection()</span></code></a>,
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_mapped_collection" title="sqlalchemy.orm.column_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_mapped_collection()</span></code></a>, and <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.MappedCollection" title="sqlalchemy.orm.MappedCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedCollection</span></code></a>,
are changed to <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_keyed_dict" title="sqlalchemy.orm.attribute_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_keyed_dict()</span></code></a>,
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_keyed_dict" title="sqlalchemy.orm.column_keyed_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_keyed_dict()</span></code></a> and <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.KeyFuncDict" title="sqlalchemy.orm.KeyFuncDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">KeyFuncDict</span></code></a>, using the
phrase “dict” to minimize any confusion against the term “mapped”. The old
names will remain indefinitely with no schedule for removal.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8608">#8608</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-15"><span class="target" id="change-62773006f0ddae317b9617f6e6d4ca7a"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-62773006f0ddae317b9617f6e6d4ca7a">¶</a></span><p>All <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> objects will now consistently raise
<a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.ResourceClosedError" title="sqlalchemy.exc.ResourceClosedError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceClosedError</span></code></a> if they are used after a hard close,
which includes the “hard close” that occurs after calling “single row or
value” methods like <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a> and
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.scalar" title="sqlalchemy.engine.Result.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar()</span></code></a>. This was already the behavior of the most
common class of result objects returned for Core statement executions, i.e.
those based on <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>, so this behavior is not new.
However, the change has been extended to properly accommodate for the ORM
“filtering” result objects returned when using 2.0 style ORM queries,
which would previously behave in “soft closed” style of returning empty
results, or wouldn’t actually “soft close” at all and would continue
yielding from the underlying cursor.</p>
<p>As part of this change, also added <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.close" title="sqlalchemy.engine.Result.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.close()</span></code></a> to the base
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> class and implemented it for the filtered result
implementations that are used by the ORM, so that it is possible to call
the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.close" title="sqlalchemy.engine.CursorResult.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.close()</span></code></a> method on the underlying
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> when the the <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> execution option
is in use to close a server side cursor before remaining ORM results have
been fetched. This was again already available for Core result sets but the
change makes it available for 2.0 style ORM results as well.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7274">#7274</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-16"><span class="target" id="change-34f8ec00ad680e4945a026e839cd4cfc"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-34f8ec00ad680e4945a026e839cd4cfc">¶</a></span><p>Fixed issue where the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.map_declaratively" title="sqlalchemy.orm.registry.map_declaratively"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.map_declaratively()</span></code></a> method
would return an internal “mapper config” object and not the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> object as stated in the API documentation.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-17"><span class="target" id="change-16c8efc6edc6e885e01d9382f2958ce3"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-16c8efc6edc6e885e01d9382f2958ce3">¶</a></span><p>Fixed performance regression which appeared at least in version 1.3 if not
earlier (sometime after 1.0) where the loading of deferred columns, those
explicitly mapped with <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> as opposed to non-deferred
columns that were expired, from a joined inheritance subclass would not use
the “optimized” query which only queried the immediate table that contains
the unloaded columns, instead running a full ORM query which would emit a
JOIN for all base tables, which is not necessary when only loading columns
from the subclass.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7463">#7463</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-18"><span class="target" id="change-a649d1a52507c3b98192e976e8b7bfe0"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a649d1a52507c3b98192e976e8b7bfe0">¶</a></span><p>The internals for the <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object and related loader strategy
patterns have been mostly rewritten, to take advantage of the fact that
only attribute-bound paths, not strings, are now supported. The rewrite
hopes to make it more straightforward to address new use cases and subtle
issues within the loader strategy system going forward.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6986">#6986</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-19"><span class="target" id="change-3ec032c454c7b0f0ee1e87a7f40d309d"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3ec032c454c7b0f0ee1e87a7f40d309d">¶</a></span><p>Made an improvement to the “deferred” / “load_only” set of strategy options
where if a certain object is loaded from two different logical paths within
one query, attributes that have been configured by at least one of the
options to be populated will be populated in all cases, even if other load
paths for that same object did not set this option. previously, it was
based on randomness as to which “path” addressed the object first.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8166">#8166</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-20"><span class="target" id="change-a170eeb59a50296543df7a3d21250990"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a170eeb59a50296543df7a3d21250990">¶</a></span><p>Fixed issue in ORM enabled UPDATE when the statement is created against a
joined-inheritance subclass, updating only local table columns, where the
“fetch” synchronization strategy would not render the correct RETURNING
clause for databases that use RETURNING for fetch synchronization.
Also adjusts the strategy used for RETURNING in UPDATE FROM and
DELETE FROM statements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8344">#8344</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-21"><span class="target" id="change-f365fd5f1a02db3fae69fa0a1307d804"><strong>[orm] [bug] [asyncio]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f365fd5f1a02db3fae69fa0a1307d804">¶</a></span><p>Removed the unused <code class="docutils literal notranslate"><span class="pre">**kw</span></code> arguments from
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession.begin" title="sqlalchemy.ext.asyncio.AsyncSession.begin"><code class="xref py py-class docutils literal notranslate"><span class="pre">begin</span></code></a> and
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession.begin_nested" title="sqlalchemy.ext.asyncio.AsyncSession.begin_nested"><code class="xref py py-class docutils literal notranslate"><span class="pre">begin_nested</span></code></a>. These kw aren’t used and
appear to have been added to the API in error.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7703">#7703</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-22"><span class="target" id="change-0feb60c1d7fcd84b90768a4c1f80e7f0"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0feb60c1d7fcd84b90768a4c1f80e7f0">¶</a></span><p>Changed the attribute access method used by
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_mapped_collection" title="sqlalchemy.orm.attribute_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_mapped_collection()</span></code></a> and
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_mapped_collection" title="sqlalchemy.orm.column_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_mapped_collection()</span></code></a>, used when populating the dictionary,
to assert that the data value on the object to be used as the dictionary
key is actually present, and is not instead using “None” due to the
attribute never being actually assigned. This is used to prevent a
mis-population of None for a key when assigning via a backref where the
“key” attribute on the object is not yet assigned.</p>
<p>As the failure mode here is a transitory condition that is not typically
persisted to the database, and is easy to produce via the constructor of
the class based on the order in which parameters are assigned, it is very
possible that many applications include this behavior already which is
silently passed over. To accommodate for applications where this error is
now raised, a new parameter
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_mapped_collection.params.ignore_unpopulated_attribute" title="sqlalchemy.orm.attribute_mapped_collection"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">attribute_mapped_collection.ignore_unpopulated_attribute</span></code></a>
is also added to both <a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.attribute_mapped_collection" title="sqlalchemy.orm.attribute_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">attribute_mapped_collection()</span></code></a> and
<a class="reference internal" href="../orm/collection_api.html#sqlalchemy.orm.column_mapped_collection" title="sqlalchemy.orm.column_mapped_collection"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_mapped_collection()</span></code></a> that instead causes the erroneous
backref assignment to be skipped.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8372">#8372</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-23"><span class="target" id="change-c3d5ce55b624c195cc9aa4b2004d0d26"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c3d5ce55b624c195cc9aa4b2004d0d26">¶</a></span><p>Added new parameter <a class="reference internal" href="../orm/extensions/declarative/index.html#sqlalchemy.ext.declarative.AbstractConcreteBase.params.strict_attrs" title="sqlalchemy.ext.declarative.AbstractConcreteBase"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AbstractConcreteBase.strict_attrs</span></code></a> to the
<a class="reference internal" href="../orm/extensions/declarative/index.html#sqlalchemy.ext.declarative.AbstractConcreteBase" title="sqlalchemy.ext.declarative.AbstractConcreteBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractConcreteBase</span></code></a> declarative mixin class. The effect of this
parameter is that the scope of attributes on subclasses is correctly
limited to the subclass in which each attribute is declared, rather than
the previous behavior where all attributes of the entire hierarchy are
applied to the base “abstract” class. This produces a cleaner, more correct
mapping where subclasses no longer have non-useful attributes on them which
are only relevant to sibling classes. The default for this parameter is
False, which leaves the previous behavior unchanged; this is to support
existing code that makes explicit use of these attributes in queries.
To migrate to the newer approach, apply explicit attributes to the abstract
base class as needed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8403">#8403</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-24"><span class="target" id="change-e23f0630585f2d9857b5f63c83e5e3a3"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e23f0630585f2d9857b5f63c83e5e3a3">¶</a></span><p>The behavior of <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> regarding primary key and “polymorphic
discriminator” columns is revised such that these columns are no longer
deferrable, either explicitly or when using a wildcard such as
<code class="docutils literal notranslate"><span class="pre">defer('*')</span></code>. Previously, a wildcard deferral would not load
PK/polymorphic columns which led to errors in all cases, as the ORM relies
upon these columns to produce object identities. The behavior of explicit
deferral of primary key columns is unchanged as these deferrals already
were implicitly ignored.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7495">#7495</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-25"><span class="target" id="change-b84ab5fa6b62da92ab8670fcf26666de"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b84ab5fa6b62da92ab8670fcf26666de">¶</a></span><p>Fixed bug in the behavior of the <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.eager_defaults" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.eager_defaults</span></code></a>
parameter such that client-side SQL default or onupdate expressions in the
table definition alone will trigger a fetch operation using RETURNING or
SELECT when the ORM emits an INSERT or UPDATE for the row. Previously, only
server side defaults established as part of table DDL and/or server-side
onupdate expressions would trigger this fetch, even though client-side SQL
expressions would be included when the fetch was rendered.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7438">#7438</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-engine">
<h3>engine<a class="headerlink" href="#change-2.0.0b1-engine" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-26"><span class="target" id="change-2fe37eaf2295cebd3bb4ee8e5b8c575c"><strong>[engine] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2fe37eaf2295cebd3bb4ee8e5b8c575c">¶</a></span><p>The <a class="reference internal" href="../core/events.html#sqlalchemy.events.DialectEvents.handle_error" title="sqlalchemy.events.DialectEvents.handle_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DialectEvents.handle_error()</span></code></a> event is now moved to the
<a class="reference internal" href="../core/events.html#sqlalchemy.events.DialectEvents" title="sqlalchemy.events.DialectEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">DialectEvents</span></code></a> suite from the <code class="xref py py-class docutils literal notranslate"><span class="pre">EngineEvents</span></code> suite, and
now participates in the connection pool “pre ping” event for those dialects
that make use of disconnect codes in order to detect if the database is
live. This allows end-user code to alter the state of “pre ping”. Note that
this does not include dialects which contain a native “ping” method such as
that of psycopg2 or most MySQL dialects.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5648">#5648</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-27"><span class="target" id="change-308292b1788f61e43b0907325cf55f03"><strong>[engine] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-308292b1788f61e43b0907325cf55f03">¶</a></span><p>The <a class="reference internal" href="../core/events.html#sqlalchemy.events.ConnectionEvents.set_connection_execution_options" title="sqlalchemy.events.ConnectionEvents.set_connection_execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.set_connection_execution_options()</span></code></a>
and <a class="reference internal" href="../core/events.html#sqlalchemy.events.ConnectionEvents.set_engine_execution_options" title="sqlalchemy.events.ConnectionEvents.set_engine_execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.set_engine_execution_options()</span></code></a>
event hooks now allow the given options dictionary to be modified
in-place, where the new contents will be received as the ultimate
execution options to be acted upon. Previously, in-place modifications to
the dictionary were not supported.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-28"><span class="target" id="change-59d106e3128ca16355d58d59056a7656"><strong>[engine] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-59d106e3128ca16355d58d59056a7656">¶</a></span><p>Generalized the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code></a> parameter to
the base dialect so that it is no longer dependent on individual dialects
to be present. This parameter sets up the “isolation level” setting to
occur for all new database connections as soon as they are created by the
connection pool, where the value then stays set without being reset on
every checkin.</p>
<p>The <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code></a> parameter is essentially
equivalent in functionality to using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine.execution_options.params.isolation_level" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Engine.execution_options.isolation_level</span></code></a> parameter via
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a> for an engine-wide setting. The
difference is in that the former setting assigns the isolation level just
once when a connection is created, the latter sets and resets the given
level on each connection checkout.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6342">#6342</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-29"><span class="target" id="change-e3fae2f008eeb9fd384e7b4264731713"><strong>[engine] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e3fae2f008eeb9fd384e7b4264731713">¶</a></span><p>Some small API changes regarding engines and dialects:</p>
<ul>
<li><p>The <a class="reference internal" href="../core/internals.html#sqlalchemy.engine.Dialect.set_isolation_level" title="sqlalchemy.engine.Dialect.set_isolation_level"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Dialect.set_isolation_level()</span></code></a>, <a class="reference internal" href="../core/internals.html#sqlalchemy.engine.Dialect.get_isolation_level" title="sqlalchemy.engine.Dialect.get_isolation_level"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Dialect.get_isolation_level()</span></code></a>,
:meth:
dialect methods will always be passed the raw DBAPI connection</p></li>
<li><p>The <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> classes no longer share a base
<code class="docutils literal notranslate"><span class="pre">Connectable</span></code> superclass, which has been removed.</p></li>
<li><p>Added a new interface class <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> - this is the
public facing interface for the familiar <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool._ConnectionFairy" title="sqlalchemy.pool._ConnectionFairy"><code class="xref py py-class docutils literal notranslate"><span class="pre">_ConnectionFairy</span></code></a>
class which is nonetheless a private class.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7122">#7122</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-30"><span class="target" id="change-a7295d94c49db7ecfd488d88ebda3b4b"><strong>[engine] [bug] [regression]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a7295d94c49db7ecfd488d88ebda3b4b">¶</a></span><p>Fixed regression where the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.fetchmany" title="sqlalchemy.engine.CursorResult.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.fetchmany()</span></code></a> method
would fail to autoclose a server-side cursor (i.e. when <code class="docutils literal notranslate"><span class="pre">stream_results</span></code>
or <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> is in use, either Core or ORM oriented results) when the
results were fully exhausted.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7274">#7274</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-31"><span class="target" id="change-a1432a653dd105f22367bf8d37bc26f4"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a1432a653dd105f22367bf8d37bc26f4">¶</a></span><p>Fixed issue in future <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> where calling upon
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine.begin" title="sqlalchemy.engine.Engine.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.begin()</span></code></a> and entering the context manager would not
close the connection if the actual BEGIN operation failed for some reason,
such as an event handler raising an exception; this use case failed to be
tested for the future version of the engine. Note that the “future” context
managers which handle <code class="docutils literal notranslate"><span class="pre">begin()</span></code> blocks in Core and ORM don’t actually run
the “BEGIN” operation until the context managers are actually entered. This
is different from the legacy version which runs the “BEGIN” operation up
front.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7272">#7272</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-32"><span class="target" id="change-a050cd97c80008db66b86adba0d87aaf"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a050cd97c80008db66b86adba0d87aaf">¶</a></span><p>For improved security, the <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL" title="sqlalchemy.engine.URL"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> object will now use password
obfuscation by default when <code class="docutils literal notranslate"><span class="pre">str(url)</span></code> is called. To stringify a URL with
cleartext password, the <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL.render_as_string" title="sqlalchemy.engine.URL.render_as_string"><code class="xref py py-meth docutils literal notranslate"><span class="pre">URL.render_as_string()</span></code></a> may be used,
passing the <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL.render_as_string.params.hide_password" title="sqlalchemy.engine.URL.render_as_string"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">URL.render_as_string.hide_password</span></code></a> parameter
as <code class="docutils literal notranslate"><span class="pre">False</span></code>. Thanks to our contributors for this pull request.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-8567"><span class="std std-ref">str(engine.url) will obfuscate the password by default</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8567">#8567</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-33"><span class="target" id="change-110ae4e152d8ccde03e47984e46e3a59"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-110ae4e152d8ccde03e47984e46e3a59">¶</a></span><p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code> method will now consistently check
for views of the given name as well as tables. Previously this behavior was
dialect dependent, with PostgreSQL, MySQL/MariaDB and SQLite supporting it,
and Oracle and SQL Server not supporting it. Third party dialects should
also seek to ensure their <code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code> method
searches for views as well as tables for the given name.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7161">#7161</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-34"><span class="target" id="change-d3c8ea884a50866a59532420df9574e5"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d3c8ea884a50866a59532420df9574e5">¶</a></span><p>Fixed issue in <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> method where calling upon
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> with a single index could in some cases,
particularly ORM result object cases, cause the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> to yield
scalar objects rather than <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects, as though the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> method had been called. In SQLAlchemy 1.4, this
scenario emits a warning that the behavior will change in SQLAlchemy 2.0.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7953">#7953</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-35"><span class="target" id="change-68a0a4f1bc675d02f5d125af87ed2d8c"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-68a0a4f1bc675d02f5d125af87ed2d8c">¶</a></span><p>Passing a <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.DefaultGenerator" title="sqlalchemy.schema.DefaultGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultGenerator</span></code></a> object such as a <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> to
the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a> method is deprecated, as this method is
typed as returning a <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> object, and not a plain scalar
value. The <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.scalar" title="sqlalchemy.engine.Connection.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.scalar()</span></code></a> method should be used instead, which
has been reworked with new internal codepaths to suit invoking a SELECT for
default generation objects without going through the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a> method.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-36"><span class="target" id="change-d3c558ad9e8f445302079e0e27c37e2a"><strong>[engine] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d3c558ad9e8f445302079e0e27c37e2a">¶</a></span><p>Removed the previously deprecated <code class="docutils literal notranslate"><span class="pre">case_sensitive</span></code> parameter from
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>, which would impact only the lookup of string
column names in Core-only result set rows; it had no effect on the behavior
of the ORM. The effective behavior of what <code class="docutils literal notranslate"><span class="pre">case_sensitive</span></code> refers
towards remains at its default value of <code class="docutils literal notranslate"><span class="pre">True</span></code>, meaning that string names
looked up in <code class="docutils literal notranslate"><span class="pre">row._mapping</span></code> will match case-sensitively, just like any
other Python mapping.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">case_sensitive</span></code> parameter was not in any way related to
the general subject of case sensitivity control, quoting, and “name
normalization” (i.e. converting for databases that consider all uppercase
words to be case insensitive) for DDL identifier names, which remains a
normal core feature of SQLAlchemy.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-37"><span class="target" id="change-a62d45bbda835c4784d947263d0013d9"><strong>[engine] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a62d45bbda835c4784d947263d0013d9">¶</a></span><p>Removed legacy and deprecated package <code class="docutils literal notranslate"><span class="pre">sqlalchemy.databases</span></code>.
Please use <code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects</span></code> instead.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-38"><span class="target" id="change-a68415ac51247dd9cdf35760d11f09c0"><strong>[engine] [deprecations]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a68415ac51247dd9cdf35760d11f09c0">¶</a></span><p>The <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.implicit_returning" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.implicit_returning</span></code></a> parameter is
deprecated on the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> function only; the parameter
remains available on the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object. This parameter was
originally intended to enable the “implicit returning” feature of
SQLAlchemy when it was first developed and was not enabled by default.
Under modern use, there’s no reason this parameter should be disabled, and
it has been observed to cause confusion as it degrades performance and
makes it more difficult for the ORM to retrieve recently inserted server
defaults. The parameter remains available on <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> to
specifically suit database-level edge cases which make RETURNING
infeasible, the sole example currently being SQL Server’s limitation that
INSERT RETURNING may not be used on a table that has INSERT triggers on it.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6962">#6962</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-sql">
<h3>sql<a class="headerlink" href="#change-2.0.0b1-sql" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-39"><span class="target" id="change-22fe9fadf6dd1bf4c2d29a4cfd5db4d9"><strong>[sql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-22fe9fadf6dd1bf4c2d29a4cfd5db4d9">¶</a></span><blockquote>
<div><p>Added long-requested case-insensitive string operators
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.icontains" title="sqlalchemy.sql.expression.ColumnOperators.icontains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.icontains()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.istartswith" title="sqlalchemy.sql.expression.ColumnOperators.istartswith"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.istartswith()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.iendswith" title="sqlalchemy.sql.expression.ColumnOperators.iendswith"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.iendswith()</span></code></a>, which produce case-insensitive
LIKE compositions (using ILIKE on PostgreSQL, and the LOWER() function on
all other backends) to complement the existing LIKE composition operators
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.contains" title="sqlalchemy.sql.expression.ColumnOperators.contains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.contains()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.startswith" title="sqlalchemy.sql.expression.ColumnOperators.startswith"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.startswith()</span></code></a>, etc. Huge thanks to Matias
Martinez Rebori for their meticulous and complete efforts in implementing
these new methods.</p>
</div></blockquote>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/3482">#3482</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-40"><span class="target" id="change-c2afa6591cbe398ba0d096588c60b1a7"><strong>[sql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c2afa6591cbe398ba0d096588c60b1a7">¶</a></span><p>Added new syntax to the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause.c" title="sqlalchemy.sql.expression.FromClause.c"><code class="xref py py-attr docutils literal notranslate"><span class="pre">FromClause.c</span></code></a> collection on all
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a> objects allowing tuples of keys to be passed to
<code class="docutils literal notranslate"><span class="pre">__getitem__()</span></code>, along with support for the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct
to handle the resulting tuple-like collection directly, allowing the syntax
<code class="docutils literal notranslate"><span class="pre">select(table.c['a',</span> <span class="pre">'b',</span> <span class="pre">'c'])</span></code> to be possible. The sub-collection
returned is itself a <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a> which is also directly
consumable by <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> and similar now.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/data_select.html#tutorial-selecting-columns"><span class="std std-ref">Setting the COLUMNS and FROM clause</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8285">#8285</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-41"><span class="target" id="change-170b21974f5a801bafb679dcd6a1cb81"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-170b21974f5a801bafb679dcd6a1cb81">¶</a></span><p>Altered the compilation mechanics of the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> construct
such that the “autoincrement primary key” column value will be fetched via
<code class="docutils literal notranslate"><span class="pre">cursor.lastrowid</span></code> or RETURNING even if present in the parameter set or
within the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> method as a plain bound value, for
single-row INSERT statements on specific backends that are known to
generate autoincrementing values even when explicit NULL is passed. This
restores a behavior that was in the 1.3 series for both the use case of
separate parameter set as well as <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a>. In 1.4, the
parameter set behavior unintentionally changed to no longer do this, but
the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> method would still fetch autoincrement
values up until 1.4.21 where <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6770">#6770</a> changed the behavior yet again
again unintentionally as this use case was never covered.</p>
<p>The behavior is now defined as “working” to suit the case where databases
such as SQLite, MySQL and MariaDB will ignore an explicit NULL primary key
value and nonetheless invoke an autoincrement generator.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7998">#7998</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-42"><span class="target" id="change-d147fd94fb29d392cc08a7a1cd1e70a6"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d147fd94fb29d392cc08a7a1cd1e70a6">¶</a></span><p>Added new parameter <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.HasCTE.add_cte.params.nest_here" title="sqlalchemy.sql.expression.HasCTE.add_cte"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">HasCTE.add_cte.nest_here</span></code></a> to
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.HasCTE.add_cte" title="sqlalchemy.sql.expression.HasCTE.add_cte"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HasCTE.add_cte()</span></code></a> which will “nest” a given <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.CTE" title="sqlalchemy.sql.expression.CTE"><code class="xref py py-class docutils literal notranslate"><span class="pre">CTE</span></code></a> at the
level of the parent statement. This parameter is equivalent to using the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.HasCTE.cte.params.nesting" title="sqlalchemy.sql.expression.HasCTE.cte"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">HasCTE.cte.nesting</span></code></a> parameter, but may be more intuitive in
some scenarios as it allows the nesting attribute to be set simultaneously
along with the explicit level of the CTE.</p>
<p>The <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.HasCTE.add_cte" title="sqlalchemy.sql.expression.HasCTE.add_cte"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HasCTE.add_cte()</span></code></a> method also accepts multiple CTE objects.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7759">#7759</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-43"><span class="target" id="change-6a63059a1761aa1b0d74827adc9422a2"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6a63059a1761aa1b0d74827adc9422a2">¶</a></span><p>The FROM clauses that are established on a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct
when using the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a> method will now render first
in the FROM clause of the rendered SELECT, which serves to maintain the
ordering of clauses as was passed to the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a>
method itself without being affected by the presence of those clauses also
being mentioned in other parts of the query. If other elements of the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> also generate FROM clauses, such as the columns clause
or WHERE clause, these will render after the clauses delivered by
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a> assuming they were not explictly passed to
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a> also. This improvement is useful in those
cases where a particular database generates a desirable query plan based on
a particular ordering of FROM clauses and allows full control over the
ordering of FROM clauses.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7888">#7888</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-44"><span class="target" id="change-87aa36a0518bccb608ef16ceaf60b890"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-87aa36a0518bccb608ef16ceaf60b890">¶</a></span><p>The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.length" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.length</span></code></a> parameter, which sets the length of the
<code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> column for non-native enumeration types, is now used
unconditionally when emitting DDL for the <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> datatype, including
when the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.native_enum" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.native_enum</span></code></a> parameter is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> for
target backends that continue to use <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code>. Previously the parameter
would be erroneously ignored in this case. The warning previously emitted
for this case is now removed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7791">#7791</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-45"><span class="target" id="change-e91ecefb983298aca355b0a33a87d1a9"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e91ecefb983298aca355b0a33a87d1a9">¶</a></span><p>The in-place type detection for Python integers, as occurs with an
expression such as <code class="docutils literal notranslate"><span class="pre">literal(25)</span></code>, will now apply value-based adaption as
well to accommodate Python large integers, where the datatype determined
will be <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigInteger</span></code></a> rather than <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Integer</span></code></a>. This
accommodates for dialects such as that of asyncpg which both sends implicit
typing information to the driver as well as is sensitive to numeric scale.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7909">#7909</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-46"><span class="target" id="change-905fba8337fac314efdf51d2ba475661"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-905fba8337fac314efdf51d2ba475661">¶</a></span><p>Added <code class="docutils literal notranslate"><span class="pre">if_exists</span></code> and <code class="docutils literal notranslate"><span class="pre">if_not_exists</span></code> parameters for all “Create” /
“Drop” constructs including <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.CreateSequence" title="sqlalchemy.schema.CreateSequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateSequence</span></code></a>,
<a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropSequence" title="sqlalchemy.schema.DropSequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">DropSequence</span></code></a>, <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.CreateIndex" title="sqlalchemy.schema.CreateIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateIndex</span></code></a>, <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropIndex" title="sqlalchemy.schema.DropIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DropIndex</span></code></a>, etc.
allowing generic “IF EXISTS” / “IF NOT EXISTS” phrases to be rendered
within DDL. Pull request courtesy Jesse Bakker.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7354">#7354</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-47"><span class="target" id="change-816ba1e2d278370824c287ddc4b1715e"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-816ba1e2d278370824c287ddc4b1715e">¶</a></span><p>Improved the construction of SQL binary expressions to allow for very long
expressions against the same associative operator without special steps
needed in order to avoid high memory use and excess recursion depth. A
particular binary operation <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">op</span> <span class="pre">B</span></code> can now be joined against another
element <code class="docutils literal notranslate"><span class="pre">op</span> <span class="pre">C</span></code> and the resulting structure will be “flattened” so that
the representation as well as SQL compilation does not require recursion.</p>
<p>One effect of this change is that string concatenation expressions which
use SQL functions come out as “flat”, e.g. MySQL will now render
<code class="docutils literal notranslate"><span class="pre">concat('x',</span> <span class="pre">'y',</span> <span class="pre">'z',</span> <span class="pre">...)`</span></code> rather than nesting together two-element
functions like <code class="docutils literal notranslate"><span class="pre">concat(concat('x',</span> <span class="pre">'y'),</span> <span class="pre">'z')</span></code>.  Third-party dialects
which override the string concatenation operator will need to implement
a new method <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">visit_concat_op_expression_clauselist()</span></code> to
accompany the existing <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">visit_concat_op_binary()</span></code> method.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7744">#7744</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-48"><span class="target" id="change-c890bd8c6ede5004dfc1027d531dbcda"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c890bd8c6ede5004dfc1027d531dbcda">¶</a></span><p>Implemented full support for “truediv” and “floordiv” using the
“/” and “//” operators.  A “truediv” operation between two expressions
using <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Integer</span></code></a> now considers the result to be
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a>, and the dialect-level compilation will cast
the right operand to a numeric type on a dialect-specific basis to ensure
truediv is achieved.  For floordiv, conversion is also added for those
databases that don’t already do floordiv by default (MySQL, Oracle) and
the <code class="docutils literal notranslate"><span class="pre">FLOOR()</span></code> function is rendered in this case, as well as for
cases where the right operand is not an integer (needed for PostgreSQL,
others).</p>
<p>The change resolves issues both with inconsistent behavior of the
division operator on different backends and also fixes an issue where
integer division on Oracle would fail to be able to fetch a result due
to inappropriate outputtypehandlers.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-4926"><span class="std std-ref">Python division operator performs true division for all backends; added floor division</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4926">#4926</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-49"><span class="target" id="change-bac33401bdbf98e367cce7f8621f1cb2"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bac33401bdbf98e367cce7f8621f1cb2">¶</a></span><p>Added an additional lookup step to the compiler which will track all FROM
clauses which are tables, that may have the same name shared in multiple
schemas where one of the schemas is the implicit “default” schema; in this
case, the table name when referring to that name without a schema
qualification will be rendered with an anonymous alias name at the compiler
level in order to disambiguate the two (or more) names. The approach of
schema-qualifying the normally unqualified name with the server-detected
“default schema name” value was also considered, however this approach
doesn’t apply to Oracle nor is it accepted by SQL Server, nor would it work
with multiple entries in the PostgreSQL search path. The name collision
issue resolved here has been identified as affecting at least Oracle,
PostgreSQL, SQL Server, MySQL and MariaDB.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7471">#7471</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-50"><span class="target" id="change-18c21fd7ebd6b296cd7bc3e08a7454da"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-18c21fd7ebd6b296cd7bc3e08a7454da">¶</a></span><p>The <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.array_agg" title="sqlalchemy.sql.functions.array_agg"><code class="xref py py-class docutils literal notranslate"><span class="pre">array_agg</span></code></a> will now set the array dimensions to 1.
Improved <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> processing to accept <code class="docutils literal notranslate"><span class="pre">None</span></code> values as
value of a multi-array.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7083">#7083</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-schema">
<h3>schema<a class="headerlink" href="#change-2.0.0b1-schema" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-51"><span class="target" id="change-4ecc460683a3c2c6822f77f06592c17e"><strong>[schema] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4ecc460683a3c2c6822f77f06592c17e">¶</a></span><p>Expanded on the “conditional DDL” system implemented by the
<a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.ExecutableDDLElement" title="sqlalchemy.schema.ExecutableDDLElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutableDDLElement</span></code></a> class (renamed from
<code class="xref py py-class docutils literal notranslate"><span class="pre">DDLElement</span></code>) to be directly available on
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.SchemaItem" title="sqlalchemy.schema.SchemaItem"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchemaItem</span></code></a> constructs such as <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>,
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyConstraint</span></code></a>, etc. such that the conditional logic
for generating these elements is included within the default DDL emitting
process. This system can also be accommodated by a future release of
Alembic to support conditional DDL elements within all schema-management
systems.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#ticket-7631"><span class="std std-ref">New Conditional DDL for Constraints and Indexes</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7631">#7631</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-52"><span class="target" id="change-1ea0dc71b73cdbb72cc4179667304cb5"><strong>[schema] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1ea0dc71b73cdbb72cc4179667304cb5">¶</a></span><p>Added parameter <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropConstraint.params.if_exists" title="sqlalchemy.schema.DropConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">DropConstraint.if_exists</span></code></a> to the
<a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropConstraint" title="sqlalchemy.schema.DropConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">DropConstraint</span></code></a> construct which result in “IF EXISTS” DDL
being added to the DROP statement.
This phrase is not accepted by all databases and the operation will fail
on a database that does not support it as there is no similarly compatible
fallback within the scope of a single DDL statement.
Pull request courtesy Mike Fiedler.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8141">#8141</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-53"><span class="target" id="change-f7546711184fa129ae3bde373df46f58"><strong>[schema] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f7546711184fa129ae3bde373df46f58">¶</a></span><p>Implemented the DDL event hooks <a class="reference internal" href="../core/events.html#sqlalchemy.events.DDLEvents.before_create" title="sqlalchemy.events.DDLEvents.before_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DDLEvents.before_create()</span></code></a>,
<a class="reference internal" href="../core/events.html#sqlalchemy.events.DDLEvents.after_create" title="sqlalchemy.events.DDLEvents.after_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DDLEvents.after_create()</span></code></a>, <a class="reference internal" href="../core/events.html#sqlalchemy.events.DDLEvents.before_drop" title="sqlalchemy.events.DDLEvents.before_drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DDLEvents.before_drop()</span></code></a>,
<a class="reference internal" href="../core/events.html#sqlalchemy.events.DDLEvents.after_drop" title="sqlalchemy.events.DDLEvents.after_drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DDLEvents.after_drop()</span></code></a> for all <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.SchemaItem" title="sqlalchemy.schema.SchemaItem"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchemaItem</span></code></a> objects that
include a distinct CREATE or DROP step, when that step is invoked as a
distinct SQL statement, including for <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyConstraint</span></code></a>,
<a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a>, <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>, and PostgreSQL’s
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8394">#8394</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-54"><span class="target" id="change-ab32132db96a6758f6d2db87c0902726"><strong>[schema] [performance]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ab32132db96a6758f6d2db87c0902726">¶</a></span><p>Rearchitected the schema reflection API to allow participating dialects to
make use of high performing batch queries to reflect the schemas of many
tables at once using fewer queries by an order of magnitude. The
new performance features are targeted first at the PostgreSQL and Oracle
backends, and may be applied to any dialect that makes use of SELECT
queries against system catalog tables to reflect tables. The change also
includes new API features and behavioral improvements to the
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code></a> object, including consistent, cached behavior of
methods like <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_table" title="sqlalchemy.engine.reflection.Inspector.has_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_table()</span></code></a>,
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_table_names" title="sqlalchemy.engine.reflection.Inspector.get_table_names"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_table_names()</span></code></a> and new methods
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_schema" title="sqlalchemy.engine.reflection.Inspector.has_schema"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_schema()</span></code></a> and <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.has_index" title="sqlalchemy.engine.reflection.Inspector.has_index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.has_index()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-4379"><span class="std std-ref">Major Architectural, Performance and API Enhancements for Database Reflection</span></a> - full background</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4379">#4379</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-55"><span class="target" id="change-ca40f9f7c90e511acfdc4955ea3c04ab"><strong>[schema] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ca40f9f7c90e511acfdc4955ea3c04ab">¶</a></span><p>The warnings that are emitted regarding reflection of indexes or unique
constraints, when the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.include_columns" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.include_columns</span></code></a> parameter is used
to exclude columns that are then found to be part of those constraints,
have been removed. When the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.include_columns" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.include_columns</span></code></a> parameter is
used it should be expected that the resulting <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> construct
will not include constraints that rely upon omitted columns. This change
was made in response to <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8100">#8100</a> which repaired
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.include_columns" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.include_columns</span></code></a> in conjunction with foreign key
constraints that rely upon omitted columns, where the use case became
clear that omitting such constraints should be expected.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8102">#8102</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-56"><span class="target" id="change-66d1e7a853724670dc6797707dd59014"><strong>[schema] [postgresql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-66d1e7a853724670dc6797707dd59014">¶</a></span><p>Added support for comments on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Constraint" title="sqlalchemy.schema.Constraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Constraint</span></code></a> objects, including
DDL and reflection; the field is added to the base <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Constraint" title="sqlalchemy.schema.Constraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Constraint</span></code></a>
class and corresponding constructors, however PostgreSQL is the only
included backend to support the feature right now.
See parameters such as <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint.params.comment" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ForeignKeyConstraint.comment</span></code></a>,
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint.params.comment" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">UniqueConstraint.comment</span></code></a> or
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.CheckConstraint.params.comment" title="sqlalchemy.schema.CheckConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">CheckConstraint.comment</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5677">#5677</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-57"><span class="target" id="change-47550d59426f7b27d2e5c4970c46845b"><strong>[schema] [mariadb] [mysql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-47550d59426f7b27d2e5c4970c46845b">¶</a></span><p>Add support for Partitioning and Sample pages on MySQL and MariaDB
reflected options.
The options are stored in the table dialect options dictionary, so
the following keyword need to be prefixed with <code class="docutils literal notranslate"><span class="pre">mysql_</span></code> or <code class="docutils literal notranslate"><span class="pre">mariadb_</span></code>
depending on the backend.
Supported options are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">stats_sample_pages</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">partition_by</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">partitions</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subpartition_by</span></code></p></li>
</ul>
<p>These options are also reflected when loading a table from database,
and will populate the table <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.dialect_options" title="sqlalchemy.schema.Table.dialect_options"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.dialect_options</span></code></a>.
Pull request courtesy of Ramon Will.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4038">#4038</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-typing">
<h3>typing<a class="headerlink" href="#change-2.0.0b1-typing" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-58"><span class="target" id="change-1d1e0e4eafc37d5f908f7f2b5b97f898"><strong>[typing] [improvement]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1d1e0e4eafc37d5f908f7f2b5b97f898">¶</a></span><p>The <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a> method now returns a copy of
the original <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code></a> object, rather than wrapping it
inside the <code class="docutils literal notranslate"><span class="pre">Variant</span></code> class, which is effectively removed (the import
symbol remains for backwards compatibility with code that may be testing
for this symbol). While the previous approach maintained in-Python
behaviors, maintaining the original type allows for clearer type checking
and debugging.</p>
<p><a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a> also accepts multiple dialect
names per call as well, in particular this is helpful for related
backend names such as <code class="docutils literal notranslate"><span class="pre">&quot;mysql&quot;,</span> <span class="pre">&quot;mariadb&quot;</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-6980"><span class="std std-ref">“with_variant()” clones the original TypeEngine rather than changing the type</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6980">#6980</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.0.0b1-postgresql" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-59"><span class="target" id="change-90e9d6d909128fe3d124c12c6b8e7564"><strong>[postgresql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-90e9d6d909128fe3d124c12c6b8e7564">¶</a></span><p>Added a new PostgreSQL <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.DOMAIN" title="sqlalchemy.dialects.postgresql.DOMAIN"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOMAIN</span></code></a> datatype, which follows
the same CREATE TYPE / DROP TYPE behaviors as that of PostgreSQL
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>. Much thanks to David Baumgold for the efforts on
this.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.DOMAIN" title="sqlalchemy.dialects.postgresql.DOMAIN"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOMAIN</span></code></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7316">#7316</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-60"><span class="target" id="change-92afe9a33cee323308a5e37813c0dcfa"><strong>[postgresql] [usecase] [asyncpg]</strong> <a class="changelog-reference headerlink reference internal" href="#change-92afe9a33cee323308a5e37813c0dcfa">¶</a></span><p>Added overridable methods <code class="docutils literal notranslate"><span class="pre">PGDialect_asyncpg.setup_asyncpg_json_codec</span></code>
and <code class="docutils literal notranslate"><span class="pre">PGDialect_asyncpg.setup_asyncpg_jsonb_codec</span></code> codec, which handle the
required task of registering JSON/JSONB codecs for these datatypes when
using asyncpg. The change is that methods are broken out as individual,
overridable methods to support third party dialects that need to alter or
disable how these particular codecs are set up.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7284">#7284</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-61"><span class="target" id="change-9b64c9d04c4c812f6c4486ed669673df"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9b64c9d04c4c812f6c4486ed669673df">¶</a></span><p>Added literal type rendering for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> and
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> datatypes. The generic stringify will render
using brackets, e.g. <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> and the PostgreSQL specific will use the
ARRAY literal e.g. <code class="docutils literal notranslate"><span class="pre">ARRAY[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>.   Multiple dimensions and quoting
are also taken into account.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8138">#8138</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-62"><span class="target" id="change-73e6bb02bd07660d73a82d779b57a185"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-73e6bb02bd07660d73a82d779b57a185">¶</a></span><p>Adds support for PostgreSQL multirange types, introduced in PostgreSQL 14.
Support for PostgreSQL ranges and multiranges has now been generalized to
the psycopg3, psycopg2 and asyncpg backends, with room for further dialect
support, using a backend-agnostic <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> data object
that’s constructor-compatible with the previously used psycopg2 object. See
the new documentation for usage patterns.</p>
<p>In addition, range type handling has been enhanced so that it automatically
renders type casts, so that in-place round trips for statements that don’t
provide the database with any context don’t require the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.cast" title="sqlalchemy.sql.expression.cast"><code class="xref py py-func docutils literal notranslate"><span class="pre">cast()</span></code></a>
construct to be explicit for the database to know the desired type
(discussed at <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8540">#8540</a>).</p>
<p>Thanks very much to &#64;zeeeeeb for the pull request implementing and testing
the new datatypes and psycopg support.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-ranges"><span class="std std-ref">Range and Multirange Types</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7156">#7156</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8540">#8540</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-63"><span class="target" id="change-1b0ea2017fff13b414df34e6dcd9ccb6"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1b0ea2017fff13b414df34e6dcd9ccb6">¶</a></span><p>The “ping” query emitted when configuring
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.pool_pre_ping" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_pre_ping</span></code></a> for psycopg, asyncpg and
pg8000, but not for psycopg2, has been changed to be an empty query (<code class="docutils literal notranslate"><span class="pre">;</span></code>)
instead of <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">1</span></code>; additionally, for the asyncpg driver, the
unnecessary use of a prepared statement for this query has been fixed.
Rationale is to eliminate the need for PostgreSQL to produce a query plan
when the ping is emitted. The operation is not currently supported by the
<code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> driver which continues to use <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">1</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8491">#8491</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-64"><span class="target" id="change-96ad4d2fbdb1de804021ed77109bb9f2"><strong>[postgresql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-96ad4d2fbdb1de804021ed77109bb9f2">¶</a></span><p>SQLAlchemy now requires PostgreSQL version 9 or greater.
Older versions may still work in some limited use cases.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-65"><span class="target" id="change-b7ea5c77ccc1196e5a318ac94461998c"><strong>[postgresql] [change] [mssql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b7ea5c77ccc1196e5a318ac94461998c">¶</a></span><p>The parameter <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UUID.params.as_uuid" title="sqlalchemy.types.UUID"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">UUID.as_uuid</span></code></a> of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UUID" title="sqlalchemy.types.UUID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUID</span></code></a>,
previously specific to the PostgreSQL dialect but now generalized for Core
(along with a new backend-agnostic <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype) now
defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>, indicating that Python <code class="docutils literal notranslate"><span class="pre">UUID</span></code> objects are accepted
by this datatype by default. Additionally, the SQL Server
<a class="reference internal" href="../dialects/mssql.html#sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER" title="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER"><code class="xref py py-class docutils literal notranslate"><span class="pre">UNIQUEIDENTIFIER</span></code></a> datatype has been converted to be a
UUID-receiving type; for legacy code that makes use of
<a class="reference internal" href="../dialects/mssql.html#sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER" title="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER"><code class="xref py py-class docutils literal notranslate"><span class="pre">UNIQUEIDENTIFIER</span></code></a> using string values, set the
<a class="reference internal" href="../dialects/mssql.html#sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER.params.as_uuid" title="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">UNIQUEIDENTIFIER.as_uuid</span></code></a> parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7225">#7225</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-66"><span class="target" id="change-33d6e94995b466fd7fb148087a706367"><strong>[postgresql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-33d6e94995b466fd7fb148087a706367">¶</a></span><p>The <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM.params.name" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ENUM.name</span></code></a> parameter for the PostgreSQL-specific
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> datatype is now a required keyword argument. The
“name” is necessary in any case in order for the <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>
to be usable as an error would be raised at SQL/DDL render time if “name”
were not present.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-67"><span class="target" id="change-04dc36cb52d0fa4ff70bd26876572252"><strong>[postgresql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-04dc36cb52d0fa4ff70bd26876572252">¶</a></span><p>In support of new PostgreSQL features including the psycopg3 dialect as
well as extended “fast insertmany” support, the system by which typing
information for bound parameters is passed to the PostgreSQL database has
been redesigned to use inline casts emitted by the SQL compiler, and is now
applied to all PostgreSQL dialects. This is in contrast to the previous
approach which would rely upon the DBAPI in use to render these casts
itself, which in cases such as that of pg8000 and the adapted asyncpg
driver, would use the pep-249 <code class="docutils literal notranslate"><span class="pre">setinputsizes()</span></code> method, or with the
psycopg2 driver would rely on the driver itself in most cases, with some
special exceptions made for ARRAY.</p>
<p>The new approach now has all PostgreSQL dialects rendering these casts as
needed using PostgreSQL double-colon style within the compiler, and the use
of <code class="docutils literal notranslate"><span class="pre">setinputsizes()</span></code> is removed for PostgreSQL dialects, as this was not
generally part of these DBAPIs in any case (pg8000 being the only
exception, which added the method at the request of SQLAlchemy developers).</p>
<p>Advantages to this approach include per-statement performance, as no second
pass over the compiled statement is required at execution time, better
support for all DBAPIs, as there is now one consistent system of applying
typing information, and improved transparency, as the SQL logging output,
as well as the string output of a compiled statement, will show these casts
present in the statement directly, whereas previously these casts were not
visible in logging output as they would occur after the statement were
logged.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-68"><span class="target" id="change-935bb8389d1b929fd1194a0e0894b206"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-935bb8389d1b929fd1194a0e0894b206">¶</a></span><p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.match()</span></code> operator now uses <code class="docutils literal notranslate"><span class="pre">plainto_tsquery()</span></code> for
PostgreSQL full text search, rather than <code class="docutils literal notranslate"><span class="pre">to_tsquery()</span></code>. The rationale
for this change is to provide better cross-compatibility with match on
other database backends.    Full support for all PostgreSQL full text
functions remains available through the use of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal notranslate"><span class="pre">func</span></code></a> in
conjunction with <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.bool_op" title="sqlalchemy.sql.expression.Operators.bool_op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.bool_op()</span></code></a> (an improved version of
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.op" title="sqlalchemy.sql.expression.Operators.op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.op()</span></code></a> for boolean operators).</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7086"><span class="std std-ref">match() operator on PostgreSQL uses plainto_tsquery() rather than to_tsquery()</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7086">#7086</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-69"><span class="target" id="change-bbfdedcb8620389a1371af67d62f0954"><strong>[postgresql] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bbfdedcb8620389a1371af67d62f0954">¶</a></span><p>Removed support for multiple deprecated drivers:</p>
<blockquote>
<div><ul>
<li><p>pypostgresql for PostgreSQL. This is available as an
external driver at <a class="reference external" href="https://github.com/PyGreSQL">https://github.com/PyGreSQL</a></p></li>
<li><p>pygresql for PostgreSQL.</p></li>
</ul>
</div></blockquote>
<p>Please switch to one of the supported drivers or to the external
version of the same driver.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-70"><span class="target" id="change-32b6d7cf0016c874c53d1b3d7cb20f3a"><strong>[postgresql] [dialect]</strong> <a class="changelog-reference headerlink reference internal" href="#change-32b6d7cf0016c874c53d1b3d7cb20f3a">¶</a></span><p>Added support for <code class="docutils literal notranslate"><span class="pre">psycopg</span></code> dialect supporting both sync and async
execution. This dialect is available under the <code class="docutils literal notranslate"><span class="pre">postgresql+psycopg</span></code> name
for both the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> and
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a> engine-creation functions.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#ticket-6842"><span class="std std-ref">Dialect support for psycopg 3 (a.k.a. “psycopg”)</span></a></p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-psycopg"><span class="std std-ref">psycopg</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6842">#6842</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-71"><span class="target" id="change-02657081e3c39ff6edc04c60443ec994"><strong>[postgresql] [psycopg2]</strong> <a class="changelog-reference headerlink reference internal" href="#change-02657081e3c39ff6edc04c60443ec994">¶</a></span><p>Update psycopg2 dialect to use the DBAPI interface to execute
two phase transactions. Previously SQL commands were execute
to handle this kind of transactions.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7238">#7238</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-72"><span class="target" id="change-8d63a225521d1c06855c09abbcb13c1f"><strong>[postgresql] [schema]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8d63a225521d1c06855c09abbcb13c1f">¶</a></span><p>Introduced the type <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.JSONPATH" title="sqlalchemy.dialects.postgresql.JSONPATH"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONPATH</span></code></a> that can be used
in cast expressions. This is required by some PostgreSQL dialects
when using functions such as <code class="docutils literal notranslate"><span class="pre">jsonb_path_exists</span></code> or
<code class="docutils literal notranslate"><span class="pre">jsonb_path_match</span></code> that accept a <code class="docutils literal notranslate"><span class="pre">jsonpath</span></code> as input.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-json-types"><span class="std std-ref">JSON Types</span></a> - PostgreSQL JSON types.</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8216">#8216</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-73"><span class="target" id="change-a57ec164e48c082df4b4e93bbc39e6b8"><strong>[postgresql] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a57ec164e48c082df4b4e93bbc39e6b8">¶</a></span><p>The PostgreSQL dialect now supports reflection of expression based indexes.
The reflection is supported both when using
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_indexes()</span></code> and when reflecting a
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.autoload_with" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.autoload_with</span></code></a>.
Thanks to immerrr and Aidan Kane for the help on this ticket.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7442">#7442</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-mysql">
<h3>mysql<a class="headerlink" href="#change-2.0.0b1-mysql" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-74"><span class="target" id="change-bd993480a092e17b40c0956cf33dd14e"><strong>[mysql] [usecase] [mariadb]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bd993480a092e17b40c0956cf33dd14e">¶</a></span><p>The <code class="docutils literal notranslate"><span class="pre">ROLLUP</span></code> function will now correctly render <code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">ROLLUP</span></code> on
MySql and MariaDB, allowing the use of group by rollup with these
backend.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8503">#8503</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-75"><span class="target" id="change-29aac863e814dec89b052e95418cae2b"><strong>[mysql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-29aac863e814dec89b052e95418cae2b">¶</a></span><p>Fixed issue in MySQL <a class="reference internal" href="../dialects/mysql.html#sqlalchemy.dialects.mysql.Insert.on_duplicate_key_update" title="sqlalchemy.dialects.mysql.Insert.on_duplicate_key_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_duplicate_key_update()</span></code></a> which
would render the wrong column name when an expression were used in a VALUES
expression. Pull request courtesy Cristian Sabaila.</p>
<p>This change is also <strong>backported</strong> to: 1.4.27</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7281">#7281</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-76"><span class="target" id="change-8051254beb1fa9b4191885a3b1f1f45e"><strong>[mysql] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8051254beb1fa9b4191885a3b1f1f45e">¶</a></span><p>Removed support for the OurSQL driver for MySQL and MariaDB, as this
driver does not seem to be maintained.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-mariadb">
<h3>mariadb<a class="headerlink" href="#change-2.0.0b1-mariadb" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-77"><span class="target" id="change-e238107544d812ca9f9e1cde4f1b1b49"><strong>[mariadb] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e238107544d812ca9f9e1cde4f1b1b49">¶</a></span><p>Added a new execution option <code class="docutils literal notranslate"><span class="pre">is_delete_using=True</span></code>, which is consumed
by the ORM when using an ORM-enabled DELETE statement in conjunction with
the “fetch” synchronization strategy; this option indicates that the
DELETE statement is expected to use multiple tables, which on MariaDB
is the DELETE..USING syntax.   The option then indicates that
RETURNING (newly implemented in SQLAlchemy 2.0 for MariaDB
for  <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7011">#7011</a>) should not be used for databases that are known
to not support “DELETE..USING..RETURNING” syntax, even though they
support “DELETE..USING”, which is MariaDB’s current capability.</p>
<p>The rationale for this option is that the current workings of ORM-enabled
DELETE doesn’t know up front if a DELETE statement is against multiple
tables or not until compilation occurs, which is cached in any case, yet it
needs to be known so that a SELECT for the to-be-deleted row can be emitted
up front. Instead of applying an across-the-board performance penalty for
all DELETE statements by proactively checking them all for this
relatively unusual SQL pattern, the <code class="docutils literal notranslate"><span class="pre">is_delete_using=True</span></code> execution
option is requested via a new exception message that is raised
within the compilation step.  This exception message is specifically
(and only) raised when:   the statement is an ORM-enabled DELETE where
the “fetch” synchronization strategy has been requested; the
backend is MariaDB or other backend with this specific limitation;
the statement has been detected within the initial compilation
that it would otherwise emit “DELETE..USING..RETURNING”.   By applying
the execution option, the ORM knows to run a SELECT upfront instead.
A similar option is implemented for ORM-enabled UPDATE but there is not
currently a backend where it is needed.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8344">#8344</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-78"><span class="target" id="change-3c2ebb8ae7a5d8f29ed93050a7ffe259"><strong>[mariadb] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3c2ebb8ae7a5d8f29ed93050a7ffe259">¶</a></span><p>Added INSERT..RETURNING and DELETE..RETURNING support for the MariaDB
dialect.  UPDATE..RETURNING is not yet supported by MariaDB.  MariaDB
supports INSERT..RETURNING as of 10.5.0 and DELETE..RETURNING as of
10.0.5.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7011">#7011</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-sqlite">
<h3>sqlite<a class="headerlink" href="#change-2.0.0b1-sqlite" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-79"><span class="target" id="change-87ba0af63bdd0179a542b2fa63035be3"><strong>[sqlite] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-87ba0af63bdd0179a542b2fa63035be3">¶</a></span><p>Added new parameter to SQLite for reflection methods called
<code class="docutils literal notranslate"><span class="pre">sqlite_include_internal=True</span></code>; when omitted, local tables that start
with the prefix <code class="docutils literal notranslate"><span class="pre">sqlite_</span></code>, which per SQLite documentation are noted as
“internal schema” tables such as the <code class="docutils literal notranslate"><span class="pre">sqlite_sequence</span></code> table generated to
support “AUTOINCREMENT” columns, will not be included in reflection methods
that return lists of local objects. This prevents issues for example when
using Alembic autogenerate, which previously would consider these
SQLite-generated tables as being remove from the model.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/sqlite.html#sqlite-include-internal"><span class="std std-ref">Reflecting internal schema tables</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8234">#8234</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-80"><span class="target" id="change-0a487b939ab3ad7ca93ee291b91eb410"><strong>[sqlite] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0a487b939ab3ad7ca93ee291b91eb410">¶</a></span><p>Added RETURNING support for the SQLite dialect.  SQLite supports RETURNING
since version 3.35.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6195">#6195</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-81"><span class="target" id="change-ef6ce799a34b30832a9c8115e2afa920"><strong>[sqlite] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ef6ce799a34b30832a9c8115e2afa920">¶</a></span><p>The SQLite dialect now supports UPDATE..FROM syntax, for UPDATE statements
that may refer to additional tables within the WHERE criteria of the
statement without the need to use subqueries. This syntax is invoked
automatically when using the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> construct when more than
one table or other entity or selectable is used.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7185">#7185</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-82"><span class="target" id="change-aba109875059299e0eb82359b5825416"><strong>[sqlite] [performance] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-aba109875059299e0eb82359b5825416">¶</a></span><p>The SQLite dialect now defaults to <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> when a file
based database is used. This is set along with setting the
<code class="docutils literal notranslate"><span class="pre">check_same_thread</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code>. It has been observed that the
previous approach of defaulting to <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a>, which does not
hold onto database connections after they are released, did in fact have a
measurable negative performance impact. As always, the pool class is
customizable via the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.poolclass" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.poolclass</span></code></a> parameter.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-7490"><span class="std std-ref">The SQLite dialect uses QueuePool for file-based databases</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7490">#7490</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-83"><span class="target" id="change-74fee584f531c832d0d97ea94be754b8"><strong>[sqlite] [performance] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-74fee584f531c832d0d97ea94be754b8">¶</a></span><p>SQLite datetime, date, and time datatypes now use Python standard lib
<code class="docutils literal notranslate"><span class="pre">fromisoformat()</span></code> methods in order to parse incoming datetime, date, and
time string values. This improves performance vs. the previous regular
expression-based approach, and also automatically accommodates for datetime
and time formats that contain either a six-digit “microseconds” format or a
three-digit “milliseconds” format.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7029">#7029</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-84"><span class="target" id="change-b11607250a6e056103e2b2d1205be1a8"><strong>[sqlite] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b11607250a6e056103e2b2d1205be1a8">¶</a></span><p>Removed the warning that emits from the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a> type about
DBAPIs not supporting Decimal values natively. This warning was oriented
towards SQLite, which does not have any real way without additional
extensions or workarounds of handling precision numeric values more than 15
significant digits as it only uses floating point math to represent
numbers. As this is a known and documented limitation in SQLite itself, and
not a quirk of the pysqlite driver, there’s no need for SQLAlchemy to warn
for this. The change does not otherwise modify how precision numerics are
handled. Values can continue to be handled as <code class="docutils literal notranslate"><span class="pre">Decimal()</span></code> or <code class="docutils literal notranslate"><span class="pre">float()</span></code>
as configured with the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> , and
related datatypes, just without the ability to maintain precision beyond 15
significant digits when using SQLite, unless alternate representations such
as strings are used.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7299">#7299</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-mssql">
<h3>mssql<a class="headerlink" href="#change-2.0.0b1-mssql" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-85"><span class="target" id="change-eb828295f913893a52666f05ba211af0"><strong>[mssql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-eb828295f913893a52666f05ba211af0">¶</a></span><p>Implemented reflection of the “clustered index” flag <code class="docutils literal notranslate"><span class="pre">mssql_clustered</span></code>
for the SQL Server dialect. Pull request courtesy John Lennox.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8288">#8288</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-86"><span class="target" id="change-5381b6da8f1e1e87292d63c7a815282c"><strong>[mssql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5381b6da8f1e1e87292d63c7a815282c">¶</a></span><p>Added support table and column comments on MSSQL when
creating a table. Added support for reflecting table comments.
Thanks to Daniel Hall for the help in this pull request.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7844">#7844</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-87"><span class="target" id="change-66bddfbbce3c9e37214e8c5864ab1fad"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-66bddfbbce3c9e37214e8c5864ab1fad">¶</a></span><p>The <code class="docutils literal notranslate"><span class="pre">use_setinputsizes</span></code> parameter for the <code class="docutils literal notranslate"><span class="pre">mssql+pyodbc</span></code> dialect now
defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>; this is so that non-unicode string comparisons are
bound by pyodbc to pyodbc.SQL_VARCHAR rather than pyodbc.SQL_WVARCHAR,
allowing indexes against VARCHAR columns to take effect. In order for the
<code class="docutils literal notranslate"><span class="pre">fast_executemany=True</span></code> parameter to continue functioning, the
<code class="docutils literal notranslate"><span class="pre">use_setinputsizes</span></code> mode now skips the <code class="docutils literal notranslate"><span class="pre">cursor.setinputsizes()</span></code> call
specifically when <code class="docutils literal notranslate"><span class="pre">fast_executemany</span></code> is True and the specific method in
use is <code class="docutils literal notranslate"><span class="pre">cursor.executemany()</span></code>, which doesn’t support setinputsizes. The
change also adds appropriate pyodbc DBAPI typing to values that are typed
as <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> or <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UnicodeText" title="sqlalchemy.types.UnicodeText"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnicodeText</span></code></a>, as well as
altered the base <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> datatype to consider JSON string
values as <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> rather than <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8177">#8177</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-88"><span class="target" id="change-331585cb105c7ac765402fada93eb145"><strong>[mssql] [removed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-331585cb105c7ac765402fada93eb145">¶</a></span><p>Removed support for the mxodbc driver due to lack of testing support. ODBC
users may use the pyodbc dialect which is fully supported.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-oracle">
<h3>oracle<a class="headerlink" href="#change-2.0.0b1-oracle" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-89"><span class="target" id="change-eeb03c160d031aaae00f66021f36b12d"><strong>[oracle] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-eeb03c160d031aaae00f66021f36b12d">¶</a></span><p>Add support for the new oracle driver <code class="docutils literal notranslate"><span class="pre">oracledb</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#ticket-8054"><span class="std std-ref">Dialect support for oracledb</span></a></p>
<p><a class="reference internal" href="../dialects/oracle.html#oracledb"><span class="std std-ref">python-oracledb</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8054">#8054</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-90"><span class="target" id="change-ca0562a665f538b7272e2ebac618db47"><strong>[oracle] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ca0562a665f538b7272e2ebac618db47">¶</a></span><p>Implemented DDL and reflection support for <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> datatypes which
include an explicit “binary_precision” value. Using the Oracle-specific
<a class="reference internal" href="../dialects/oracle.html#sqlalchemy.dialects.oracle.FLOAT" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a> datatype, the new parameter
<a class="reference internal" href="../dialects/oracle.html#sqlalchemy.dialects.oracle.FLOAT.params.binary_precision" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">FLOAT.binary_precision</span></code></a> may be specified which will
render Oracle’s precision for floating point types directly. This value is
interpreted during reflection. Upon reflecting back a <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> datatype,
the datatype returned is one of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DOUBLE_PRECISION" title="sqlalchemy.types.DOUBLE_PRECISION"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOUBLE_PRECISION</span></code></a> for a
<code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> for a precision of 126 (this is also Oracle’s default precision
for <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>), <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">REAL</span></code></a> for a precision of 63, and
<a class="reference internal" href="../dialects/oracle.html#sqlalchemy.dialects.oracle.FLOAT" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a> for a custom precision, as per Oracle documentation.</p>
<p>As part of this change, the generic <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float.params.precision" title="sqlalchemy.types.Float"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Float.precision</span></code></a>
value is explicitly rejected when generating DDL for Oracle, as this
precision cannot be accurately converted to “binary precision”; instead, an
error message encourages the use of
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a> so that Oracle’s specific form of
precision may be chosen exactly. This is a backwards-incompatible change in
behavior, as the previous “precision” value was silently ignored for
Oracle.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="whatsnew_20.html#change-5465-oracle"><span class="std std-ref">New Oracle FLOAT type with binary precision; decimal precision not accepted directly</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5465">#5465</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-91"><span class="target" id="change-bf1925eed418d2e2bb63286942a2aa62"><strong>[oracle] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bf1925eed418d2e2bb63286942a2aa62">¶</a></span><p>Full “RETURNING” support is implemented for the cx_Oracle dialect, covering
two individual types of functionality:</p>
<ul>
<li><p>multi-row RETURNING is implemented, meaning multiple RETURNING rows are
now received for DML statements that produce more than one row for
RETURNING.</p></li>
<li><p>”executemany RETURNING” is also implemented - this allows RETURNING to
yield row-per statement when <code class="docutils literal notranslate"><span class="pre">cursor.executemany()</span></code> is used.
The implementation of this part of the feature delivers dramatic
performance improvements to ORM inserts, in the same way as was
added for psycopg2 in the SQLAlchemy 1.4 change <a class="reference internal" href="migration_14.html#change-5263"><span class="std std-ref">ORM Batch inserts with psycopg2 now batch statements with RETURNING in most cases</span></a>.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6245">#6245</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-92"><span class="target" id="change-56152629724a193afda447f03f7d1ad0"><strong>[oracle] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-56152629724a193afda447f03f7d1ad0">¶</a></span><p>Oracle will now use FETCH FIRST N ROWS / OFFSET syntax for limit/offset
support by default for Oracle 12c and above. This syntax was already
available when <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.fetch" title="sqlalchemy.sql.expression.Select.fetch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.fetch()</span></code></a> were used directly, it’s now
implied for <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.limit" title="sqlalchemy.sql.expression.Select.limit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.limit()</span></code></a> and <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.offset" title="sqlalchemy.sql.expression.Select.offset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.offset()</span></code></a> as
well.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8221">#8221</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-93"><span class="target" id="change-0a5938bbfa46c3426a247288c3469167"><strong>[oracle] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0a5938bbfa46c3426a247288c3469167">¶</a></span><p>Materialized views on oracle are now reflected as views.
On previous versions of SQLAlchemy the views were returned among
the table names, not among the view names. As a side effect of
this change they are not reflected by default by
<code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.reflect()</span></code>, unless <code class="docutils literal notranslate"><span class="pre">views=True</span></code> is set.
To get a list of materialized views, use the new
inspection method <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_materialized_view_names" title="sqlalchemy.engine.reflection.Inspector.get_materialized_view_names"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_materialized_view_names()</span></code></a>.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-94"><span class="target" id="change-b1f8435d162a2820dbaca029aa53bb5f"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b1f8435d162a2820dbaca029aa53bb5f">¶</a></span><p>Adjustments made to the BLOB / CLOB / NCLOB datatypes in the cx_Oracle and
oracledb dialects, to improve performance based on recommendations from
Oracle developers.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7494">#7494</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-95"><span class="target" id="change-7ec56a4929a89c1bb8f6751cfaf84753"><strong>[oracle] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7ec56a4929a89c1bb8f6751cfaf84753">¶</a></span><p>Related to the deprecation for
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.implicit_returning" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.implicit_returning</span></code></a>, the “implicit_returning”
feature is now enabled for the Oracle dialect in all cases; previously, the
feature would be turned off when an Oracle 8/8i version were detected,
however online documentation indicates both versions support the same
RETURNING syntax as modern versions.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6962">#6962</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-96"><span class="target" id="change-68ceca590251d75fbd16df1f236e1123"><strong>[oracle]</strong> <a class="changelog-reference headerlink reference internal" href="#change-68ceca590251d75fbd16df1f236e1123">¶</a></span><p>cx_Oracle 7 is now the minimum version for cx_Oracle.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.0.0b1-misc">
<h3>misc<a class="headerlink" href="#change-2.0.0b1-misc" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.0.0b1-97"><span class="target" id="change-e673d427c771a23e933070c033f8353a"><strong>[feature] [types]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e673d427c771a23e933070c033f8353a">¶</a></span><p>Added new backend-agnostic <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype generalized from
the PostgreSQL dialects to now be a core type, as well as migrated
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UUID" title="sqlalchemy.types.UUID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUID</span></code></a> from the PostgreSQL dialect. The SQL Server
<a class="reference internal" href="../dialects/mssql.html#sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER" title="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER"><code class="xref py py-class docutils literal notranslate"><span class="pre">UNIQUEIDENTIFIER</span></code></a> datatype also becomes a UUID-handling
datatype. Thanks to Trevor Gross for the help on this.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7212">#7212</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-98"><span class="target" id="change-0608bbeae33a7a2413215a6a847cefd8"><strong>[feature] [types]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0608bbeae33a7a2413215a6a847cefd8">¶</a></span><p>Added <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DOUBLE" title="sqlalchemy.types.DOUBLE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOUBLE</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DOUBLE_PRECISION" title="sqlalchemy.types.DOUBLE_PRECISION"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOUBLE_PRECISION</span></code></a>
datatypes to the base <code class="docutils literal notranslate"><span class="pre">sqlalchemy.</span></code> module namespace, for explicit use of
double/double precision as well as generic “double” datatypes. Use
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a> for generic support that will resolve to DOUBLE/DOUBLE
PRECISION/FLOAT as needed for different backends.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5465">#5465</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-99"><span class="target" id="change-206ec1f2af3a0c93785758c723ba356f"><strong>[usecase] [datatypes]</strong> <a class="changelog-reference headerlink reference internal" href="#change-206ec1f2af3a0c93785758c723ba356f">¶</a></span><p>Added modified ISO-8601 rendering (i.e. ISO-8601 with the T converted to a
space) when using <code class="docutils literal notranslate"><span class="pre">literal_binds</span></code> with the SQL compilers provided by the
PostgreSQL, MySQL, MariaDB, MSSQL, Oracle dialects. For Oracle, the ISO
format is wrapped inside of an appropriate TO_DATE() function call.
Previously this rendering was not implemented for dialect-specific
compilation.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5052">#5052</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-100"><span class="target" id="change-97d91929f22f292e9c0066e3ce128dd2"><strong>[bug] [pool]</strong> <a class="changelog-reference headerlink reference internal" href="#change-97d91929f22f292e9c0066e3ce128dd2">¶</a></span><p>The <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> now ignores <code class="docutils literal notranslate"><span class="pre">max_overflow</span></code> when
<code class="docutils literal notranslate"><span class="pre">pool_size=0</span></code>, properly making the pool unlimited in all cases.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8523">#8523</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-101"><span class="target" id="change-4fed778e4634104080875dc4591f302b"><strong>[bug] [types]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4fed778e4634104080875dc4591f302b">¶</a></span><p>Python string values for which a SQL type is determined from the type of
the value, mainly when using <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.literal" title="sqlalchemy.sql.expression.literal"><code class="xref py py-func docutils literal notranslate"><span class="pre">literal()</span></code></a>, will now apply the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a> type, rather than the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a>
datatype, for Python string values that test as “ascii only” using Python
<code class="docutils literal notranslate"><span class="pre">str.isascii()</span></code>. If the string is not <code class="docutils literal notranslate"><span class="pre">isascii()</span></code>, the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> datatype will be bound instead, which was used in
all string detection previously. This behavior <strong>only applies to in-place
detection of datatypes when using ``literal()`` or other contexts that have
no existing datatype</strong>, which is not usually the case under normal
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> comparison operations, where the type of the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> being compared always takes precedence.</p>
<p>Use of the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> datatype can determine literal string
formatting on backends such as SQL Server, where a literal value (i.e.
using <code class="docutils literal notranslate"><span class="pre">literal_binds</span></code>) will be rendered as <code class="docutils literal notranslate"><span class="pre">N'&lt;value&gt;'</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">'value'</span></code>. For normal bound value handling, the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a>
datatype also may have implications for passing values to the DBAPI, again
in the case of SQL Server, the pyodbc driver supports the use of
<a class="reference internal" href="../dialects/mssql.html#mssql-pyodbc-setinputsizes"><span class="std std-ref">setinputsizes mode</span></a> which will handle
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a> versus <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> differently.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7551">#7551</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-102"><span class="target" id="change-ea7e18a4d46eb028c8467f86baf23c3e"><strong>[removed] [sybase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ea7e18a4d46eb028c8467f86baf23c3e">¶</a></span><p>Removed the “sybase” internal dialect that was deprecated in previous
SQLAlchemy versions.  Third party dialect support is available.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/index.html"><span class="std std-ref">External Dialects</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
<li><p class="caption" id="change-2.0.0b1-103"><span class="target" id="change-6bc74df6de169a4e220964fe38583665"><strong>[removed] [firebird]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6bc74df6de169a4e220964fe38583665">¶</a></span><p>Removed the “firebird” internal dialect that was deprecated in previous
SQLAlchemy versions.  Third party dialect support is available.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/index.html"><span class="std std-ref">External Dialects</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7258">#7258</a></p>
</p>
</li>
</ul>
</section>
</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="whatsnew_20.html" title="previous chapter">What’s New in SQLAlchemy 2.0?</a>
        Next:
        <a href="changelog_14.html" title="next chapter">1.4 Changelog</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2022, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 5.3.0.

    Documentation last generated: Thu 20 Oct 2022 01:41:39 PM 

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '2.0.0b2',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


