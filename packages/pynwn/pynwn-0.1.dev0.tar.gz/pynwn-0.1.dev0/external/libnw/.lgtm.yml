path_classifiers:
  test:
    - tests
  # docs:
  # - docs
  library:
    - external
extraction:
  cpp:
    prepare:
      packages:
        - libssl-dev
        - build-essential
        - automake
        - autoconf
        - autoconf-archive
        - libtool-bin
        - texinfo
        - yasm
        - ninja-build
        - ccache
        - cmake
    after_prepare: # Customizable step used by all languages.
      # installs cmake!
      - cmake --version
      - wget -O cmake.tar.gz https://github.com/Kitware/CMake/releases/download/v3.22.1/cmake-3.22.1.tar.gz
      - tar zxf cmake.tar.gz
      - cd cmake-*/
      - mkdir build
      - cd build
      - cmake -DCMAKE_INSTALL_PREFIX:PATH=~/.local/ -DCMAKE_BUILD_TYPE=Release ..
      - make install
      - ls ~/.local/bin
      - export PATH=~/.local/bin:$PATH # env variables are propagated, so this is visible in the configure step!
      - cmake --version
    configure:
      command:
        - git clone https://github.com/Microsoft/vcpkg.git
        - cd vcpkg
        - export VCPKG_ROOT="$LGTM_SRC/vcpkg"
        - export PATH="$VCPKG_ROOT:$PATH"
        - git pull origin master --no-rebase
        - ./bootstrap-vcpkg.sh
        - vcpkg integrate install
        - cmake --version
        - cd $LGTM_SRC
        - pwd
        - ps aux | grep vcpkg
    index:
      build_command:
        - cd $LGTM_SRC
        - pwd
        - mkdir build
        - cd build || exit
        - cmake -GNinja -DCMAKE_BUILD_TYPE=RelWithDebInfo -Wno-dev -DCMAKE_TOOLCHAIN_FILE=$LGTM_SRC/vcpkg/scripts/buildsystems/vcpkg.cmake  ..
        - cmake --build .
