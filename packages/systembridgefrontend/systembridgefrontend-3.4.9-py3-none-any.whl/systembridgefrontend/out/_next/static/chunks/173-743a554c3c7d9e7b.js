"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{311:function(e,t,n){n.d(t,{Z:function(){return j}});var o=n(6042),i=n(9396),r=n(5893),s=n(7294),a=n(1163),c=n(9008),u=n.n(c),l=n(562),d=n(8849),p=n(3648),f=n(2971),m=n(2097),h=n(5050),v=n(6336),y=n(784),x=n(9072),g=n(5084),b=n(9630),Z=n(1953);function k(e){var t=e.children,n=(0,f.Z)({disableHysteresis:!0,threshold:24});return(0,s.cloneElement)(t,{elevation:n?4:0})}var w=function(){var e=(0,s.useState)(!1),t=e[0],n=e[1],o=((0,s.useCallback)((function(){n(!t)}),[t]),(0,m.Z)());return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(k,{children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.Z,{color:"transparent",elevation:0,children:(0,r.jsx)(v.Z,{maxWidth:"xl",sx:{padding:0},children:(0,r.jsx)(y.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,r.jsx)(x.ZP,{item:!0,children:(0,r.jsx)(g.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,r.jsx)(b.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:o.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,r.jsx)(Z.Z,{sx:{height:o.spacing(18)}})]})})})},S=!1;var j=function(e){var t=(0,a.useRouter)();return(0,s.useEffect)((function(){if(t.isReady&&!S){var e,n,r,s;S=!0;var a=(null===(e=t.query)||void 0===e?void 0:e.apiKey)||"",c=(null===(n=t.query)||void 0===n?void 0:n.apiPort)||"9170",u=!1;if((null===(r=t.query)||void 0===r?void 0:r.apiKey)||(u=!0,a=window.prompt("Please enter your API key",a)),(null===(s=t.query)||void 0===s?void 0:s.apiPort)||(u=!0,c=window.prompt("Please enter your API port (default: 9170)",c)),u&&a&&c){var l=t.asPath.split("?")[0];t.replace({pathname:l.includes(".html")?l:"".concat(l,".html"),query:(0,i.Z)((0,o.Z)({},t.query),{apiKey:a,apiPort:c})})}}}),[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u(),{children:[(0,r.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,r.jsx)("link",{rel:"canonical",href:e.url}),(0,r.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,r.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,r.jsx)(w,{}),e.closeButton&&(0,r.jsx)(l.Z,{size:"small",sx:{position:"absolute",top:4,right:4,zIndex:1e3},onClick:function(){window.location.href="http://close.window"},children:(0,r.jsx)(d.Icon,{id:"close",path:p.r5M,size:1})}),e.children]})}},8768:function(e,t,n){n.d(t,{D:function(){return r},X:function(){return i}});var o=n(7294);function i(e){navigator.permissions.query({name:"clipboard-write"}).then((function(t){"granted"!==t.state&&"prompt"!==t.state||navigator.clipboard.writeText(e)}))}function r(e){var t=(0,o.useRef)();return(0,o.useEffect)((function(){t.current=e})),t.current}},8838:function(e,t,n){n.d(t,{C:function(){return s}});var o=n(7568),i=n(1438),r=n(655),s=function(){function e(t,n,s){(0,i.Z)(this,e),this.port=t||9170,this.apiKey=n;var a=this;(0,o.Z)((function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return[4,a.connect()];case 1:return a.websocket=e.sent(),s&&a.websocket&&a.websocket.readyState===a.websocket.OPEN&&s(),[2]}}))}))()}var t=e.prototype;return t.close=function(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.close()},t.connect=function(){var e=this;return(0,o.Z)((function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return t=new WebSocket("ws://".concat(window.location.hostname||"localhost",":").concat(e.port,"/api/websocket")),[4,new Promise((function(e){t.onopen=function(){return e()}}))];case 1:return n.sent(),t.onmessage=function(t){if("string"===typeof t.data){var n=JSON.parse(t.data);n&&e.onEvent&&e.onEvent(n)}},[2,t]}}))}))()},t.isConnected=function(){var e;return(null===(e=this.websocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN},t.getData=function(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get data:",e),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"GET_DATA",modules:e})))},t.getSettings=function(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get settings"),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"GET_SETTINGS"})))},t.registerDataListener=function(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Register data listener:",e),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"REGISTER_DATA_LISTENER",modules:e})))},t.sendPlayerStatus=function(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"MEDIA_STATUS",status:e}))},t.updateSetting=function(e,t){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Update setting:",{key:e,value:t}),this.websocket.send(JSON.stringify({"api-key":this.apiKey,event:"UPDATE_SETTING",setting:e,value:t})))},e}()},7902:function(e,t,n){n.d(t,{Z:function(){return D}});var o=n(7568),i=n(6042),r=n(9396),s=n(603),a=n(655),c=n(5893),u=n(7294),l=n(387),d=n(6486),p=n(3564),f=n(8768),m=n(8838),h=n(2097),v=n(9072),y=n(1953),x=n(1237),g=n(9942),b=n(9630),Z=n(562),k=n(7937),w=n(8849),S=n(3648),j=n(381),P=n.n(j),E=n(6310);var C=function(){var e=function(){J(!1),f(!0)},t=function(){A&&ee(A)},n=(0,s.Z)((0,p.nn)(),2),o=n[0],a=n[1],l=(0,u.useState)(!1),d=l[0],f=l[1],m=(0,s.Z)((0,p.XI)(),2),j=m[0],C=m[1],I=(0,u.useRef)(null),_=(0,u.useMemo)((function(){return o}),[o]),D=_.duration,M=_.playing,N=_.muted,T=_.loaded,A=_.position,O=_.volume,L=(0,u.useMemo)((function(){return"".concat((100*O).toFixed(0),"%")}),[O]),U=(0,u.useMemo)((function(){var e=P().duration(A,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))}),[A]),K=(0,u.useMemo)((function(){var e=P().duration(D,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))}),[D]),R=(0,u.useMemo)((function(){return o.source}),[o]),W=R.artist,q=R.album,z=R.cover,F=R.source,G=R.title,B=(0,u.useCallback)((function(e){a((0,r.Z)((0,i.Z)({},o),{loaded:e}))}),[o,a]),J=(0,u.useCallback)((function(e){a((0,r.Z)((0,i.Z)({},o),{playing:e}))}),[o,a]),H=(0,u.useCallback)((function(){J(!M)}),[M,J]),V=(0,u.useCallback)((function(e){a((0,r.Z)((0,i.Z)({},o),{muted:e}))}),[o,a]),X=(0,u.useCallback)((function(){V(!N)}),[N,V]),Y=(0,u.useCallback)((function(e,t){var n="down"===t?O-e:"up"===t?O+e:e;n>1&&(n=1),n<0&&(n=0),a((0,r.Z)((0,i.Z)({},o),{volume:n})),N&&V(!1)}),[N,O,o,a,V]),Q=(0,u.useCallback)((function(e){a((0,r.Z)((0,i.Z)({},o),{duration:e}))}),[o,a]),$=(0,u.useCallback)((function(e){D&&e>D&&(e=D),e<0&&(e=0),a((0,r.Z)((0,i.Z)({},o),{position:e}))}),[o,D,a]),ee=(0,u.useCallback)((function(e){var t;null===(t=I.current)||void 0===t||t.seekTo(e,"seconds"),f(!1),M||J(!0)}),[M,J]);(0,u.useEffect)((function(){T||B(!0)}),[T,B,J]);var te=(0,h.Z)();return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(E.Z,{ref:I,height:"0px",width:"0px",muted:N,playing:M,stopOnUnmount:!0,url:F,volume:O,onDuration:function(e){Q(e)},onPause:function(){J(!1)},onPlay:function(){J(!0)},onStart:function(){J(!0)},onProgress:function(e){var t=e.playedSeconds;d||$(t)}}),(0,c.jsxs)(v.ZP,{container:!0,direction:"row",alignItems:"center",justifyItems:"center",wrap:"nowrap",sx:{height:140,width:540,overflow:"hidden"},children:[(0,c.jsx)(v.ZP,{item:!0,sx:{width:140,margin:te.spacing(0,1,0,0)},children:(0,c.jsx)(y.Z,{ref:j,children:(0,c.jsxs)(x.Z,{"aria-label":M?"Pause":"Play",onClick:H,children:[(0,c.jsx)("img",{alt:"".concat(W," - ").concat(q),src:z||"https://raw.githubusercontent.com/timmo001/system-bridge/master/resources/system-bridge-dimmed.svg",width:140}),(0,c.jsx)(g.Z,{in:!!C,timeout:{enter:200,exit:400},children:(0,c.jsx)(y.Z,{sx:{position:"absolute",display:"flex",height:"100%",width:"100%",zIndex:100},children:(0,c.jsx)(w.Icon,{id:M?"pause":"play",path:M?S.Wa1:S._86,size:6,style:{position:"relative",margin:"auto"}})})})]})})}),(0,c.jsx)(v.ZP,{item:!0,xs:!0,children:(0,c.jsxs)(v.ZP,{container:!0,direction:"column",alignItems:"flex-start",justifyItems:"space-around",children:[(0,c.jsx)(v.ZP,{item:!0,children:(0,c.jsxs)(b.Z,{color:"textPrimary",component:"span",variant:"subtitle1",noWrap:!0,children:[W," - ",G]})}),(0,c.jsx)(v.ZP,{item:!0,children:(0,c.jsx)(b.Z,{color:"textSecondary",component:"span",variant:"subtitle2",noWrap:!0,children:q})}),(0,c.jsxs)(v.ZP,{item:!0,container:!0,alignContent:"center",children:[(0,c.jsx)(v.ZP,{item:!0,xs:4}),(0,c.jsx)(v.ZP,{sx:{margin:te.spacing(0,1,0,0)},item:!0,children:(0,c.jsx)(Z.Z,{size:"small",onClick:X,children:N?(0,c.jsx)(w.Icon,{id:"mute",path:S.PLS,size:1.25}):(0,c.jsx)(w.Icon,{id:"unmute",path:S.dw,size:1.25})})}),(0,c.jsx)(v.ZP,{sx:{margin:te.spacing(.6,2,0,0)},item:!0,xs:!0,children:(0,c.jsx)(k.ZP,{min:0,max:1,step:.01,value:O,onChange:function(e,t){"number"===typeof t&&Y(t)}})}),(0,c.jsx)(v.ZP,{sx:{margin:te.spacing(.9,O>=1?1:2,0,0)},item:!0,children:(0,c.jsx)(b.Z,{component:"span",variant:"body2",children:L})})]}),(0,c.jsxs)(v.ZP,{container:!0,children:[(0,c.jsx)(v.ZP,{sx:{margin:te.spacing(.25,2,0,0)},item:!0,children:(0,c.jsx)(b.Z,{component:"span",variant:"body2",children:U})}),(0,c.jsx)(v.ZP,{sx:{margin:te.spacing(0,2,0,0)},item:!0,xs:!0,children:(0,c.jsx)(k.ZP,{min:0,max:D,step:.1,value:A,valueLabelDisplay:"off",onMouseDown:e,onKeyDown:e,onChange:function(e,t){$(t)},onMouseUp:t,onKeyUp:t})}),(0,c.jsx)(v.ZP,{sx:{margin:te.spacing(.25,1,0,0)},item:!0,children:(0,c.jsx)(b.Z,{component:"span",variant:"body2",children:K})})]})]})})]})]})};var I,_=function(){var e=(0,s.Z)((0,p.nn)(),2),t=e[0],n=e[1],o=(0,u.useMemo)((function(){return t}),[t]),a=o.autoplay,l=o.duration,d=o.playing,f=o.muted,m=o.loaded,h=o.volume,v=(0,u.useMemo)((function(){return t.source}),[t]).source,y=(0,u.useCallback)((function(e){n((0,r.Z)((0,i.Z)({},t),{loaded:e}))}),[t,n]),x=(0,u.useCallback)((function(e){console.log("Set playing:",e),n((0,r.Z)((0,i.Z)({},t),{playing:e}))}),[t,n]),g=(0,u.useCallback)((function(e){n((0,r.Z)((0,i.Z)({},t),{muted:e}))}),[t,n]),b=((0,u.useCallback)((function(e,o){var s="down"===o?h-e:"up"===o?h+e:e;s>1&&(s=1),s<0&&(s=0),n((0,r.Z)((0,i.Z)({},t),{volume:s})),f&&g(!1)}),[f,h,t,n,g]),(0,u.useCallback)((function(e){return n((0,r.Z)((0,i.Z)({},t),{duration:e}))}),[t,n])),Z=(0,u.useCallback)((function(e){l&&e>l&&(e=l),e<0&&(e=0),n((0,r.Z)((0,i.Z)({},t),{position:e}))}),[t,l,n]);return(0,u.useEffect)((function(){m||y(!0)}),[m,y]),(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(E.Z,{autoPlay:a,controls:!0,height:"270px",width:"480px",playsinline:!0,muted:f,playing:d,url:v,volume:h,style:{position:"absolute",top:"0",left:"0",overflow:"hidden"},onReady:function(){console.log("Autoplay:",a),x(a||!1)},onDuration:function(e){return b(e)},onPause:function(){return x(!1)},onPlay:function(){return x(!0)},onStart:function(){return x(!0)},onProgress:function(e){var t=e.playedSeconds;return Z(t)}})})};var D=function(e){var t=e.playerType,n=(0,u.useState)(!1),h=n[0],v=n[1],y=(0,s.Z)((0,p.nn)(),2),x=y[0],g=y[1],b=(0,f.D)(x),Z=(0,l.useRouter)(),k=Z.query,w=(0,u.useCallback)((function(e){switch(console.log("Event:",e),e.type){case"MEDIA_PAUSE":g((0,r.Z)((0,i.Z)({},x),{playing:!1}));break;case"MEDIA_PLAY":g((0,r.Z)((0,i.Z)({},x),{playing:!0}));break;case"MEDIA_VOLUME_DOWN":e.volume&&g((0,r.Z)((0,i.Z)({},x),{volume:x.volume-e.volume}));break;case"MEDIA_VOLUME_UP":e.volume&&g((0,r.Z)((0,i.Z)({},x),{volume:x.volume+e.volume}));break;case"MEDIA_VOLUME_SET":e.volume&&g((0,r.Z)((0,i.Z)({},x),{volume:e.volume}));break;case"MEDIA_VOLUME_SET":e.position&&g((0,r.Z)((0,i.Z)({},x),{position:e.position}))}}),[x,g]),S=(0,u.useCallback)((function(e,t){console.log("Setup WebSocketConnection"),(I=new m.C(e,t,(0,o.Z)((function(){return(0,a.__generator)(this,(function(e){return console.log("Connected to WebSocket"),[2]}))})))).onEvent=w}),[w]);(0,u.useEffect)((function(){!h&&k&&k.apiKey&&(v(!0),S(Number(k.apiPort)||9170,String(k.apiKey)))}),[h,S,k]),(0,u.useEffect)((function(){if(!x&&Z.isReady){var e=Number(k.volume);switch(t){default:break;case"audio":var n;g({autoplay:"true"===(null===(n=k.autoplay)||void 0===n?void 0:n.toLowerCase()),muted:!1,playing:!1,loaded:!1,position:0,duration:1,source:{type:"audio",source:k.url,album:k.album||"Unknown Album",artist:k.artist||"Unknown Aritst",cover:k.cover,title:k.title||"Unknown Title",volumeInitial:(e>0?e:40)/100},volume:(e>0?e:40)/100});break;case"video":var o;g({autoplay:"true"===(null===(o=k.autoplay)||void 0===o?void 0:o.toLowerCase()),muted:!1,playing:!1,loaded:!1,position:0,duration:1,source:{type:"video",source:String(k.url),volumeInitial:(e>0?e:40)/100},volume:(e>0?e:40)/100})}}}),[x,g,t,Z,k]),(0,u.useEffect)((function(){if(x){var e;b&&"audio"===(e=(0,d.cloneDeep)(b)).source.type&&delete e.source.cover;var t=(0,d.cloneDeep)(x);if("audio"===t.source.type&&delete t.source.cover,!(0,d.isEqual)(t,e)){if(console.log("Player update\n\npreviousStatus:",e,"\nnewStatus:",t),!t.loaded)return;if(!I)return;if(!I.isConnected())return v(!1),void console.warn("WebSocket not connected");I.sendPlayerStatus(t)}}}),[x,b]);var j=(0,u.useMemo)((function(){if(x)return x.source.type}),[x]);return(0,c.jsx)(c.Fragment,{children:"audio"===j?(0,c.jsx)(C,{}):"video"===j?(0,c.jsx)(_,{}):""})}},3564:function(e,t,n){n.d(t,{I0:function(){return c},XI:function(){return l},nn:function(){return u}});var o=n(603),i=n(5893),r=n(7294),s=(0,r.createContext)(void 0),a=(0,r.createContext)(null),c=function(e){var t=e.children,n=(0,r.useState)(),o=n[0],c=n[1];return(0,i.jsx)(a.Provider,{value:c,children:(0,i.jsx)(s.Provider,{value:o,children:t})})},u=function(){var e=(0,r.useContext)(s),t=(0,r.useContext)(a);if(null===t)throw new Error;return[e,t]};function l(){var e=(0,o.Z)(r.useState(!1),2),t=e[0],n=e[1],i=r.useCallback((function(){return n(!0)}),[]),s=r.useCallback((function(){return n(!1)}),[]),a=r.useRef();return[r.useCallback((function(e){a.current&&(a.current.removeEventListener("mouseover",i),a.current.removeEventListener("mouseout",s)),a.current=e,a.current&&(a.current.addEventListener("mouseover",i),a.current.addEventListener("mouseout",s))}),[i,s]),t]}}}]);