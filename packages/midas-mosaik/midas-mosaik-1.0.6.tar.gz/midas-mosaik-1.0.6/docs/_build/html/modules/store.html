
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>MIDAS Store Module &#8212; MIDAS  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MIDAS Timesim Module" href="timesim.html" />
    <link rel="prev" title="Overview of MIDAS’ Default Modules" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="midas-store-module">
<h1>MIDAS Store Module<a class="headerlink" href="#midas-store-module" title="Permalink to this headline">¶</a></h1>
<p>The <em>store</em> module, provided by the <cite>midas-store</cite> package, contains a simple database simulator.
It is simple in that regard that only a simple <em>Hierarchical Document Format</em> (HDF) database will be used to store the data.
Furthermore, <em>pandas</em> and <em>pytables</em> are used to allow pandas dataframes to be saved directly to the HDF file.
This makes it convenient to use inside of python code or a Jupyter notebook but on the otherside it gets more complicated to read the HDF file with a common HDF viewer application.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>This package will usually installed automatically together with <cite>midas-mosaik</cite>. It is available on pypi, so you can install it manually with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install midas-store
</pre></div>
</div>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The intended use-case for the store is to be used inside of MIDAS.
However, it only depends on the <cite>midas-util</cite> package and be used in any mosaik simulation scenario.</p>
<section id="inside-of-midas">
<h3>Inside of MIDAS<a class="headerlink" href="#inside-of-midas" title="Permalink to this headline">¶</a></h3>
<p>To use the store inside of MIDAS, simply add <cite>store</cite> to your modules</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">my_scenario</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">modules</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">store</span><span class="w"></span>
<span class="w">    </span><span class="c1"># - ...</span><span class="w"></span>
</pre></div>
</div>
<p>and configure it with:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">my_scenario</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># ...</span><span class="w"></span>
<span class="w">  </span><span class="nt">store_params</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_db.hdf5</span><span class="w"></span>
</pre></div>
</div>
<p>All of the core simulators that have something to store will then automatically connect to the <em>store</em> simulator.
However, the store does not support scopes.
Implicitly, the scope <em>database</em> will be created and used.</p>
</section>
<section id="any-mosaik-scenario">
<h3>Any Mosaik Scenario<a class="headerlink" href="#any-mosaik-scenario" title="Permalink to this headline">¶</a></h3>
<p>If you don’t use MIDAS, you can add the <cite>store</cite> manually to your mosaik scenario file. First, the entry in the <cite>sim_config</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sim_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;MidasHdf&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;python&quot;</span><span class="p">:</span> <span class="s2">&quot;midas.modules.store.simulator:MidasHdf5&quot;</span><span class="p">},</span>
    <span class="c1"># ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, you need to start the simulator (assuming a <cite>step_size</cite> of 900):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">store_sim</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s2">&quot;MidasHdf&quot;</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, the model needs to be started:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">store_sim</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;path/to/my_db.hdf5&quot;</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keep_old_files</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Afterwards, you can define <cite>world.connect(other_entity, store, attrs)</cite> as you like.</p>
</section>
</section>
<section id="the-keys-of-the-store">
<h2>The Keys of the Store<a class="headerlink" href="#the-keys-of-the-store" title="Permalink to this headline">¶</a></h2>
<p>This section gives a short description for all of the keys of the <em>store</em> module.
Keys that are part of every upgrade module will only be mentioned if the actual behavior might be unexpected.</p>
<dl class="simple">
<dt>step_size</dt><dd><p>While the <em>step_size</em> works as expected, the implications might not be directly clear.
When <em>step_size</em> is set to 1, the store will step in every step.
In each step, mosaik passes all the outputs from all simulators connected to the store as inputs.
When other simulators did not perform a step between two store steps, the store will receive the same data from those simulators until they stepped again.
Therefore, it does not make sense to step the store every second.
On the other side, if the step size of the store is larger than those of the simulators, only the latest step results will be passed to the store.
A good rule-of-thumb would be to set the step size to be the same as the simulator with smallest step size that passes relevant data to the store.
Since the default step size of MIDAS is 900, this step size works as well for the store.</p>
</dd>
<dt>filename</dt><dd><p>This key defines the name of the database file.
A database file with that name will be created inside of the <em>_outputs</em> directory defined in the <em>midas-runtime-conf.yml</em>.
The value is of type string</p>
</dd>
<dt>overwrite</dt><dd><p>This key controls the behavior of the store when the filename is already present in the <em>_outputs</em> directory.
The value is of type bool.
If it set to <em>true</em>, the existing file will be move to <em>existing_db.hdf5.old</em> and the store will use the filename defined by the corresponding key.
If will not check if <em>existing_db.hdf5.old</em> already exists and will overwrite that file.
Otherwise, the store will try to find a new filename by adding an increment, e.g., <em>existing_db_2.hdf5</em>.
The default value is <em>false</em>.</p>
</dd>
<dt>buffer_size</dt><dd><p>This key can be used to control how the store will save the data into the database.
The value if of type integer and defaults to 0, i.e., the store will collect all data from the simulation and will save everything to disk once the simulation is finished.
In very large and long-running simulations, that behavior might be undesirable and the <em>buffer_size</em> can be used to change this.
A <em>buffer_size</em> of, e.g., 1000 will force the store to save the collected data every 1000 steps to the disk.
In that regard, the 1000 actually means 1000 calls of the stores’ <em>step</em> function, not simulation steps.
The store uses threads to perform that action, so you should not notice any performance issues.
However, it is recommended to not set the <em>buffer_size</em> too low.</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">MIDAS</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../next_steps.html">Next Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Scenario Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Overview of MIDAS’ Default Modules</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">MIDAS Store Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="timesim.html">MIDAS Timesim Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="powergrid.html">MIDAS Powergrid Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="sndata.html">MIDAS Smart Nord Data Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="comdata.html">MIDAS Commercial Data Simulator</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Overview of MIDAS’ Default Modules</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Overview of MIDAS’ Default Modules</a></li>
      <li>Next: <a href="timesim.html" title="next chapter">MIDAS Timesim Module</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Stephan Balduin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/modules/store.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>