(this["webpackJsonpstreamlit-fesion"]=this["webpackJsonpstreamlit-fesion"]||[]).push([[0],{71:function(e,t,r){"use strict";r.r(t);var n=r(3),a=r.n(n),i=r(49),s=r.n(i),o=r(96),c=r(51),u=r(95),d=r(30),l=r(8),f=function(e){var t=Object(d.useRenderData)().theme;if(null==t)return Object(l.jsx)(l.Fragment,{children:"props.children"});var r=Object(c.a)({palette:{primary:{main:t.primaryColor},background:{default:t.backgroundColor,paper:t.secondaryBackgroundColor},text:{primary:t.textColor}},typography:{fontFamily:t.font}});return Object(l.jsx)(u.a,{theme:r,children:e.children})},h=r(2),p=r.n(h),j=r(5),m=r(9),v=r(92),b=r(97),g=r(94);function y(e){e.getTracks().forEach((function(e){e.stop()}))}var O=r(27),k=function(e){var t=Object(n.useRef)(null),r=e.imageData;return Object(n.useEffect)((function(){if(null!=t.current){var e=t.current;return e.width=r.width,e.height=r.height,O.Streamlit.setFrameHeight(),function(){O.Streamlit.setFrameHeight()}}}),[r.width,r.height]),Object(n.useEffect)((function(){if(null!=t.current){var e=t.current.getContext("2d");null===e||void 0===e||e.putImageData(r,0,0)}}),[r]),Object(l.jsx)("canvas",{ref:t})};function w(e){return O.Streamlit.setComponentValue(e)}var x=r(0),C=r(1);function D(){return new Worker(r.p+"static/js/fesion.worker.82af06f5.js")}var E=function(){function e(t){var r=this;Object(x.a)(this,e),this.worker=void 0,this.workerInitialData=void 0,this._isLoaded=void 0,this.workerInitialData={funcName:t.funcName,funcDefPyCode:t.funcDefPyCode,requirements:t.requirements},this._isLoaded=!1,this.worker=new D,this.worker.onmessage=function(e){r._processWorkerMessage(e.data)}}return Object(C.a)(e,[{key:"isLoaded",get:function(){return this._isLoaded}},{key:"_processWorkerMessage",value:function(e){switch(e.type){case"ready":this.postInitialData();break;case"loaded":this._isLoaded=!0}}},{key:"postInitialData",value:function(){var e={type:"initData",data:this.workerInitialData};this.worker.postMessage(e)}},{key:"_asyncPostMessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reply";return new Promise((function(n,a){var i=new MessageChannel;i.port1.onmessage=function(e){i.port1.close();var t=e.data;if(t.error)a(t.error);else{if(t.type!==r)throw new Error('Unexpected reply type "'.concat(t.type,'"'));n(t.data)}},t.worker.postMessage(e,[i.port2])}))}},{key:"process",value:function(e){return this._isLoaded?this._asyncPostMessage({type:"inputImage",data:{imageData:e}},"outputImage").then((function(e){return e.imageData})):(console.debug("Worker is not loaded"),Promise.resolve(e))}},{key:"updateFuncCode",value:function(e){return this._asyncPostMessage({type:"updateFilterFunc",data:e})}}]),e}(),_=function(){var e,t=Object(d.useRenderData)(),r=t.args.func_def_code,a=t.args.func_name,i=null!==(e=t.args.dep_packages)&&void 0!==e?e:[],s=JSON.stringify(i.sort()),o=Object(n.useState)(),c=Object(m.a)(o,2),u=c[0],f=c[1];Object(n.useEffect)((function(){w({pythonError:null});var e=JSON.parse(s),t=new E({funcName:a,funcDefPyCode:r,requirements:e});f(t)}),[]),Object(n.useEffect)((function(){if(null!=u&&u.isLoaded){w({pythonError:null});var e=JSON.parse(s)||[];u.updateFuncCode({funcName:a,funcDefPyCode:r,requirements:e})}}),[u,a,r,s]);var h=Object(n.useState)(),O=Object(m.a)(h,2),x=O[0],C=O[1],D=Object(n.useState)(!1),_=Object(m.a)(D,2),F=_[0],I=_[1],P=Object(n.useCallback)((function(){return I(!0)}),[]),S=Object(n.useCallback)((function(){I(!1),C(void 0)}),[]),M=Object(n.useRef)(!1);M.current=F;var L=Object(n.useCallback)(function(){var e=Object(j.a)(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=u&&u.isLoaded){e.next=3;break}return C(t),e.abrupt("return");case 3:return e.prev=3,e.next=6,u.process(t);case 6:if(r=e.sent,M.current){e.next=10;break}return C(void 0),e.abrupt("return");case 10:C(r),e.next=18;break;case 13:throw e.prev=13,e.t0=e.catch(3),"string"===typeof e.t0.stack&&e.t0.stack.startsWith("PythonError")&&w({pythonError:{stack:e.t0.stack,message:e.t0.message}}),I(!1),e.t0;case 18:case"end":return e.stop()}}),e,null,[[3,13]])})));return function(t){return e.apply(this,arguments)}}(),[u]);return function(e){var t=e.playing,r=e.videoConstraints,a=e.onFrame,i=Object(n.useRef)(a);i.current=a,Object(n.useEffect)((function(){if(t){var e=!1,n=document.createElement("video"),a=document.createElement("canvas"),s=a.getContext("2d");if(null==s)throw new Error("Failed to get a canvas context.");var o=void 0,c=function(){var t=Object(j.a)(p.a.mark((function t(){var r;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=2;break}return t.abrupt("return");case 2:if(n.paused||n.currentTime===o){t.next=8;break}return o=n.currentTime,s.drawImage(n,0,0),r=s.getImageData(0,0,a.width,a.height),t.next=8,i.current(r);case 8:window.requestAnimationFrame(c);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),u=null;return navigator.mediaDevices.getUserMedia({video:r,audio:!1}).then((function(t){e?y(t):(u=t,n.onloadedmetadata=function(){e||(a.width=n.videoWidth,a.height=n.videoHeight,n.play(),window.requestAnimationFrame(c))},n.srcObject=u)})),function(){e=!0,n.pause(),n.remove(),a.remove(),u&&y(u)}}}),[t,r])}({playing:F,videoConstraints:!0,onFrame:L}),Object(l.jsxs)(g.a,{children:[Object(l.jsxs)(g.a,{position:"relative",display:"inline-block",children:[F&&(null==u||!u.isLoaded)&&Object(l.jsx)(g.a,{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:Object(l.jsx)(b.a,{size:80})}),Object(l.jsx)(g.a,{children:x&&Object(l.jsx)(k,{imageData:x})})]}),Object(l.jsx)(g.a,{children:F?Object(l.jsx)(v.a,{variant:"contained",onClick:S,children:"Stop"}):Object(l.jsx)(v.a,{variant:"contained",onClick:P,children:"Play"})})]})};s.a.render(Object(l.jsxs)(a.a.StrictMode,{children:[Object(l.jsx)(o.a,{}),Object(l.jsx)(d.StreamlitProvider,{children:Object(l.jsx)(f,{children:Object(l.jsx)(_,{})})})]}),document.getElementById("root"))}},[[71,1,2]]]);
//# sourceMappingURL=main.9a06663b.chunk.js.map