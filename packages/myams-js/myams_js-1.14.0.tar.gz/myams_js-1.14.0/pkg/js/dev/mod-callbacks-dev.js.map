{"version":3,"file":"mod-callbacks-dev.js","names":["$","MyAMS","_initialized","callbacks","init","initElement","element","Promise","resolve","reject","deferred","each","idx","elt","data","amsCallback","JSON","parse","e","split","isArray","callback","callname","callable","source","options","core","getFunctionByName","amsCallbackOptions","unserialize","push","getScript","then","console","warn","call","document","when","apply","window","env","bundle","config","modules","debug"],"sources":["mod-callbacks.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS callbacks management\n */\n\nconst $ = MyAMS.$;\n\nlet _initialized = false;\n\n\nexport const callbacks = {\n\n\tinit: () => {\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\t},\n\n\tinitElement: (element) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst deferred = [];\n\t\t\t$('[data-ams-callback]', element).each((idx, elt) => {\n\t\t\t\tconst data = $(elt).data();\n\t\t\t\tlet callbacks = data.amsCallback;\n\t\t\t\tif (typeof callbacks === 'string') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcallbacks = JSON.parse(data.amsCallback);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tcallbacks = data.amsCallback.split(/[\\s,;]+/);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!$.isArray(callbacks)) {\n\t\t\t\t\tcallbacks = [callbacks];\n\t\t\t\t}\n\t\t\t\tfor (const callback of callbacks) {\n\t\t\t\t\tlet callname, callable, source, options;\n\t\t\t\t\tif (typeof callback === 'string') {\n\t\t\t\t\t\tcallname = callback;\n\t\t\t\t\t\tcallable = MyAMS.core.getFunctionByName(callname);\n\t\t\t\t\t\tsource = data.amsCallbackOptions;\n\t\t\t\t\t\toptions = data.amsCallbackOptions;\n\t\t\t\t\t\tif (typeof options === 'string') {\n\t\t\t\t\t\t\toptions = options.unserialize();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {  // JSON object\n\t\t\t\t\t\tcallname = callback.callback;\n\t\t\t\t\t\tcallable = MyAMS.core.getFunctionByName(callname);\n\t\t\t\t\t\tsource = callback.source;\n\t\t\t\t\t\toptions = callback.options;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof callable === 'undefined') {\n\t\t\t\t\t\tif (source) {\n\t\t\t\t\t\t\tdeferred.push(MyAMS.core.getScript(source).then(() => {\n\t\t\t\t\t\t\t\tcallable = MyAMS.core.getFunctionByName(callname);\n\t\t\t\t\t\t\t\tif (typeof callable === 'undefined') {\n\t\t\t\t\t\t\t\t\tconsole.warn(`Missing callback ${callname}!`);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcallable.call(document, elt, options);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.warn(`Missing source for undefined callback ${callback}!`)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.push(Promise.resolve(callable.call(document, elt, options)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t$.when.apply($, deferred).then(resolve, reject);\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('callbacks');\n\t} else {\n\t\tMyAMS.callbacks = callbacks;\n\t\tconsole.debug(\"MyAMS: callbacks module loaded...\");\n\t}\n}\n"],"mappings":"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"}