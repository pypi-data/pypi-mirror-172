{"version":3,"file":"mod-error-dev.js","names":["$","MyAMS","ERRORS_TEMPLATE_STRING","ERROR_TEMPLATE","templates","markup","allowCode","error","showErrors","parent","errors","Promise","resolve","reject","require","then","alert","status","header","i18n","ERROR_OCCURED","message","isArray","ERRORS_OCCURED","form","clearAlerts","messages","push","widget","widgets","label","length","props","render","prependTo","input","id","name","exists","setInvalid","scrollBox","parents","helpers","scrollTo","offset","showHTTPError","messageBox","title","hideTimestamp","timeout","window","env","bundle","config","modules","console","debug"],"sources":["mod-error.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS errors management\n */\n\nimport 'jsrender';\n\nconst $ = MyAMS.$;\n\n\nconst ERRORS_TEMPLATE_STRING = `\n\t<div class=\"alert alert-{{:status}}\" role=\"alert\">\n\t\t<button type=\"button\" class=\"close\" data-dismiss=\"alert\" \n\t\t\t\taria-label=\"{{*: MyAMS.i18n.BTN_CLODE }}\">\n\t\t\t<i class=\"fa fa-times\" aria-hidden=\"true\"></i>\t\n\t\t</button>\n\t\t{{if header}}\n\t\t<h5 class=\"alert-heading\">{{:header}}</h5>\n\t\t{{/if}}\n\t\t{{if message}}\n\t\t<p>{{:message}}</p>\n\t\t{{/if}}\n\t\t{{if messages}}\n\t\t<ul>\n\t\t{{for messages}}\n\t\t\t<li>\n\t\t\t\t{{if header}}<strong>{{:header}} :</strong>{{/if}}\n\t\t\t\t{{:message}}\n\t\t\t</li>\n\t\t{{/for}}\n\t\t</ul>\n\t\t{{/if}}\n\t\t{{if widgets}}\n\t\t<ul>\n\t\t{{for widgets}}\n\t\t\t<li>\n\t\t\t\t{{if header}}<strong>{{:header}} :</strong>{{/if}}\n\t\t\t\t{{:message}}\n\t\t\t</li>\n\t\t{{/for}}\n\t\t</ul>\n\t\t{{/if}}\n\t</div>`;\n\nconst ERROR_TEMPLATE = $.templates({\n\tmarkup: ERRORS_TEMPLATE_STRING,\n\tallowCode: true\n});\n\n\nexport const error = {\n\n\t/**\n\t * Show errors as alert in given parent\n\t *\n\t * @param parent: alert parent element\n\t * @param errors: errors properties\n\t */\n\tshowErrors: (parent, errors) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (typeof errors === 'string') {  // simple error message\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\tmessage: errors\n\t\t\t\t\t});\n\t\t\t\t}).then(resolve, reject);\n\t\t\t} else if ($.isArray(errors)) {  // array of messages\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: MyAMS.i18n.ERRORS_OCCURED,\n\t\t\t\t\t\tmessage: errors\n\t\t\t\t\t});\n\t\t\t\t}).then(resolve, reject);\n\t\t\t} else {  // full errors with widgets\n\t\t\t\tMyAMS.require('i18n', 'ajax', 'alert', 'form').then(() => {\n\t\t\t\t\t// clear previous alerts\n\t\t\t\t\tMyAMS.form.clearAlerts(parent);\n\t\t\t\t\t// create new alert\n\t\t\t\t\tconst messages = [];\n\t\t\t\t\tfor (const message of errors.messages || []) {\n\t\t\t\t\t\tif (typeof message === 'string') {\n\t\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\t\theader: null,\n\t\t\t\t\t\t\t\tmessage: message\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmessages.push(message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const widget of errors.widgets || []) {\n\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\theader: widget.label,\n\t\t\t\t\t\t\tmessage: widget.message\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst\n\t\t\t\t\t\theader = errors.header ||\n\t\t\t\t\t\t\t(messages.length > 1 ? MyAMS.i18n.ERRORS_OCCURED : MyAMS.i18n.ERROR_OCCURED),\n\t\t\t\t\t\tprops = {\n\t\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\t\theader: header,\n\t\t\t\t\t\t\tmessage: errors.error || null,\n\t\t\t\t\t\t\tmessages: messages\n\t\t\t\t\t\t};\n\t\t\t\t\t$(ERROR_TEMPLATE.render(props)).prependTo(parent);\n\t\t\t\t\t// update status of invalid widgets\n\t\t\t\t\tfor (const widget of errors.widgets || []) {\n\t\t\t\t\t\tlet input;\n\t\t\t\t\t\tif (widget.id) {\n\t\t\t\t\t\t\tinput = $(`#${widget.id}`, parent);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinput = $(`[name=\"${widget.name}\"]`, parent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (input.exists()) {\n\t\t\t\t\t\t\tMyAMS.form.setInvalid(parent, input, widget.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tMyAMS.require('helpers').then(() => {\n\t\t\t\t\t\tlet scrollBox = parent.parents('.modal-body');\n\t\t\t\t\t\tif (!scrollBox.exists()) {\n\t\t\t\t\t\t\tscrollBox = $('#main');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tMyAMS.helpers.scrollTo(scrollBox, parent, { offset: -15 });\n\t\t\t\t\t});\n\t\t\t\t}).then(resolve, reject);\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Display message for standard HTTP error\n\t *\n\t * @param error: error object\n\t */\n\tshowHTTPError: (error) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tMyAMS.require('alert').then(() => {\n\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t\ttitle: error.title,\n\t\t\t\t\tmessage: error.message,\n\t\t\t\t\thideTimestamp: false,\n\t\t\t\t\ttimeout: 0\n\t\t\t\t});\n\t\t\t}).then(resolve, reject);\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('error');\n\t} else {\n\t\tMyAMS.error = error;\n\t\tconsole.debug(\"MyAMS: error module loaded...\");\n\t}\n}\n"],"mappings":"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"}