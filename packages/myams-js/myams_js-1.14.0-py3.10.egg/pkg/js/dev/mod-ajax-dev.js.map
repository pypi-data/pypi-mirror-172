{"version":3,"file":"mod-ajax-dev.js","names":["$","MyAMS","checkCsrfHeader","request","window","Cookies","token","get","config","csrfCookieName","setRequestHeader","csrfHeaderName","ajax","check","checker","source","Promise","resolve","reject","deferred","undefined","Array","src","push","core","getScript","forEach","elt","idx","when","apply","then","length","getAddr","addr","href","attr","location","substring","lastIndexOf","start","show","stop","hide","progress","event","lengthComputable","loaded","total","console","debug","Math","round","url","params","options","startsWith","protocol","defaults","type","cache","data","param","dataType","beforeSend","settings","extend","result","status","xhr","error","post","getJSON","handleJSON","getResponse","contentType","getResponseHeader","responseXML","e","responseText","responseJSON","JSON","parse","alert","title","i18n","ERROR_OCCURED","content","NO_SERVER_RESPONSE","form","target","closeForm","require","resetChanged","modal","close","loadTarget","promises","jQuery","showErrors","open","hash","skin","loadURL","preLoadCallback","getFunctionByName","preReload","each","index","element","executeFunctionByName","preLoadCallbackOptions","preReloadOptions","afterLoadCallback","postReload","afterLoadCallbackOptions","postReloadOptions","endsWith","replace","off","reload","code","showHTTPError","warn","container","html","text","initContent","document","keepHidden","removeClass","contents","message","smallBox","icon","timeout","parent","header","subtitle","messagebox","messageBox","smallbox","trigger","eventOptions","events","callback","callbacks","module","all","response","statusText","toUpperCase","x_ams_handled","parsedResponse","jest","env","baseURL","extext","ajaxSettings","ajaxSetup","safeMethods","indexOf","progressUpload","addEventListener","evt","ajaxStart","ajaxStop","ajaxError","bundle","modules"],"sources":["mod-ajax.js"],"sourcesContent":["/* global jQuery, MyAMS, Cookies */\n/**\n * MyAMS AJAX features\n */\n\nconst $ = MyAMS.$;\n\n\n/**\n * CSRF cookie checker\n *\n * Automatically set CSRF request header when CSRF cookie was specified.\n *\n * @param request: outgoing request\n */\nfunction checkCsrfHeader(request /*, options */) {\n\tif (window.Cookies) {\n\t\tconst token = Cookies.get(MyAMS.config.csrfCookieName);\n\t\tif (token) {\n\t\t\trequest.setRequestHeader(MyAMS.config.csrfHeaderName, token);\n\t\t}\n\t}\n}\n\n\nexport const ajax = {\n\n\t/**\n\t * Check for a given feature, and download script if necessary\n\t *\n\t * @param checker: pointer to a resource which will be downloaded if undefined\n\t * @param source: URL of a javascript file containing requested resource\n\t */\n\tcheck: (checker, source) => {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tconst deferred = [];\n\n\t\t\tif (checker === undefined) {\n\t\t\t\tif (!(source instanceof Array)) {\n\t\t\t\t\tsource = [source];\n\t\t\t\t}\n\t\t\t\tfor (const src of source) {\n\t\t\t\t\tdeferred.push(MyAMS.core.getScript(src));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!(checker instanceof Array)) {\n\t\t\t\t\tchecker = [checker];\n\t\t\t\t}\n\t\t\t\tchecker.forEach((elt, idx) => {\n\t\t\t\t\tif (elt === undefined) {\n\t\t\t\t\t\tdeferred.push(MyAMS.core.getScript(source[idx]));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t$.when.apply($, deferred).then(() => {\n\t\t\t\tresolve(deferred.length > 0);\n\t\t\t}, reject);\n\t\t});\n\t},\n\n\t/**\n\t * Get AJAX URL relative to current page\n\t *\n\t * @param addr\n\t */\n\tgetAddr: (addr) => {\n\t\tconst href = addr || $('html head base').attr('href') || window.location.href;\n\t\treturn href.substring(0, href.lastIndexOf('/') + 1);\n\t},\n\n\t/**\n\t * JQuery AJAX start callback\n\t */\n\tstart: () => {\n\t\t$('#ajax-gear').show();\n\t},\n\n\t/**\n\t * JQuery AJAX stop callback\n\t */\n\tstop: () => {\n\t\t$('#ajax-gear').hide();\n\t},\n\n\t/**\n\t * Handle AJAX upload or download progress event\n\t *\n\t * @param event: source event\n\t */\n\tprogress: (event) => {\n\t\tif (!event.lengthComputable) {\n\t\t\treturn;\n\t\t}\n\t\tif (event.loaded >= event.total) {\n\t\t\treturn;\n\t\t}\n\t\tif (console) {\n\t\t\tconsole.debug && console.debug(`${Math.round(event.loaded / event.total * 100)}%`);\n\t\t}\n\t},\n\n\t/**\n\t * Get data from given URL.\n\t * This is a simple wrapper around JQuery AJAX api to keep MyAMS API consistent\n\t *\n\t * @param url: target URL\n\t * @param params: url params\n\t * @param options: AJAX call options\n\t */\n\tget: (url, params, options) => {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tlet addr;\n\t\t\tif (url.startsWith(window.location.protocol)) {\n\t\t\t\taddr = url;\n\t\t\t} else {\n\t\t\t\taddr = MyAMS.ajax.getAddr() + url;\n\t\t\t}\n\n\t\t\tconst defaults = {\n\t\t\t\turl: addr,\n\t\t\t\ttype: 'get',\n\t\t\t\tcache: false,\n\t\t\t\tdata: $.param(params || null),\n\t\t\t\tdataType: 'json',\n\t\t\t\tbeforeSend: checkCsrfHeader\n\t\t\t};\n\t\t\tconst settings = $.extend({}, defaults, options);\n\t\t\t$.ajax(settings).then((result, status, xhr) => {\n\t\t\t\tresolve(result, status, xhr);\n\t\t\t}, (xhr, status, error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Post data to given URL\n\t *\n\t * @param url: target URL\n\t * @param data: submit data\n\t * @param options: AJAX call options\n\t */\n\tpost: (url, data, options) => {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tlet addr;\n\t\t\tif (url.startsWith(window.location.protocol)) {\n\t\t\t\taddr = url;\n\t\t\t} else {\n\t\t\t\taddr = MyAMS.ajax.getAddr() + url;\n\t\t\t}\n\n\t\t\tconst defaults = {\n\t\t\t\turl: addr,\n\t\t\t\ttype: 'post',\n\t\t\t\tcache: false,\n\t\t\t\tdata: $.param(data || null),\n\t\t\t\tdataType: 'json',\n\t\t\t\tbeforeSend: checkCsrfHeader\n\t\t\t};\n\t\t\tconst settings = $.extend({}, defaults, options);\n\t\t\t$.ajax(settings).then((result, status, xhr) => {\n\t\t\t\tresolve(result, status, xhr);\n\t\t\t}, (xhr, status, error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Post data to given URL and handle result as JSON\n\t *\n\t * This form of function can be used in MyAMS \"href\" or \"data-ams-url\" attributes, like in\n\t * <a href=\"MyAMS.ajax.getJSON?url=...\">Click me!</a>.\n\t */\n\tgetJSON: () => {\n\t\treturn (source, options) => {\n\t\t\tconst url = options.url;\n\t\t\tdelete options.url;\n\t\t\treturn MyAMS.ajax.post(url, options).then(MyAMS.ajax.handleJSON);\n\t\t}\n\t},\n\n\t/**\n\t * Extract datatype and result from response object\n\t */\n\tgetResponse: (request) => {\n\t\tlet dataType = 'unknown',\n\t\t\tresult;\n\t\tif (request) {\n\t\t\tlet contentType = request.getResponseHeader('content-type');\n\t\t\tif (!contentType) {\n\t\t\t\ttry {\n\t\t\t\t\tcontentType = request.responseXML.contentType;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcontentType = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (contentType) {\n\t\t\t\t// Get server response\n\t\t\t\tif (contentType.startsWith('application/javascript')) {\n\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\tdataType = 'script';\n\t\t\t\t} else if (contentType.startsWith('text/html')) {\n\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\tdataType = 'html';\n\t\t\t\t} else if (contentType.startsWith('text/xml')) {\n\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\tdataType = 'xml';\n\t\t\t\t} else {\n\t\t\t\t\t// Supposed to be JSON...\n\t\t\t\t\tresult = request.responseJSON;\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tdataType = 'json';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = JSON.parse(request.responseText);\n\t\t\t\t\t\t\tdataType = 'json';\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\t\t\tdataType = 'binary';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Probably no response from server...\n\t\t\t\tresult = {\n\t\t\t\t\tstatus: 'alert',\n\t\t\t\t\talert: {\n\t\t\t\t\t\ttitle: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\tcontent: MyAMS.i18n.NO_SERVER_RESPONSE\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdataType = 'json';\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tcontentType: dataType,\n\t\t\tdata: result\n\t\t}\n\t},\n\n\t/**\n\t * Handle a server response in JSON format\n\t *\n\t * Result can be an object with several attributes:\n\t *  - main response status: alert, error, info, success, callback, callbacks, reload or\n\t *    redirect\n\t *  - close_form: boolean indicating if current modal should be closed\n\t *  - location: target URL for reload or redirect status\n\t *  - target: target container selector for loaded content ('#content' by default)\n\t *  - content: available for any status producing output; can be raw HTML, or an object\n\t *    with attributes:\n\t *      - target: target container selector (source form by default)\n\t *      - text or html: raw text or HTML result\n\t *  - message: available for any status producing an output message; an object with\n\t *    attributes:\n\t *      - status: message status\n\t *      -\n\t * @param result: response content\n\t * @param form: source form\n\t * @param target\n\t */\n\thandleJSON: (result, form, target) => {\n\n\t\tfunction closeForm() {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tif (form !== undefined) {\n\t\t\t\t\tMyAMS.require('form').then(() => {\n\t\t\t\t\t\tMyAMS.form.resetChanged(form);\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tif (result.closeForm !== false) {\n\t\t\t\t\t\t\tMyAMS.require('modal').then(() => {\n\t\t\t\t\t\t\t\tMyAMS.modal.close(form);\n\t\t\t\t\t\t\t}).then(resolve, reject);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet url = null,\n\t\t\tloadTarget = null;\n\t\tconst\n\t\t\tstatus = result.status,\n\t\t\tpromises = [];\n\n\t\tif ((target instanceof jQuery) && !target.length) {\n\t\t\ttarget = null;\n\t\t}\n\n\t\tswitch (status) {\n\n\t\t\tcase 'alert':\n\t\t\t\tif (window.alert) {\n\t\t\t\t\tconst alert = result.alert;\n\t\t\t\t\twindow.alert(`${alert.title}\\n\\n${alert.content}`);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'error':\n\t\t\t\tpromises.push(MyAMS.require('error').then(() => {\n\t\t\t\t\tMyAMS.error.showErrors(form, result);\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'message':\n\t\t\tcase 'messagebox':\n\t\t\tcase 'smallbox':\n\t\t\t\tbreak;\n\n\t\t\tcase 'info':\n\t\t\tcase 'success':\n\t\t\tcase 'notify':\n\t\t\tcase 'callback':\n\t\t\tcase 'callbacks':\n\t\t\t\tpromises.push(closeForm());\n\t\t\t\tbreak;\n\n\t\t\tcase 'modal':\n\t\t\t\tpromises.push(MyAMS.require('modal').then(() => {\n\t\t\t\t\tMyAMS.modal.open(result.location);\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'reload':\n\t\t\t\tcloseForm();\n\t\t\t\turl = result.location || window.location.hash;\n\t\t\t\tif (url.startsWith('#')) {\n\t\t\t\t\turl = url.substring(1);\n\t\t\t\t}\n\t\t\t\tloadTarget = $(result.target || target || '#content');\n\t\t\t\tpromises.push(MyAMS.require('skin').then(() => {\n\t\t\t\t\tMyAMS.skin.loadURL(url, loadTarget, {\n\t\t\t\t\t\tpreLoadCallback: MyAMS.core.getFunctionByName(result.preReload || function() {\n\t\t\t\t\t\t\t$('[data-ams-pre-reload]', loadTarget).each((index, element) => {\n\t\t\t\t\t\t\t\tMyAMS.core.executeFunctionByName($(element).data('ams-pre-reload'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tpreLoadCallbackOptions: result.preReloadOptions,\n\t\t\t\t\t\tafterLoadCallback: MyAMS.core.getFunctionByName(result.postReload || function() {\n\t\t\t\t\t\t\t$('[data-ams-post-reload]', loadTarget).each((index, element) => {\n\t\t\t\t\t\t\t\tMyAMS.core.executeFunctionByName($(element).data('ams-post-reload'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tafterLoadCallbackOptions: result.postReloadOptions\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'redirect':\n\t\t\t\tcloseForm();\n\t\t\t\turl = result.location || window.location.href;\n\t\t\t\tif (url.endsWith('##')) {\n\t\t\t\t\turl = url.replace(/##/, window.location.hash);\n\t\t\t\t}\n\t\t\t\tif (result.window) {\n\t\t\t\t\twindow.open(url, result.window, result.options);\n\t\t\t\t} else {\n\t\t\t\t\t$(window).off('beforeunload');\n\t\t\t\t\tif (window.location.href === url) {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t} else {\n\t\t\t\t\t\twindow.location.replace(url);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (result.code) {  // Standard HTTP error?\n\t\t\t\t\tpromises.push(MyAMS.require('error').then(() => {\n\t\t\t\t\t\tMyAMS.error.showHTTPError(result);\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tif (window.console) {\n\t\t\t\t\t\tconsole.warn && console.warn(`Unhandled JSON response status: ${status}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\n\t\t// Single content response\n\t\tif (result.content) {\n\t\t\tconst\n\t\t\t\tcontent = result.content,\n\t\t\t\tcontainer = $(content.target || target || '#content');\n\t\t\tif (typeof content === 'string') {\n\t\t\t\tcontainer.html(content);\n\t\t\t} else {\n\t\t\t\tif (content.text) {\n\t\t\t\t\tcontainer.text(content.text);\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.html(content.html);\n\t\t\t\t}\n\t\t\t\tpromises.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,\n\t\t\t\t\tdocument, container).then(() => {\n\t\t\t\t\tif (!content.keepHidden) {\n\t\t\t\t\t\tcontainer.removeClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\t// Multiple contents response\n\t\tif (result.contents) {\n\t\t\tfor (const content of result.contents) {\n\t\t\t\tconst container = $(content.target);\n\t\t\t\tif (content.text) {\n\t\t\t\t\tcontainer.text(content.text)\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.html(content.html);\n\t\t\t\t}\n\t\t\t\tpromises.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,\n\t\t\t\t\tdocument, container).then(() => {\n\t\t\t\t\tif (!content.keepHidden) {\n\t\t\t\t\t\tcontainer.removeClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\t// Response with message\n\t\tif (result.message && !result.code) {\n\t\t\tpromises.push(MyAMS.require('alert').then(() => {\n\t\t\t\tif (typeof result.message === 'string') {\n\t\t\t\t\tMyAMS.alert.smallBox({\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\tmessage: result.message,\n\t\t\t\t\t\ticon: 'fa-info-circle',\n\t\t\t\t\t\ttimeout: 3000\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst message = result.message;\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: form,\n\t\t\t\t\t\tstatus: message.status || status,\n\t\t\t\t\t\theader: message.header,\n\t\t\t\t\t\tsubtitle: message.subtitle,\n\t\t\t\t\t\tmessage: message.message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Response with message box\n\t\tif (result.messagebox) {\n\t\t\tpromises.push(MyAMS.require('alert').then(() => {\n\t\t\t\tif (typeof result.messagebox === 'string') {\n\t\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\ttitle: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\ticon: 'fa-info-circle',\n\t\t\t\t\t\tmessage: result.messagebox,\n\t\t\t\t\t\ttimeout: 10000\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst message = result.messagebox;\n\t\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\t\tstatus: message.status || status,\n\t\t\t\t\t\ttitle: message.title || MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\ticon: message.icon || 'fa-info-circle',\n\t\t\t\t\t\tmessage: message.message,\n\t\t\t\t\t\tcontent: message.content,\n\t\t\t\t\t\ttimeout: message.timeout === 0 ? 0 : (message.timeout || 10000)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Response with small box\n\t\tif (result.smallbox) {\n\t\t\tpromises.push(MyAMS.require('alert').then(() => {\n\t\t\t\tif (typeof result.smallbox === 'string') {\n\t\t\t\t\tMyAMS.alert.smallBox({\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\tmessage: result.smallbox,\n\t\t\t\t\t\ticon: 'fa-info-circle',\n\t\t\t\t\t\ttimeout: 3000\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst message = result.smallbox;\n\t\t\t\t\tMyAMS.alert.smallBox({\n\t\t\t\t\t\tstatus: message.status || status,\n\t\t\t\t\t\tmessage: message.message,\n\t\t\t\t\t\tcontent: message.content,\n\t\t\t\t\t\ticon: message.icon || 'fa-info-circle',\n\t\t\t\t\t\ttimeout: message.timeout\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Response with single event\n\t\tif (result.event) {\n\t\t\tform.trigger(result.event, result.eventOptions);\n\t\t}\n\n\t\t// Response with multiple events\n\t\tif (result.events) {\n\t\t\tfor (const event of result.events) {\n\t\t\t\tif (typeof event === 'string') {\n\t\t\t\t\tform.trigger(event, result.eventOptions);\n\t\t\t\t} else {\n\t\t\t\t\tform.trigger(event.event, event.options);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Response with single callback\n\t\tif (result.callback) {\n\t\t\tpromises.push(MyAMS.core.executeFunctionByName(result.callback, document, form,\n\t\t\t\tresult.options));\n\t\t}\n\n\t\t// Response with multiple callbacks\n\t\tif (result.callbacks) {\n\t\t\tfor (const callback of result.callbacks) {\n\t\t\t\tif (typeof callback === 'string') {\n\t\t\t\t\tpromises.push(MyAMS.core.executeFunctionByName(callback, document, form,\n\t\t\t\t\t\tresult.options));\n\t\t\t\t} else {\n\t\t\t\t\tpromises.push(MyAMS.require(callback.module || []).then(() => {\n\t\t\t\t\t\tMyAMS.core.executeFunctionByName(callback.callback, document,\n\t\t\t\t\t\t\tform, callback.options)\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.all(promises);\n\t},\n\n\t/**\n\t * JQuery AJAX error handler\n\t */\n\terror: (event, response, request, error) => {\n\t\t// user shouldn't be notified of aborted requests\n\t\tif (error === 'abort') {\n\t\t\treturn;\n\t\t}\n\t\t// don't display errors on OK status\n\t\tif (response && response.statusText && response.statusText.toUpperCase() === 'OK') {\n\t\t\treturn;\n\t\t}\n\t\t// don't display errors twice (via AJAX HTTP error handler and JSON response)\n\t\tif (response.x_ams_handled === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst parsedResponse = MyAMS.ajax.getResponse(response);\n\t\tif (parsedResponse) {\n\t\t\tif (parsedResponse.contentType === 'json') {\n\t\t\t\tMyAMS.ajax.handleJSON(parsedResponse.data);\n\t\t\t\tresponse.x_ams_handled = true;\n\t\t\t} else {\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tconst\n\t\t\t\t\t\ttitle = error || event.statusText || event.type,\n\t\t\t\t\t\tmessage = parsedResponse.responseText;\n\t\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\ttitle: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\tcontent: `<h4>${title}</h4><p>${message || ''}</p>`,\n\t\t\t\t\t\ticon: 'fa-exclamation-triangle',\n\t\t\t\t\t\ttimeout: 5000\n\t\t\t\t\t});\n\t\t\t\t}, () => {\n\t\t\t\t\tif (window.console) {\n\t\t\t\t\t\tconsole.error && console.error(event);\n\t\t\t\t\t\tconsole.debug && console.debug(parsedResponse);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tif (window.console) {\n\t\t\t\tconsole.error && console.error(\"ERROR: Can't parse response!\");\n\t\t\t\tconsole.debug && console.debug(response);\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n/**\n * AJAX events callbacks\n */\nif (typeof jest === 'undefined') {\n\t// don't check cookies extension in test mode!\n\tajax.check(window.Cookies, `${MyAMS.env.baseURL}../ext/js-cookie${MyAMS.env.extext}.js`)\n\t\t.then(() => {\n\t\t\tconst xhr = $.ajaxSettings.xhr;\n\t\t\t$.ajaxSetup({\n\t\t\t\tbeforeSend: (request, options) => {\n\t\t\t\t\tif (MyAMS.config.safeMethods.indexOf(options.type) < 0) {\n\t\t\t\t\t\tif (window.Cookies !== undefined) {\n\t\t\t\t\t\t\tconst token = Cookies.get(MyAMS.config.csrfCookieName);\n\t\t\t\t\t\t\tif (token) {\n\t\t\t\t\t\t\t\trequest.setRequestHeader(MyAMS.config.csrfHeaderName, token);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprogress: ajax.progress,\n\t\t\t\tprogressUpload: ajax.progress,\n\t\t\t\txhr: function() {\n\t\t\t\t\tconst request = xhr();\n\t\t\t\t\tif (request && (typeof request.addEventListener === 'function')) {\n\t\t\t\t\t\tif (ajax.progress) {\n\t\t\t\t\t\t\trequest.addEventListener('progress', (evt) => {\n\t\t\t\t\t\t\t\tMyAMS.ajax.progress(evt);\n\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn request;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n}\n\n$(document).ajaxStart(ajax.start);\n$(document).ajaxStop(ajax.stop);\n$(document).ajaxError(ajax.error);\n\n\n/**\n * Global module initialization\n */\nif (MyAMS.env.bundle) {\n\tMyAMS.config.modules.push('ajax');\n} else {\n\tMyAMS.ajax = ajax;\n\tconsole.debug(\"MyAMS: AJAX module loaded...\");\n}\n"],"mappings":"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"}