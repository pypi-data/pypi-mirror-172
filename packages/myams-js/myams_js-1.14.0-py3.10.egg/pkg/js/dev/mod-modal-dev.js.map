{"version":3,"file":"mod-modal-dev.js","names":["$","MyAMS","_initialized","modalToggleEventHandler","evt","Promise","resolve","reject","source","currentTarget","handlers","data","attr","hasClass","stopPropagation","preventDefault","tooltip","modal","open","then","modalShownEventHandler","zIndexModal","dialog","target","visibleModalsCount","length","zIndex","css","setTimeout","not","first","addClass","off","on","handler","modalDismissEventHandler","core","executeFunctionByName","document","dynamicModalShowEventHandler","config","initContent","dynamicModalShownEventHandler","require","form","setFocus","parents","confirmChangedForm","status","modalHiddenEventHandler","fn","Constructor","prototype","_checkScrollbar","_setScrollbar","dynamicModalHiddenEventHandler","clearContent","remove","init","ajaxNav","options","sourceData","url","amsUrl","urlGetter","getFunctionByName","startsWith","ajax","type","cache","amsAllowCache","undefined","request","response","getResponse","dataType","contentType","result","content","dialogData","dialogOptions","settings","handleJSON","wrap","parent","backdrop","keyboard","extend","amsOptions","amsInit","append","stats","amsLogEvent","logPageview","fitWidthToImage","image","exists","padding","width","Math","min","window","get","naturalWidth","close","element","objectOrParentWithClass","env","bundle","modules","push","console","debug"],"sources":["mod-modal.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS modal dialogs support\n */\n\nconst $ = MyAMS.$;\n\n\nlet _initialized = false;\n\n\n/*\n * Standard data-toggle=\"modal\" handler\n */\nexport function modalToggleEventHandler(evt) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst\n\t\t\tsource = $(evt.currentTarget),\n\t\t\thandlers = source.data('ams-disabled-handlers');\n\t\tif (source.attr('disabled') ||\n\t\t\tsource.hasClass('disabled') ||\n\t\t\t(handlers === true) ||\n\t\t\t(handlers === 'click') ||\n\t\t\t(handlers === 'all')) {\n\t\t\tresolve(false);\n\t\t\treturn;\n\t\t}\n\t\tif (source.data('ams-context-menu') === true) {\n\t\t\tresolve(false);\n\t\t\treturn;\n\t\t}\n\t\tif (source.data('ams-stop-propagation') === true) {\n\t\t\tevt.stopPropagation();\n\t\t}\n\t\tevt.preventDefault();\n\t\tsource.tooltip('hide');\n\t\tMyAMS.modal.open(source).then(() => {\n\t\t\tresolve(true);\n\t\t}, reject);\n\t});\n}\n\n/**\n * Standard modal shown event handler\n * This handler is used to allow modals stacking\n */\nexport function modalShownEventHandler(evt) {\n\n\tconst zIndexModal = 1100;\n\n\t// Enable modals stacking\n\tconst\n\t\tdialog = $(evt.target),\n\t\tvisibleModalsCount = $('.modal:visible').length,\n\t\tzIndex = zIndexModal + (100 * visibleModalsCount);\n\tdialog.css('z-index', zIndex);\n\tsetTimeout(() => {\n\t\t$('.modal-backdrop').not('.modal-stack')\n\t\t\t.first()\n\t\t\t.css('z-index', zIndex - 10)\n\t\t\t.addClass('modal-stack');\n\t}, 0);\n\t// Check form contents before closing modals\n\t$(dialog).off('click', '[data-dismiss=\"modal\"]')\n\t\t.on('click', '[data-dismiss=\"modal\"]', (evt) => {\n\t\t\tconst handler = $(evt.currentTarget).data('ams-dismiss-handler') || modalDismissEventHandler;\n\t\t\treturn MyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t});\n}\n\n\n/**\n * Dynamic modal 'show' callback\n * This callback is used to initialize modal's viewport size\n *\n * @param evt: source event\n */\nexport function dynamicModalShowEventHandler(evt) {\n\tconst dialog = $(evt.target);\n\treturn MyAMS.core.executeFunctionByName(dialog.data('ams-init-content') ||\n\t\tMyAMS.config.initContent, document, dialog);\n}\n\n\n/**\n * Dynamic modal 'shown' callback\n * This callback is used to set focus on first modal input\n *\n * @param evt: source event\n */\nexport function dynamicModalShownEventHandler(evt) {\n\treturn new Promise((resolve, reject) => {\n\t\tMyAMS.require('form').then(() => {\n\t\t\tconst modal = $(evt.target);\n\t\t\tMyAMS.form.setFocus(modal);\n\t\t\tresolve(modal);\n\t\t}, reject);\n\t});\n}\n\n\n/**\n * Modal dismiss handler\n */\nexport function modalDismissEventHandler(evt) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst\n\t\t\tsource = $(evt.currentTarget),\n\t\t\tdialog = source.parents('.modal').first();\n\t\tdialog.data('modal-result', $(evt.currentTarget).data('modal-dismiss-value'));\n\t\tif (MyAMS.form) {\n\t\t\tMyAMS.form.confirmChangedForm(dialog).then((status) => {\n\t\t\t\tif (status === 'success') {\n\t\t\t\t\tdialog.modal('hide');\n\t\t\t\t}\n\t\t\t}).then(resolve, reject);\n\t\t} else {\n\t\t\tdialog.modal('hide');\n\t\t\tresolve();\n\t\t}\n\t});\n}\n\n\n/**\n * Standard modal hidden event handler\n *\n * If several visible modals are still, a \"modal-open\" class is added to body to ensure\n * modals are still visible.\n */\nexport function modalHiddenEventHandler() {\n\tif ($('.modal:visible').length > 0) {\n\t\t$.fn.modal.Constructor.prototype._checkScrollbar();\n\t\t$.fn.modal.Constructor.prototype._setScrollbar();\n\t\t$('body').addClass('modal-open');\n\t}\n}\n\n\n/**\n * Dynamic modal 'hidden' callback\n * This callback is used to clear and remove dynamic modals\n *\n * @param evt: source event\n */\nexport function dynamicModalHiddenEventHandler(evt) {\n\tconst dialog = $(evt.target);\n\tMyAMS.core.executeFunctionByName(dialog.data('ams-clear-content') ||\n\t\tMyAMS.config.clearContent, document, dialog).then(() => {\n\t\tif (dialog.data('dynamic') === true) {\n\t\t\tdialog.remove();\n\t\t}\n\t});\n}\n\n\n/**\n * Main modal module definition\n */\nexport const modal = {\n\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\tif (MyAMS.config.ajaxNav) {\n\t\t\t// Initialize modal dialogs links\n\t\t\t// Standard Bootstrap handlers are removed!!\n\t\t\t$(document).off('click', '[data-toggle=\"modal\"]')\n\t\t\t\t.on('click', '[data-toggle=\"modal\"]', (evt) => {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tconst handler = $(evt.currentTarget).data('ams-modal-handler') || modalToggleEventHandler;\n\t\t\t\t\tMyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t\t\t});\n\t\t}\n\n\t\t// Handle modal shown event to allow modals stacking\n\t\t$(document).on('shown.bs.modal', '.modal', (evt) => {\n\t\t\tconst handler = $(evt.currentTarget).data('ams-shown-handler') || modalShownEventHandler;\n\t\t\tMyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t});\n\n\t\t// Handle modal hidden event to check remaining modals\n\t\t$(document).on('hidden.bs.modal', '.modal', (evt) => {\n\t\t\tconst handler = $(evt.currentTarget).data('ams-hidden-handler') || modalHiddenEventHandler;\n\t\t\tMyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t});\n\t},\n\n\topen: (source, options) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet sourceData = {},\n\t\t\t\turl = source;\n\t\t\tif (typeof source !== 'string') {\n\t\t\t\tsourceData = source.data();\n\t\t\t\turl = source.attr('href') || sourceData.amsUrl;\n\t\t\t}\n\t\t\tconst urlGetter = MyAMS.core.getFunctionByName(url);\n\t\t\tif (typeof urlGetter === 'function') {\n\t\t\t\turl = urlGetter(source);\n\t\t\t}\n\t\t\tif (!url) {\n\t\t\t\treject(\"No provided URL!\");\n\t\t\t}\n\t\t\tif (url.startsWith('#')) {  // Open inner modal\n\t\t\t\t$(url).modal('show');\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: 'get',\n\t\t\t\t\turl: url,\n\t\t\t\t\tcache: sourceData.amsAllowCache === undefined ? false : sourceData.amsAllowCache,\n\t\t\t\t\tdata: options\n\t\t\t\t}).then((data, status, request) => {\n\t\t\t\t\tlet modal = null;\n\t\t\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\t\t\tconst\n\t\t\t\t\t\t\tresponse = MyAMS.ajax.getResponse(request),\n\t\t\t\t\t\t\tdataType = response.contentType,\n\t\t\t\t\t\t\tresult = response.data;\n\t\t\t\t\t\tlet content,\n\t\t\t\t\t\t\tdialog,\n\t\t\t\t\t\t\tdialogData,\n\t\t\t\t\t\t\tdialogOptions,\n\t\t\t\t\t\t\tsettings;\n\t\t\t\t\t\tswitch (dataType) {\n\t\t\t\t\t\t\tcase 'json':\n\t\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result,\n\t\t\t\t\t\t\t\t\t$($(source).data('ams-json-target') || '#content'));\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'script':\n\t\t\t\t\t\t\tcase 'xml':\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'html':\n\t\t\t\t\t\t\tcase 'text':\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tcontent = $(result),\n\t\t\t\t\t\t\t\tdialog = $('.modal-dialog', content.wrap('<div></div>').parent()),\n\t\t\t\t\t\t\t\tdialogData = dialog.data() || {},\n\t\t\t\t\t\t\t\tdialogOptions = {\n\t\t\t\t\t\t\t\t\tbackdrop: dialogData.backdrop === undefined ? 'static' : dialogData.backdrop,\n\t\t\t\t\t\t\t\t\tkeyboard: dialogData.keyboard === undefined ? true : dialogData.keyboard\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tsettings = $.extend({}, dialogOptions, dialogData.amsOptions);\n\t\t\t\t\t\t\t\tsettings = MyAMS.core.executeFunctionByName(dialogData.amsInit, dialog, settings) || settings;\n\t\t\t\t\t\t\t\tmodal = $('<div>').addClass('modal fade')\n\t\t\t\t\t\t\t\t\t.attr('tabIndex', '-1')\n\t\t\t\t\t\t\t\t\t.data('dynamic', true)\n\t\t\t\t\t\t\t\t\t.append(content)\n\t\t\t\t\t\t\t\t\t.on('show.bs.modal', dynamicModalShowEventHandler)\n\t\t\t\t\t\t\t\t\t.on('shown.bs.modal', dynamicModalShownEventHandler)\n\t\t\t\t\t\t\t\t\t.on('hidden.bs.modal', dynamicModalHiddenEventHandler)\n\t\t\t\t\t\t\t\t\t.modal(settings);\n\t\t\t\t\t\t\t\tif (MyAMS.stats &&\n\t\t\t\t\t\t\t\t\t!((sourceData.amsLogEvent === false) ||\n\t\t\t\t\t\t\t\t\t\t(dialogData.amsLogEvent === false))) {\n\t\t\t\t\t\t\t\t\tMyAMS.stats.logPageview(url);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tresolve(modal);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tfitWidthToImage: (evt, options) => {\n\t\tsetTimeout(() => {\n\t\t\tconst\n\t\t\t\tsource = evt.currentTarget,\n\t\t\t\timage = options ? $(options['resize-target']) : source;\n\t\t\tif (image.exists()) {\n\t\t\t\tconst\n\t\t\t\t\tdialog = image.parents('.modal-dialog'),\n\t\t\t\t\tpadding = dialog.width() - image.width();\n\t\t\t\tdialog.css('max-width',\n\t\t\t\t\tMath.min($(window).width(), image.get(0).naturalWidth + padding));\n\t\t\t}\n\t\t}, 150);\n\t},\n\n\t/**\n\t * Close modal associated with given element\n\t *\n\t * @param element: the element contained into closed modal\n\t */\n\tclose: (element) => {\n\t\tif (typeof element === 'string') {\n\t\t\telement = $(element);\n\t\t} else if (typeof element === 'undefined') {\n\t\t\telement = $('.modal-dialog:last');\n\t\t}\n\t\tconst dialog = element.objectOrParentWithClass('modal');\n\t\tif (dialog.length > 0) {\n\t\t\tdialog.modal('hide');\n\t\t}\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (MyAMS.env.bundle) {\n\tMyAMS.config.modules.push('modal');\n} else {\n\tMyAMS.modal = modal;\n\tconsole.debug(\"MyAMS: modal module loaded...\");\n}\n"],"mappings":"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"}