{"version":3,"file":"mod-container-dev.js","names":["$","MyAMS","container","switchElementAttribute","action","link","params","require","then","cell","parents","first","icon","row","table","col","index","location","data","updateTarget","objectName","hint","attr","tooltip","replaceWith","ajax","post","object_name","attribute_name","result","status","xhr","state","addClass","handle_json","handleJSON","deleteElement","alert","bigBox","title","i18n","WARNING","message","CONFIRM_REMOVE","successLabel","CONFIRM","cancelLabel","BTN_CANCEL","deleteTarget","hasClass","DataTable","remove","draw","window","env","bundle","config","modules","push","console","debug"],"sources":["mod-container.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS container management\n */\n\nconst $ = MyAMS.$;\n\n\nexport const container = {\n\n\t/**\n\t * Switch attribute of container element\n\t *\n\t * @param action\n\t */\n\tswitchElementAttribute: (action) => {\n\t\treturn function(link, params) {\n\t\t\tMyAMS.require('ajax', 'alert', 'i18n').then(() => {\n\t\t\t\tconst\n\t\t\t\t\tcell = link.parents('td').first(),\n\t\t\t\t\ticon = $('i', cell),\n\t\t\t\t\trow = cell.parents('tr'),\n\t\t\t\t\ttable = row.parents('table'),\n\t\t\t\t\tcol = $(`thead th:nth-child(${cell.index()+1})`, table);\n\t\t\t\tlet location = link.data('ams-location') || col.data('ams-location') ||\n\t\t\t\t\trow.data('ams-location') || table.data('ams-location') || '';\n\t\t\t\tif (location) {\n\t\t\t\t\tlocation += '/';\n\t\t\t\t}\n\t\t\t\tconst\n\t\t\t\t\tupdateTarget = link.data('ams-update-target') || col.data('ams-update-target') ||\n\t\t\t\t\t\trow.data('ams-update-target') || table.data('ams-update-target') ||\n\t\t\t\t\t\t'switch-element-attribute.json',\n\t\t\t\t\tobjectName = row.data('ams-element-name'),\n\t\t\t\t\thint = icon.attr('data-original-title') || icon.attr('title');\n\t\t\t\ticon.tooltip('hide')\n\t\t\t\t\t.replaceWith('<i class=\"fas fa-spinner fa-spin\"></i>');\n\t\t\t\tMyAMS.ajax.post(location + updateTarget, {\n\t\t\t\t\tobject_name: objectName,\n\t\t\t\t\tattribute_name: col.data('ams-attribute-name')\n\t\t\t\t}).then((result, status, xhr) => {\n\t\t\t\t\tlet icon = $('i', cell);\n\t\t\t\t\tif (result.status === 'success') {\n\t\t\t\t\t\tif (result.state) {\n\t\t\t\t\t\t\ticon.replaceWith(`<i class=\"${col.data('ams-icon-on')}\"></i>`);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ticon.replaceWith(`<i class=\"${col.data('ams-icon-off')}\"></i>`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (hint) {\n\t\t\t\t\t\t\ticon = $('i', cell);\n\t\t\t\t\t\t\ticon.addClass('hint')\n\t\t\t\t\t\t\t\t.attr('data-original-title', hint);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (result.handle_json) {\n\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tMyAMS.ajax.handleJSON(result);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\t/**\n\t * Delete element from container\n\t *\n\t * @param action\n\t * @returns {(function(*, *): void)|*}\n\t */\n\tdeleteElement: (action) => {\n\t\treturn function(link, params) {\n\t\t\tMyAMS.require('ajax', 'alert', 'i18n').then(() => {\n\t\t\t\tMyAMS.alert.bigBox({\n\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\ticon: 'fas fa-bell',\n\t\t\t\t\ttitle: MyAMS.i18n.WARNING,\n\t\t\t\t\tmessage: MyAMS.i18n.CONFIRM_REMOVE,\n\t\t\t\t\tsuccessLabel: MyAMS.i18n.CONFIRM,\n\t\t\t\t\tcancelLabel: MyAMS.i18n.BTN_CANCEL\n\t\t\t\t}).then((status) => {\n\t\t\t\t\tif (status !== 'success') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst\n\t\t\t\t\t\tcell = link.parents('td'),\n\t\t\t\t\t\trow = cell.parents('tr'),\n\t\t\t\t\t\ttable = row.parents('table'),\n\t\t\t\t\t\tcol = $(`thead th:nth-child(${cell.index()+1})`, table);\n\t\t\t\t\tlet location = link.data('ams-location') ||  col.data('ams-location') ||\n\t\t\t\t\t\trow.data('ams-location') || table.data('ams-location') || '';\n\t\t\t\t\tif (location) {\n\t\t\t\t\t\tlocation += '/';\n\t\t\t\t\t}\n\t\t\t\t\tconst\n\t\t\t\t\t\tdeleteTarget = link.data('ams-delete-target') || col.data('ams-delete-target') ||\n\t\t\t\t\t\t\trow.data('ams-delete-target') || table.data('ams-delete-target') ||\n\t\t\t\t\t\t\t'delete-element.json',\n\t\t\t\t\t\tobjectName = row.data('ams-element-name');\n\t\t\t\t\tMyAMS.ajax.post(location + deleteTarget, {\n\t\t\t\t\t\t'object_name': objectName\n\t\t\t\t\t}).then((result, status, xhr) => {\n\t\t\t\t\t\tif (result.status === 'success') {\n\t\t\t\t\t\t\tif (table.hasClass('datatable')) {\n\t\t\t\t\t\t\t\ttable.DataTable().row(row).remove().draw();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trow.remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (result.handle_json) {\n\t\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('container');\n\t} else {\n\t\tMyAMS.container = container;\n\t\tconsole.debug(\"MyAMS: container module loaded...\");\n\t}\n}\n"],"mappings":"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"}