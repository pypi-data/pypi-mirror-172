{"version":3,"file":"mod-menu-dev.js","names":["$","MyAMS","_contextMenuHandler","menu","get","tagName","parents","first","menuData","data","toggle","require","then","modal","open","href","attr","amsUrl","startsWith","hrefGetter","core","getFunctionByName","replace","target","form","confirmChangedForm","status","skin","loadURL","location","hash","dom","root","hasClass","removeClass","setTimeout","window","_initialized","init","fn","extend","contextMenu","settings","getMenuPosition","mouse","direction","win","menuSelector","position","each","idx","elt","source","on","evt","ctrlKey","dropdown","css","left","clientX","top","clientY","off","clickEvt","stopPropagation","preventDefault","document","click","currentTarget","ul","children","menuRect","getBoundingClientRect","buttonHeight","height","menuHeight","outerHeight","addClass","focus","clickEvent","env","bundle","config","modules","push","console","debug"],"sources":["mod-menu.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS menus management\n */\n\nconst $ = MyAMS.$;\n\n\n/**\n * Context menu handler\n */\nfunction _contextMenuHandler(menu) {\n\tif (menu.get(0).tagName !== 'A') {\n\t\tmenu = menu.parents('a').first();\n\t}\n\tconst menuData = menu.data();\n\tif (menuData.toggle === 'modal') {\n\t\tMyAMS.require('modal').then(() => {\n\t\t\tMyAMS.modal.open(menu);\n\t\t});\n\t} else {\n\t\tlet href = menu.attr('href') || menuData.amsUrl;\n\t\tif (!href || href.startsWith('javascript:') || menu.attr('target')) {\n\t\t\treturn;\n\t\t}\n\t\tconst hrefGetter = MyAMS.core.getFunctionByName(href);\n\t\tif (typeof hrefGetter === 'function') {\n\t\t\thref = hrefGetter(menu);\n\t\t}\n\t\tif (typeof href === 'undefined') {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof href === 'function') {\n\t\t\thref(menu);\n\t\t} else {\n\t\t\tMyAMS.require('form', 'skin').then(() => {\n\t\t\t\thref = href.replace(/%23/, '#');\n\t\t\t\tconst target = menu.data('ams-target');\n\t\t\t\tif (target) {\n\t\t\t\t\tMyAMS.form.confirmChangedForm(target).then((status) => {\n\t\t\t\t\t\tif (status !== 'success') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tMyAMS.skin.loadURL(href, target,\n\t\t\t\t\t\t\tmenu.data('ams-link-options'), menu.data('ams-link-callback'));\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tMyAMS.form.confirmChangedForm().then((status) => {\n\t\t\t\t\t\tif (status !== 'success') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (href.startsWith('#')) {\n\t\t\t\t\t\t\tif (href !== location.hash) {\n\t\t\t\t\t\t\t\tif (MyAMS.dom.root.hasClass('mobile-view-activated')) {\n\t\t\t\t\t\t\t\t\tMyAMS.dom.root.removeClass('hidden-menu');\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\twindow.location.hash = href;\n\t\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\twindow.location.hash = href;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.location = href;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\n\nlet _initialized = false;\n\n\n/**\n * MyAMS \"menu\" module\n */\nexport const menu = {\n\n\t/**\n\t * Global module initialization.\n\t * This function extends jQuery with a \"contextMenu()\" function, which\n\t * allows to create a new context menu.\n\t */\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\t$.fn.extend({\n\n\t\t\t/**\n\t\t\t * JQuery context menu constructor\n\t\t\t */\n\t\t\tcontextMenu: function(settings) {\n\n\t\t\t\tfunction getMenuPosition(mouse, direction) {\n\t\t\t\t\tconst\n\t\t\t\t\t\twin = $(window)[direction](),\n\t\t\t\t\t\tmenu = $(settings.menuSelector)[direction]();\n\t\t\t\t\tlet position = mouse;\n\t\t\t\t\t// opening menu would pass the side of the page\n\t\t\t\t\tif (mouse + menu > win && menu < mouse) {\n\t\t\t\t\t\tposition -= menu;\n\t\t\t\t\t}\n\t\t\t\t\treturn position;\n\t\t\t\t}\n\n\t\t\t\treturn this.each((idx, elt) => {\n\n\t\t\t\t\tconst\n\t\t\t\t\t\tsource = $(elt),\n\t\t\t\t\t\tmenu = $(settings.menuSelector);\n\n\t\t\t\t\t// Set flag on menu items\n\t\t\t\t\t$('a', menu).each((idx, elt) => {\n\t\t\t\t\t\t$(elt).data('ams-context-menu', true);\n\t\t\t\t\t});\n\t\t\t\t\tsource.on(\"contextmenu\", function (evt) {\n\t\t\t\t\t\t// return native menu if pressing CTRL key\n\t\t\t\t\t\tif (evt.ctrlKey) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// open menu\n\t\t\t\t\t\tmenu.data('contextmenu-event-source', source)\n\t\t\t\t\t\t\t.dropdown('show')\n\t\t\t\t\t\t\t.css({\n\t\t\t\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\t\t\t\tleft: getMenuPosition(evt.clientX, 'width') - 10,\n\t\t\t\t\t\t\t\ttop: getMenuPosition(evt.clientY, 'height') - 10\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.off('click')\n\t\t\t\t\t\t\t.on('click', (clickEvt) => {\n\t\t\t\t\t\t\t\tclickEvt.stopPropagation();\n\t\t\t\t\t\t\t\tclickEvt.preventDefault();\n\t\t\t\t\t\t\t\tmenu.dropdown('hide');\n\t\t\t\t\t\t\t\t_contextMenuHandler($(clickEvt.target));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\n\t\t\t\t\t// make sure menu closes on any click\n\t\t\t\t\t$(document).click(() => {\n\t\t\t\t\t\tmenu.dropdown('hide');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// Automatically set orientation of dropdown menus\n\t\t$(document).on('show.bs.dropdown', '.btn-group', (evt) => {\n\t\t\t// check menu height\n\t\t\tconst\n\t\t\t\tmenu = $(evt.currentTarget),\n\t\t\t\tul = menu.children('.dropdown-menu'),\n\t\t\t\tmenuRect = menu.get(0).getBoundingClientRect(),\n\t\t\t\tposition = menuRect.top,\n\t\t\t\tbuttonHeight = menuRect.height,\n\t\t\t\tmenuHeight = ul.outerHeight();\n\t\t\tif (position > menuHeight && $(window).height() - position < buttonHeight + menuHeight) {\n\t\t\t\tmenu.addClass(\"dropup\");\n\t\t\t}\n\t\t\t// activate first input\n\t\t\t$('input, select, textarea', ul).first().focus();\n\t\t}).on('hidden.bs.dropdown', '.btn-group', (evt) => {\n\t\t\t// always reset after close\n\t\t\t$(evt.currentTarget).removeClass('dropup');\n\t\t});\n\n\t\t$(document).on('hide.bs.dropdown', (evt) => {\n\t\t\tif (evt.clickEvent) {\n\t\t\t\tconst dropdown = $(evt.clickEvent.target).parents('.dropdown-menu');\n\t\t\t\tif (dropdown.data('ams-click-dismiss') === false) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('menu');\n\t} else {\n\t\tMyAMS.menu = menu;\n\t\tconsole.debug(\"MyAMS: menu module loaded...\");\n\t}\n}\n"],"mappings":"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"}