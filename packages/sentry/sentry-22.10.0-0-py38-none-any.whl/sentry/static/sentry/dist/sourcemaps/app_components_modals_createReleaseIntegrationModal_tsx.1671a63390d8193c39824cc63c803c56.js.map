{"version":3,"file":"chunks/app_components_modals_createReleaseIntegrationModal_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"6iBAoBA,SAASA,EAAT,GAQuC,IARA,KACrCC,EADqC,OAErCC,EAFqC,WAGrCC,EAHqC,QAIrCC,EAJqC,aAKrCC,EALqC,gBAMrCC,EANqC,SAOrCC,GACqC,EACrC,MAAMC,GAAMC,EAAAA,EAAAA,KACNC,EAAkB,CACtB,CACEC,KAAM,OACNC,KAAM,SAENC,YAAc,GAAET,EAAQO,2BACxBG,OAAOC,EAAAA,EAAAA,GAAE,QACTC,MAAM,QAAC,EAAAC,SAAD,WAAWF,EAAAA,EAAAA,GAAE,8BACnBG,aAAe,GAAEd,EAAQO,2BACzBQ,UAAU,IAGd,OACE,QAAC,EAAAF,SAAD,YACE,QAACf,EAAD,WACE,wBAAKa,EAAAA,EAAAA,GAAE,qCAET,QAACd,EAAD,WACE,QAAC,IAAD,CACEM,SAAU,KACRA,IACAJ,GAAY,EAEdiB,SAAUC,MAAOC,EAAMC,EAAiBC,KACtC,IAyBED,QAxB0Bf,EAAIiB,eAAe,gBAAiB,CAC5DC,OAAQ,OACRJ,KAAM,IACDA,EACHjB,aAAcA,EAAasB,KAC3BC,aAAa,EACbC,YAAY,EACZC,OAAQ,CACN,eACA,gBACA,YACA,aACA,mBACA,aACA,cACA,WACA,YACA,cACA,gBAEFC,eAAe,EACfC,SAAW,0EAAyE5B,EAAQO,yJAMjG,CAFC,MAAOsB,GACPT,EAAcS,EACf,GAEHV,gBAAiBD,IACfhB,EAAgBgB,IAChBY,EAAAA,EAAAA,KAAkBnB,EAAAA,EAAAA,GAAE,gCACpBZ,GAAY,EAEdqB,cAAeS,KACbE,EAAAA,EAAAA,KAAgBC,EAAAA,EAAAA,IAAI,gCAAiC,CAACH,UAAtD,EA1CJ,SA6CGvB,EAAO2B,KAAIC,IACV,QAAC,IAAD,CAAkCA,MAAOA,GAAnBA,EAAM3B,cAMvC,CAhFQX,EAAAA,YAAAA,gCAkFT,S,qHCpDA,QAvBA,WAAmE,IAAnD,gBAACuC,EAAiB/B,IAAKgC,GAA4B,uDAAJ,CAAC,EAC9D,MAAMC,GAAWC,EAAAA,EAAAA,eAGQC,IAArBF,EAASG,cAAyCD,IAAhBH,IACpCC,EAASG,QAAU,IAAIC,EAAAA,IAIzB,MAAMrC,EAAMgC,GAAeC,EAASG,QAG9BE,GAAiBC,EAAAA,EAAAA,cAAY,KAC5BR,GACH/B,EAAIwC,OACL,GACA,CAACxC,EAAK+B,IAIT,OAFAU,EAAAA,EAAAA,YAAU,IAAMH,GAAgB,CAACA,IAE1BtC,CACR,C","sources":["webpack:///./app/components/modals/createReleaseIntegrationModal.tsx","webpack:///./app/utils/useApi.tsx"],"sourcesContent":["import {Fragment} from 'react';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport {ModalRenderProps} from 'sentry/actionCreators/modal';\nimport FieldFromConfig from 'sentry/components/forms/fieldFromConfig';\nimport Form from 'sentry/components/forms/form';\nimport {Field} from 'sentry/components/forms/types';\nimport {t, tct} from 'sentry/locale';\nimport {Organization, Project} from 'sentry/types';\nimport useApi from 'sentry/utils/useApi';\n\nexport type CreateReleaseIntegrationModalOptions = {\n  onCancel: () => void;\n  onCreateSuccess: (integration) => void;\n  organization: Organization;\n  project: Project;\n};\ntype CreateReleaseIntegrationModalProps = CreateReleaseIntegrationModalOptions &\n  ModalRenderProps;\n\nfunction CreateReleaseIntegrationModal({\n  Body,\n  Header,\n  closeModal,\n  project,\n  organization,\n  onCreateSuccess,\n  onCancel,\n}: CreateReleaseIntegrationModalProps) {\n  const api = useApi();\n  const fields: Field[] = [\n    {\n      name: 'name',\n      type: 'string',\n\n      placeholder: `${project.name} Release Integration`,\n      label: t('Name'),\n      help: <Fragment>{t('Name of new integration.')}</Fragment>,\n      defaultValue: `${project.name} Release Integration`,\n      required: true,\n    },\n  ];\n  return (\n    <Fragment>\n      <Header>\n        <h3>{t('Create a Release Integration')}</h3>\n      </Header>\n      <Body>\n        <Form\n          onCancel={() => {\n            onCancel();\n            closeModal();\n          }}\n          onSubmit={async (data, onSubmitSuccess, onSubmitError) => {\n            try {\n              const integration = await api.requestPromise('/sentry-apps/', {\n                method: 'POST',\n                data: {\n                  ...data,\n                  organization: organization.slug,\n                  isAlertable: false,\n                  isInternal: true,\n                  scopes: [\n                    'project:read',\n                    'project:write',\n                    'team:read',\n                    'team:write',\n                    'project:releases',\n                    'event:read',\n                    'event:write',\n                    'org:read',\n                    'org:write',\n                    'member:read',\n                    'member:write',\n                  ],\n                  verifyInstall: false,\n                  overview: `This internal integration was auto-generated to setup Releases for the ${project.name} project. It is needed to provide the token used to create a release. If this integration is deleted, your Releases workflow will stop working!`,\n                },\n              });\n              onSubmitSuccess(integration);\n            } catch (error) {\n              onSubmitError(error);\n            }\n          }}\n          onSubmitSuccess={data => {\n            onCreateSuccess(data);\n            addSuccessMessage(t('Created Release Integration'));\n            closeModal();\n          }}\n          onSubmitError={error => {\n            addErrorMessage(tct('Something went wrong! [error]', {error}));\n          }}\n        >\n          {fields.map(field => (\n            <FieldFromConfig key={field.name} field={field} />\n          ))}\n        </Form>\n      </Body>\n    </Fragment>\n  );\n}\n\nexport default CreateReleaseIntegrationModal;\n","import {useCallback, useEffect, useRef} from 'react';\n\nimport {Client} from 'sentry/api';\n\ntype Options = {\n  /**\n   * An existing API client may be provided.\n   *\n   * This is a continent way to re-use clients and still inherit the\n   * persistInFlight configuration.\n   */\n  api?: Client;\n  /**\n   * Enabling this option will disable clearing in-flight requests when the\n   * component is unmounted.\n   *\n   * This may be useful in situations where your component needs to finish up\n   * somewhere the client was passed into some type of action creator and the\n   * component is unmounted.\n   */\n  persistInFlight?: boolean;\n};\n\n/**\n * Returns an API client that will have it's requests canceled when the owning\n * React component is unmounted (may be disabled via options).\n */\nfunction useApi({persistInFlight, api: providedApi}: Options = {}) {\n  const localApi = useRef<Client>();\n\n  // Lazily construct the client if we weren't provided with one\n  if (localApi.current === undefined && providedApi === undefined) {\n    localApi.current = new Client();\n  }\n\n  // Use the provided client if available\n  const api = providedApi ?? localApi.current!;\n\n  // Clear API calls on unmount (if persistInFlight is disabled\n  const clearOnUnmount = useCallback(() => {\n    if (!persistInFlight) {\n      api.clear();\n    }\n  }, [api, persistInFlight]);\n\n  useEffect(() => clearOnUnmount, [clearOnUnmount]);\n\n  return api;\n}\n\nexport default useApi;\n"],"names":["CreateReleaseIntegrationModal","Body","Header","closeModal","project","organization","onCreateSuccess","onCancel","api","useApi","fields","name","type","placeholder","label","t","help","Fragment","defaultValue","required","onSubmit","async","data","onSubmitSuccess","onSubmitError","requestPromise","method","slug","isAlertable","isInternal","scopes","verifyInstall","overview","error","addSuccessMessage","addErrorMessage","tct","map","field","persistInFlight","providedApi","localApi","useRef","undefined","current","Client","clearOnUnmount","useCallback","clear","useEffect"],"sourceRoot":""}