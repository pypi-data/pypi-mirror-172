{"version":3,"file":"chunks/app_views_alerts_builder_projectProvider_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"+nBAuBA,SAASA,EAA4BC,GACnC,MAAMC,GAAMC,EAAAA,EAAAA,MACZC,EAAAA,EAAAA,GAAe,CAACC,SAAUJ,EAAMI,WAEhC,MAAM,SAACC,EAAD,OAAWC,EAAX,aAAmBC,KAAiBC,GAASR,EAC7CS,EAAYH,EAAOG,WAAaT,EAAMI,SAASM,MAAMC,QACrDC,OAAgCC,IAAdJ,GAGlB,SAACK,EAAD,gBAAWC,EAAX,SAA4BC,EAA5B,WAAsCC,IAAcC,EAAAA,EAAAA,GACxDN,OACIC,EACA,CACEM,MAAO,CAACV,KAGVE,EAAUC,EACZE,EAASM,MAAKC,GAAKA,EAAEC,aAAcR,EAASS,QAAUT,EAAS,IAC/DA,EAASM,MAAK,QAAC,KAACI,GAAF,SAAYA,IAASf,CAArB,IAWlB,OATAgB,EAAAA,EAAAA,YAAU,KACHd,IAKLe,EAAAA,EAAAA,IAAgBzB,EAAKM,EAAaiB,KAAM,CAACb,EAAQgB,IAAjD,GACC,CAAC1B,EAAKM,EAAcI,KAElBI,GAAmBC,GACf,QAAC,IAAD,KAIJL,GAAYM,IACfW,EAAAA,EAAAA,GACG,kBAAiBrB,EAAaiB,gCAAgCxB,EAAMI,SAASM,MAAMmB,8BACpF7B,EAAM8B,SAKLnB,GAAWM,GAEZ,QAAC,IAAD,CAAOc,KAAK,UAAZ,UAAuBC,EAAAA,EAAAA,GAAE,sDAK3B,QAAC,EAAAC,SAAD,UACG5B,IAAY6B,EAAAA,EAAAA,gBAAe7B,IACxB8B,EAAAA,EAAAA,cAAa9B,EAAU,IAClBG,KACAH,EAASL,MACZW,UACAF,UAAWG,EAAkBD,EAAQa,KAAOf,EAC5CF,iBAEFF,IAGT,CA7DQN,EAAAA,YAAAA,8BA+DT,S","sources":["webpack:///./app/views/alerts/builder/projectProvider.tsx"],"sourcesContent":["import {cloneElement, Fragment, isValidElement, useEffect} from 'react';\nimport {RouteComponentProps} from 'react-router';\n\nimport {fetchOrgMembers} from 'sentry/actionCreators/members';\nimport {navigateTo} from 'sentry/actionCreators/navigation';\nimport Alert from 'sentry/components/alert';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {t} from 'sentry/locale';\nimport {Organization} from 'sentry/types';\nimport useApi from 'sentry/utils/useApi';\nimport useProjects from 'sentry/utils/useProjects';\nimport useScrollToTop from 'sentry/utils/useScrollToTop';\n\ntype Props = RouteComponentProps<RouteParams, {}> & {\n  hasMetricAlerts: boolean;\n  organization: Organization;\n  children?: React.ReactNode;\n};\n\ntype RouteParams = {\n  projectId?: string;\n};\n\nfunction AlertBuilderProjectProvider(props: Props) {\n  const api = useApi();\n  useScrollToTop({location: props.location});\n\n  const {children, params, organization, ...other} = props;\n  const projectId = params.projectId || props.location.query.project;\n  const useFirstProject = projectId === undefined;\n\n  // calling useProjects() without args fetches all projects\n  const {projects, initiallyLoaded, fetching, fetchError} = useProjects(\n    useFirstProject\n      ? undefined\n      : {\n          slugs: [projectId],\n        }\n  );\n  const project = useFirstProject\n    ? projects.find(p => p.isMember) ?? (projects.length && projects[0])\n    : projects.find(({slug}) => slug === projectId);\n\n  useEffect(() => {\n    if (!project) {\n      return;\n    }\n\n    // fetch members list for mail action fields\n    fetchOrgMembers(api, organization.slug, [project.id]);\n  }, [api, organization, project]);\n\n  if (!initiallyLoaded || fetching) {\n    return <LoadingIndicator />;\n  }\n\n  // If there's no project show the project selector modal\n  if (!project && !fetchError) {\n    navigateTo(\n      `/organizations/${organization.slug}/alerts/wizard/?referrer=${props.location.query.referrer}&project=:projectId`,\n      props.router\n    );\n  }\n\n  // if loaded, but project fetching states incomplete or project can't be found, project doesn't exist\n  if (!project || fetchError) {\n    return (\n      <Alert type=\"warning\">{t('The project you were looking for was not found.')}</Alert>\n    );\n  }\n\n  return (\n    <Fragment>\n      {children && isValidElement(children)\n        ? cloneElement(children, {\n            ...other,\n            ...children.props,\n            project,\n            projectId: useFirstProject ? project.slug : projectId,\n            organization,\n          })\n        : children}\n    </Fragment>\n  );\n}\n\nexport default AlertBuilderProjectProvider;\n"],"names":["AlertBuilderProjectProvider","props","api","useApi","useScrollToTop","location","children","params","organization","other","projectId","query","project","useFirstProject","undefined","projects","initiallyLoaded","fetching","fetchError","useProjects","slugs","find","p","isMember","length","slug","useEffect","fetchOrgMembers","id","navigateTo","referrer","router","type","t","Fragment","isValidElement","cloneElement"],"sourceRoot":""}