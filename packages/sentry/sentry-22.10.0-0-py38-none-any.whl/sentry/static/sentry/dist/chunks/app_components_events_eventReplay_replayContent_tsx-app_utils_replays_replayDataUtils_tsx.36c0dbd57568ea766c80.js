"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_events_eventReplay_replayContent_tsx-app_utils_replays_replayDataUtils_tsx"],{"./app/components/events/eventReplay/replayContent.tsx":(e,t,r)=>{r.r(t),r.d(t,{default:()=>R});var a=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/react/index.js")),s=r("../node_modules/react-router/es/index.js"),i=r("./app/components/button.tsx"),o=r("./app/components/placeholder.tsx"),l=r("./app/components/replays/replayContext.tsx"),p=r("./app/components/replays/replayPlayer.tsx"),c=r("./app/components/replays/replaysFeatureBadge.tsx"),d=r("./app/components/replays/utils.tsx"),u=r("./app/icons/index.tsx"),m=r("./app/locale.tsx"),g=r("./app/styles/space.tsx"),f=r("./app/utils/replays/hooks/useReplayData.tsx"),h=r("./app/views/replays/detail/layout/fluidHeight.tsx"),y=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function v(e){let{orgSlug:t,replaySlug:r,event:a}=e;const{fetching:s,replay:o,fetchError:g}=(0,f.Z)({orgSlug:t,replaySlug:r}),v=a.dateCreated?1e3*Math.floor(new Date(a.dateCreated).getTime()/1e3):0;if(g)throw new Error("Failed to load Replay");const R=o?.getReplay(),I=R?.startedAt.getTime()??0,_=(0,n.useMemo)((()=>v&&I?(0,d.NH)(v,I)/1e3:0),[v,I]);if(s||!R)return(0,y.tZ)(Z,{testId:"replay-loading-placeholder",height:"400px",width:"100%"});const j={pathname:`/organizations/${t}/replays/${r}/`,query:{t_main:"console",f_c_search:void 0,t:_}};return(0,y.tZ)(l.z,{replay:o,initialTimeOffset:_,children:(0,y.BX)(b,{"data-test-id":"player-container",children:[(0,y.BX)(T,{children:[(0,y.tZ)(w,{children:(0,m.t)("Replays")}),(0,y.tZ)(c.Z,{})]}),(0,y.BX)(h.Z,{children:[(0,y.tZ)(x,{"aria-label":(0,m.t)("View Full Replay"),to:j,children:(0,y.tZ)(k,{})}),(0,y.tZ)(S,{children:(0,y.tZ)(p.Z,{})})]}),(0,y.tZ)(C,{children:(0,y.tZ)(i.ZP,{"data-test-id":"view-replay-button",to:j,priority:"primary",size:"sm",icon:(0,y.tZ)(u.JF,{size:"sm"}),children:(0,m.t)("View Full Replay")})})]})})}v.displayName="ReplayContent";const b=(0,a.Z)(h.Z,{target:"edkm01g7"})("position:relative;margin-bottom:",(0,g.Z)(2),";background:",(e=>e.theme.background),";gap:",(0,g.Z)(1),";max-height:448px;"),T=(0,a.Z)("div",{target:"edkm01g6"})("display:flex;align-items:center;position:absolute;top:",(0,g.Z)(1),";right:",(0,g.Z)(1),";background:",(e=>e.theme.background),";border-radius:2.25rem;padding:",(0,g.Z)(.75)," ",(0,g.Z)(.75)," ",(0,g.Z)(.75)," ",(0,g.Z)(1),";z-index:2;box-shadow:",(e=>e.theme.dropShadowLightest),";gap:0 ",(0,g.Z)(.25),";"),w=(0,a.Z)("div",{target:"edkm01g5"})("font-size:",(e=>e.theme.fontSizeSmall),";line-height:0;color:",(e=>e.theme.text),";"),x=(0,a.Z)(s.Link,{target:"edkm01g4"})({name:"u4micp",styles:"position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:1"}),k=(0,a.Z)((e=>{let{className:t}=e;return(0,y.tZ)("div",{className:t,children:(0,y.tZ)(u.JF,{size:"xl"})})}),{target:"edkm01g3"})("display:flex;justify-content:center;align-items:center;width:72px;height:72px;border-radius:50%;background:",(e=>e.theme.purple400),";color:white;padding-left:5px;"),S=(0,a.Z)(h.Z,{target:"edkm01g2"})("background:",(e=>e.theme.background),";border:1px solid ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";box-shadow:",(e=>e.theme.dropShadowLight),";"),C=(0,a.Z)("div",{target:"edkm01g1"})({name:"skgbeu",styles:"display:flex;justify-content:flex-end"}),Z=(0,a.Z)(o.Z,{target:"edkm01g0"})("margin-bottom:",(0,g.Z)(2),";"),R=v},"./app/components/replays/replayContext.tsx":(e,t,r)=>{r.d(t,{z:()=>b,M:()=>T});var a=r("../node_modules/react/index.js"),n=r("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),s=r("../node_modules/rrweb/es/rrweb/packages/rrweb/src/replay/index.js"),i=r("../node_modules/rrweb/es/rrweb/packages/rrweb/src/types.js"),o=r("./app/stores/configStore.tsx"),l=r("./app/stores/useLegacyStore.tsx"),p=r("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),c=r("./app/utils/localStorage.tsx");const d=new Map;function u(e){let{replayer:t,nodeId:r}=e;if(!d.has(r))return!1;const a=d.get(r);return!(!a||!t.wrapper.contains(a.canvas)||(t.wrapper.removeChild(a.canvas),d.delete(r),0))}var m,g=r("./app/utils/useOrganization.tsx"),f=r("./app/utils/usePrevious.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");!function(e){e.ReplayConfig="replay-config"}(m||(m={}));const y=a.createContext({clearAllHighlights:()=>{},currentHoverTime:void 0,currentTime:0,dimensions:{height:0,width:0},fastForwardSpeed:0,highlight:()=>{},initRoot:()=>{},isBuffering:!1,isFinished:!1,isPlaying:!1,isSkippingInactive:!0,removeHighlight:()=>{},replay:null,restart:()=>{},setCurrentHoverTime:()=>{},setCurrentTime:()=>{},setSpeed:()=>{},speed:1,togglePlayPause:()=>{},toggleSkipInactive:()=>{}});function v(e){c.Z.setItem(m.ReplayConfig,JSON.stringify(e))}function b(e){let{children:t,replay:r,initialTimeOffset:b=0,value:T={}}=e;const w=(0,l.X)(o.Z),x=(0,g.Z)(),k=r?.getRRWebEvents(),S=(0,a.useRef)(JSON.parse(c.Z.getItem(m.ReplayConfig)||"{}")),C=(0,n.u)(),Z=(0,f.Z)(k),R=k!==Z,I=(0,a.useRef)(null),[_,j]=(0,a.useState)({height:0,width:0}),[A,N]=(0,a.useState)(),[M,D]=(0,a.useState)(!1),[E,F]=(0,a.useState)(-1),[O,P]=(0,a.useState)(S.current.skip??!0),[z,B]=(0,a.useState)(S.current.speed||1),[$,H]=(0,a.useState)(0),[L,U]=(0,a.useState)({target:-1,previous:-1}),W=(0,a.useRef)(void 0),X=(0,a.useRef)(!1),q=I.current?.getCurrentTime()===E,J=e=>{j(e)},V=e=>{H(e.speed)},G=()=>{H(0)},K=(0,a.useCallback)((e=>{let{nodeId:t,annotation:r}=e;const a=I.current;a&&function(e){let{replayer:t,nodeId:r,annotation:a="",color:n}=e;const{mouseTail:s,wrapper:i}=t,o=t.getMirror().getNode(r);if(!o||!t.iframe.contentDocument?.body?.contains(o))return null;const{top:l,left:p,width:c,height:u}=o.getBoundingClientRect(),m=n??"rgba(168, 196, 236, 0.75)",g=s.cloneNode(),f=g.getContext("2d");if(!f)return null;f.fillStyle=m,f.fillRect(p,l,c,u),f.beginPath(),f.setLineDash([5,5]),f.moveTo(p,l),f.lineTo(p+c,l),f.lineTo(p+c,l+u),f.lineTo(p,l+u),f.closePath(),f.stroke(),f.font="24px Rubik",f.textAlign="right",f.textBaseline="bottom";const h=f.measureText(a).width;f.fillStyle="rgba(30, 30, 30, 0.75)",f.fillRect(p+c-h,l+u-30,h,30),f.fillStyle="white",f.fillText(a,p+c,l+u),d.set(r,{canvas:g}),i.insertBefore(g,s)}({replayer:a,nodeId:t,annotation:r})}),[]),Q=(0,a.useCallback)((()=>{const e=I.current;e&&function(e){let{replayer:t}=e;for(const e of d.keys())u({replayer:t,nodeId:e})}({replayer:e})}),[]),Y=(0,a.useCallback)((e=>{let{nodeId:t}=e;const r=I.current;r&&u({replayer:r,nodeId:t})}),[]),ee=(0,a.useCallback)((()=>{F(I.current?.getCurrentTime()??-1),D(!1)}),[]),te=(0,a.useCallback)((e=>{if(void 0===k)return;if(null===e)return;if(I.current){if(!R&&!X.current)return;if(0===I.current.iframe.contentDocument?.body.childElementCount)return;for(;e.firstChild;)e.removeChild(e.firstChild)}const t=new s.x(k,{root:e,blockClass:"sentry-block",mouseTail:{duration:750,lineCap:"round",lineWidth:2,strokeStyle:C.purple200},skipInactive:S.current.skip??!0,speed:S.current.speed||1});t.on(i.SA.Resize,J),t.on(i.SA.Finish,ee),t.on(i.SA.SkipStart,V),t.on(i.SA.SkipEnd,G),I.current=t,X.current&&(X.current=!1)}),[k,C.purple200,ee,R]);(0,a.useEffect)((()=>{const e=()=>{"visible"!==document.visibilityState&&I.current?.pause()};return I.current&&k&&(te(I.current.wrapper.parentElement),document.addEventListener("visibilitychange",e)),()=>{document.removeEventListener("visibilitychange",e)}}),[te,k]);const re=(0,a.useCallback)((()=>I.current?Math.max(I.current.getCurrentTime(),0):0),[]),ae=(0,a.useCallback)((e=>{const t=I.current;if(!t)return;const r=I.current?.getMetaData().totalTime,a=e>r?0:e;U({target:a,previous:re()}),W.current&&window.clearTimeout(W.current),M?(W.current=window.setTimeout((()=>t.play(a)),0),D(!0)):(W.current=window.setTimeout((()=>t.pause(a)),0),D(!1))}),[re,M]),ne=(0,a.useCallback)((e=>{const t=I.current;S.current={...S.current,speed:e},v(S.current),t&&(M?(t.pause(),t.setConfig({speed:e}),t.play(re())):t.setConfig({speed:e}),B(e))}),[re,M]),se=(0,a.useCallback)((e=>{const t=I.current;t&&(e?t.play(re()):t.pause(re()),D(e),(0,p.Z)("replay.play-pause",{organization:x,user_email:w.user.email,play:e}))}),[re,w.user.email,x]),ie=(0,a.useCallback)((()=>{I.current&&(I.current.play(0),D(!0))}),[]),oe=(0,a.useCallback)((e=>{const t=I.current;S.current={...S.current,skip:e},v(S.current),t&&(e!==t.config.skipInactive&&t.setConfig({skipInactive:e}),P(e))}),[]);(0,a.useEffect)((()=>(b&&k&&I.current&&ae(1e3*b),()=>{X.current=!0})),[k,I.current]);const le=function(e){const[t,r]=(0,a.useState)(0);return function(e){(0,a.useEffect)((()=>{const t=window.requestAnimationFrame(e);return()=>window.cancelAnimationFrame(t)}),[e])}((()=>r(e))),t}(re),[pe,ce]=-1!==L.target&&L.previous===le&&L.target!==L.previous?[!0,L.target]:[!1,le];return pe||-1===L.target||U({target:-1,previous:-1}),(0,h.tZ)(y.Provider,{value:{clearAllHighlights:Q,currentHoverTime:A,currentTime:ce,dimensions:_,fastForwardSpeed:$,highlight:K,initRoot:te,isBuffering:pe,isFinished:q,isPlaying:M,isSkippingInactive:O,removeHighlight:Y,replay:r,restart:ie,setCurrentHoverTime:N,setCurrentTime:ae,setSpeed:ne,speed:z,togglePlayPause:se,toggleSkipInactive:oe,...T},children:t})}b.displayName="Provider";const T=()=>(0,a.useContext)(y)},"./app/components/replays/utils.tsx":(e,t,r)=>{r.d(t,{DF:()=>c,DR:()=>d,NH:()=>o,PE:()=>m,Ul:()=>l,cs:()=>g,mr:()=>p});var a=r("../node_modules/lodash/padStart.js"),n=r.n(a);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const r=String(e);return n()(r,t,"0")}const i=36e5;function o(e,t){return Math.abs(new Date(e).getTime()-t)}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return p(o(e,t),r)}function p(e,t){if(e<=0||isNaN(e))return t?"00:00.000":"00:00";const r=Math.floor(e/i);e%=i;const a=Math.floor(e/6e4);e%=6e4;const n=Math.floor(e/1e3);let o="00:00";return o=r?`${s(r)}:${s(a)}:${s(n)}`:`${s(a)}:${s(n)}`,t&&(o=`${o}.${s(Math.floor(e%1e3),3)}`),o}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,a=Math.floor(t/r);const n=e-a*t>0?1:0;a-=n;const s=[1*i,18e5,12e5,9e5,6e5,3e5,12e4,6e4,3e4,1e4,5e3,1e3],o=s.reduce(((t,r)=>(t.set(r,Math.floor(e/r)),t)),new Map),[l,p]=Array.from(o.entries()).filter((e=>{let[t,r]=e;return r<=a})).reduce(((e,t)=>t[1]>e[1]?t:e),[0,0]),c=(e-l*p)/l;return{timespan:l,cols:p,remaining:c}}function d(e,t,r,a){const n=isNaN(t)?1:t;return r.map((t=>{const{timestamp:r}=t,s=+new Date(String(r)),i=isNaN(s)?0:s-e,o=Math.floor(i/n*(a-1))+1;return[Math.max(1,o),t]})).reduce(((e,t)=>{let[r,a]=t;return e.has(r)?e.get(r)?.push(a):e.set(r,[a]),e}),new Map)}function u(e,t){const r=e.startTimestamp<=t.startTimestamp&&t.startTimestamp<=e.endTimestamp,a=e.startTimestamp<=t.endTimestamp&&t.endTimestamp<=e.endTimestamp;return r||a}function m(e){if(!e.length)return[];const t=e.map((e=>{const t=1e3*e.startTimestamp,r=1e3*e.endTimestamp;return{spanCount:1,startTimestamp:t,endTimestamp:r,duration:r-t}})),[r,...a]=t,n=[r];for(const e of a){let t=!1;for(const r of n)if(u(r,e)){t=!0,r.spanCount+=1,r.startTimestamp=Math.min(r.startTimestamp,e.startTimestamp),r.endTimestamp=Math.max(r.endTimestamp,e.endTimestamp),r.duration=r.endTimestamp-r.startTimestamp;break}t||n.push(e)}return n}function g(e,t){return void 0===t||isNaN(t)||0===t?0:e/t}},"./app/utils/replays/replayDataUtils.tsx":(e,t,r)=>{r.d(t,{_O:()=>g,ay:()=>u,c_:()=>c,iz:()=>f,j1:()=>p,qC:()=>d,qI:()=>l,so:()=>m}),r("../node_modules/core-js/modules/es.array.includes.js");var a=r("../node_modules/lodash/first.js"),n=r.n(a),s=r("./app/components/events/interfaces/breadcrumbs/utils.tsx"),i=r("./app/locale.tsx"),o=r("./app/types/breadcrumbs.tsx");const l=e=>"memory"===e.op,p=e=>e.op.startsWith("navigation.")||e.op.startsWith("resource."),c=(e,t)=>e.filter(o.T5).filter((e=>t.includes(e.category||"")));function d(e){const t={...e.tags,...e.os?.name?{"os.name":[e.os.name]}:{},...e.os?.version?{"os.version":[e.os.version]}:{},...e.browser?.name?{"browser.name":[e.browser.name]}:{},...e.browser?.version?{"browser.version":[e.browser.version]}:{},...e.device?.name?{"device.name":[e.device.name]}:{},...e.device?.family?{"device.family":[e.device.family]}:{},...e.device?.brand?{"device.brand":[e.device.brand]}:{},...e.device?.model?{"device.model":[e.device.model]}:{},...e.sdk?.name?{"sdk.name":[e.sdk.name]}:{},...e.sdk?.version?{"sdk.version":[e.sdk.version]}:{},...e.user?.ip_address?{"user.ip_address":[e.user.ip_address]}:{}},r=Object.keys(t).sort().reduce(((e,r)=>(e[r]=t[r],e)),{});return{...e,...e.startedAt?{startedAt:new Date(e.startedAt)}:{},...e.finishedAt?{finishedAt:new Date(e.finishedAt)}:{},tags:r}}function u(e,t){const r=[].concat(t).concat({type:5,timestamp:e.finishedAt.getTime(),data:{tag:"replay-end"}});return r.sort(((e,t)=>e.timestamp-t.timestamp)),n()(r).timestamp=e.startedAt.getTime(),r}function m(e,t,r,a){const n=["ui.focus","ui.blur"],l=e.tags.url?.join(", "),p={type:o.kS.INIT,timestamp:e.startedAt.toISOString(),level:o.nU.INFO,message:l,data:{action:"replay-init",label:(0,i.t)("Start recording"),url:l}},c=t.map((e=>({type:o.kS.ERROR,level:o.nU.ERROR,category:"issue",message:e.title,data:{label:e["error.type"].join(""),eventId:e.id,groupId:e["issue.id"]||1,groupShortId:e.issue||"POKEDEX-4NN",project:e["project.name"]},timestamp:e.timestamp}))),d=a.filter((e=>["navigation.navigate","navigation.reload","largest-contentful-paint"].includes(e.op))).map((e=>{if(e.op.startsWith("navigation")){const[,t]=e.op.split(".");return{category:"default",type:o.kS.NAVIGATION,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:o.nU.INFO,message:e.description,action:t,data:{to:e.description,label:"reload"===t?(0,i.t)("Reload"):"navigate"===t?(0,i.t)("Page load"):(0,i.t)("Navigation"),...e.data}}}return{type:o.kS.DEBUG,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:o.nU.INFO,category:"default",data:{action:e.op,...e.data,label:"largest-contentful-paint"===e.op?(0,i.t)("LCP"):e.op}}})),u=a.find((e=>"navigation.navigate"===e.op)),m=r.filter((e=>!n.includes(e.category||""))).map((e=>({...e,type:o.kS.DEFAULT,timestamp:new Date(1e3*e.timestamp).toISOString()})));return(0,s.LP)([...u?[]:[p],...m,...c,...d]).sort(((e,t)=>+new Date(e.timestamp||0)-+new Date(t.timestamp||0)))}function g(e){return e.sort(((e,t)=>e.startTimestamp-t.startTimestamp)).map((e=>({...e,id:`${e.description??e.op}-${e.startTimestamp}-${e.endTimestamp}`,timestamp:1e3*e.startTimestamp})))}function f(e,t,r,a){const n=t.map((e=>e.timestamp)).filter(Boolean),s=r.map((e=>e.timestamp)).filter(Boolean).map((e=>+new Date(1e3*e))).filter(Boolean),i=a.map((e=>1e3*e.startTimestamp)),o=a.map((e=>1e3*e.endTimestamp));return{startTimestampMs:Math.min(e.startedAt.getTime(),...n,...s,...i),endTimestampMs:Math.max(e.finishedAt.getTime(),...n,...s,...o)}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_events_eventReplay_replayContent_tsx-app_utils_replays_replayDataUtils_tsx.def8969da86e128dfc18869e2783602b.js.map