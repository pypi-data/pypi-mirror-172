(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_transactionSummary_transactionReplays_index_tsx-app_views_performance_t-69f76b"],{"./app/utils/performance/quickTrace/utils.tsx":(e,t,n)=>{"use strict";n.d(t,{$J:()=>x,Ci:()=>S,R8:()=>v,S2:()=>w,_Z:()=>y,eF:()=>h,eW:()=>m,hp:()=>l,q2:()=>d,xB:()=>_,y3:()=>Z}),n("../node_modules/core-js/modules/es.error.cause.js");var r=n("../node_modules/lodash/omit.js"),s=n.n(r),a=n("../node_modules/moment-timezone/index.js"),o=n.n(a),i=n("./app/components/events/interfaces/spans/utils.tsx"),c=n("./app/constants/pageFilters.tsx"),p=n("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),u=n("./app/utils/discover/eventView.tsx");function l(e){return"transaction"===e.type}function d(e,t){return l(t)?e.event_id===t.id:void 0!==e.errors&&e.errors.some((e=>e.event_id===t.id))}function m(e,t){const n=[],r=[],s=[{event:t,path:[]}];for(;s.length;){const t=s.shift();if(d(t.event,e)){for(const e of t.path)n.push(e);r.push(t.event)}else{const e=[...t.path,f(t.event)];for(const n of t.event.children)s.push({event:n,path:e})}}if(!r.length)throw new Error("No relevant path exists!");for(;r.length;){const e=r.shift();for(const t of e.children)r.push(t);n.push(f(e))}return n}function f(e){return s()(e,["children"])}function v(e,t,n){const{type:r,trace:s}=e;if("empty"===r||null===s)throw new Error("Current event not in trace navigator!");const a="full"===r,o=s.find((e=>d(e,t)))??null;if(null===o)throw new Error("Current event not in trace navigator!");const i=o.parent_event_id?s.find((e=>e.event_id===o.parent_event_id))??null:null,c=s.find((e=>e.event_id!==o.event_id&&e.event_id!==i?.event_id&&0===e.generation))??null,u=a?[]:null,l=[],m=a?[]:null,f=new Set;return s.forEach((e=>{f.add(e.project_id),(e=>e.parent_event_id===o.event_id)(e)?l.push(e):a&&((e=>null!==o.generation&&null!==e.generation&&e.generation>0&&o.generation-1>e.generation)(e)?u?.push(e):(e=>null!==o.generation&&null!==e.generation&&o.generation+1<e.generation)(e)&&m?.push(e))})),a&&f.size>1&&function(e,t){(0,p.Z)("quick_trace.connected_services",{organization:e.id,projects:t})}(n,f.size),{root:c,ancestors:null===u?null:g(u),parent:i,current:o,children:g(l),descendants:null===m?null:g(m)}}function g(e){return e.sort(((e,t)=>t["transaction.duration"]-e["transaction.duration"]))}function h(e){let{eventView:t,location:n}=e;return s()(t.getEventsAPIPayload(n),["field","sort","per_page"])}function y(e){let{start:t,end:n,statsPeriod:r}=e;return u.ZP.fromSavedQuery({id:void 0,version:2,name:"",fields:["transaction.duration"],projects:[c.mP],query:"",environment:[],start:t,end:n,range:r??void 0})}function x(e){const t=l(e)?e.startTimestamp:o()(e.dateReceived?e.dateReceived:e.dateCreated).valueOf()/1e3,n=l(e)?e.endTimestamp:t;return(0,i.TC)({start:t,end:n})}function w(e,t,n){let r=n;const s=[e];for(;s.length;){const e=s.pop();for(const t of e.children)s.push(t);r=t(r,e)}return r}function _(e,t){return w(e,((e,n)=>(t(n)&&e.push(n),e)),[])}function Z(e){return Boolean(e.event_id)}function S(e){return Boolean(e.event_id)}},"./app/utils/performance/urls.ts":(e,t,n)=>{"use strict";n.d(t,{D:()=>a});var r=n("./app/components/events/interfaces/spans/utils.tsx"),s=n("./app/utils.tsx");function a(e,t,n,a,o){const i={...a||{},transaction:n};(0,s.ri)(i.transaction)||delete i.transaction;const c={pathname:`/organizations/${e}/performance/${t}/`,query:i,hash:(0,s.ri)(o)?(0,r.ct)(o):void 0};return(0,s.ri)(c.hash)||delete c.hash,c}},"./app/views/performance/traceDetails/utils.tsx":(e,t,n)=>{"use strict";n.d(t,{Rg:()=>o,YA:()=>a,uM:()=>i});var r=n("./app/constants/pageFilters.tsx"),s=n("./app/utils/performance/quickTrace/utils.tsx");function a(e,t,n,s){const{start:a,end:o,statsPeriod:i}=n;return{pathname:`/organizations/${e.slug}/performance/trace/${t}/`,query:{...s,statsPeriod:i,[r.V.PAGE_START]:a,[r.V.PAGE_END]:o}}}function o(e){const t={projects:new Set,errors:new Set,transactions:new Set,startTimestamp:Number.MAX_SAFE_INTEGER,endTimestamp:0,maxGeneration:0};return e.reduce(((e,t)=>(0,s.S2)(t,((e,t)=>{for(const n of t.errors??[])e.errors.add(n.event_id);return e.transactions.add(t.event_id),e.projects.add(t.project_slug),e.startTimestamp=Math.min(e.startTimestamp,t.start_timestamp),e.endTimestamp=Math.max(e.endTimestamp,t.timestamp),e.maxGeneration=Math.max(e.maxGeneration,t.generation),e}),e)),t)}function i(e){return null===e.parent_span_id}},"./app/views/performance/transactionSummary/transactionReplays/index.tsx":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Q});var r=n("../node_modules/react/index.js"),s=n("./app/components/acl/feature.tsx"),a=n("./app/components/alert.tsx"),o=n("./app/components/layouts/thirds.tsx"),i=n("./app/components/loadingIndicator.tsx"),c=n("./app/locale.tsx"),p=n("./app/styles/organization.tsx"),u=n("./app/utils/discover/eventView.tsx"),l=n("./app/utils/discover/fields.tsx"),d=n("./app/utils/queryString.tsx"),m=n("./app/utils/tokenizeSearch.tsx"),f=n("./app/utils/withOrganization.tsx"),v=n("./app/utils/withProjects.tsx"),g=n("./app/views/performance/transactionSummary/filter.tsx"),h=n("./app/views/performance/transactionSummary/pageLayout.tsx"),y=n("./app/views/performance/transactionSummary/tabs.tsx"),x=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),w=n("../node_modules/react-router/es/index.js"),_=n("../node_modules/lodash/first.js"),Z=n.n(_),S=n("../node_modules/lodash/omit.js"),j=n.n(S),q=n("./app/components/datePageFilter.tsx"),z=n("./app/components/environmentPageFilter.tsx"),E=n("./app/components/events/searchBar.tsx"),T=n("./app/components/organizations/pageFilterBar.tsx"),b=n("./app/components/organizations/pageFilters/parse.tsx"),F=n("./app/components/pagination.tsx"),R=n("./app/styles/space.tsx"),P=n("./app/utils.tsx"),V=n("./app/views/replays/replayTable.tsx"),k=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function A(e){let{eventView:t,isFetching:n,location:r,organization:s,pageLinks:a,replays:i}=e;const c=r.query;return(0,k.BX)(o.or,{fullWidth:!0,children:[(0,k.BX)(C,{children:[(0,k.BX)(T.Z,{condensed:!0,children:[(0,k.tZ)(z.Z,{}),(0,k.tZ)(q.Z,{alignDropdown:"left"})]}),(0,k.tZ)(E.Z,{organization:s,projectIds:t.project,query:c.query,fields:t.fields,onSearch:(p="query",function(e){const t=(0,b.fK)({...r.query||{},[p]:e}),n=["cursor"];(0,P.ri)(e)||n.push(p);const s=j()(t,n);w.browserHistory.push({...r,query:s})})})]}),(0,k.tZ)(V.Z,{isFetching:n,replays:i,showProjectColumn:!1,sort:Z()(t.sorts)||{field:"startedAt",kind:"asc"},showSlowestTxColumn:!0}),(0,k.tZ)(F.Z,{pageLinks:a})]});var p}A.displayName="ReplaysContent";const C=(0,x.Z)("div",{target:"er3ps120"})("display:grid;gap:",(0,R.Z)(2),";margin-bottom:",(0,R.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints.small),"){grid-template-columns:auto 1fr;}"),$=A;var I=n("./app/utils/discover/genericDiscoverQuery.tsx"),N=n("./app/utils/replays/fetchReplayList.tsx"),D=n("./app/utils/useApi.tsx");function L(){return(0,k.tZ)(p.JH,{children:(0,k.tZ)(a.Z,{type:"warning",children:(0,c.t)("You don't have access to this feature")})})}function B(e){const{location:t,organization:n,projects:r}=e;return(0,k.tZ)(s.Z,{features:["session-replay-ui"],organization:n,renderDisabled:L,children:(0,k.tZ)(h.ZP,{location:t,organization:n,projects:r,tab:y.Z.Replays,getDocumentTitle:W,generateEventView:G,childComponent:M})})}function M(e){let{eventView:t,location:n,organization:s,setError:a}=e;const{eventView:c,replays:p,pageLinks:l,isFetching:m,fetchError:f}=function(e){let{eventsWithReplaysView:t,location:n,organization:s}=e;const a=(0,D.Z)(),[o,i]=(0,r.useState)({fetchError:void 0,isFetching:!0,pageLinks:null,replays:[],eventView:void 0}),c=(0,r.useCallback)((async()=>{const e=await async function(e){let{api:t,eventView:n,location:r,organization:s}=e;try{const[e]=await(0,I.AA)(t,`/organizations/${s.slug}/events/`,n.getEventsAPIPayload(r));return e.data}catch(e){return null}}({api:a,eventView:t,location:n,organization:s}),r=e?.map((e=>e.replayId)),o=u.ZP.fromNewQueryWithLocation({id:"",name:"Replays within a transaction",version:2,fields:N.p8,projects:[],query:`id:[${String(r)}]`},n);o.sorts=(0,u.vp)((0,d.ro)(n.query.sort,N.yw));const c=await(0,N.ZP)({api:a,eventView:o,location:n,organization:s}),p=c.replays?.map((t=>{let n;for(const r of e??[])r.replayId===t.id&&(!n||r["transaction.duration"]>n["transaction.duration"])&&(n=r);return{...t,txEvent:n??{}}}));i({...c,eventView:o,replays:p})}),[a,t,n,s]);return(0,r.useEffect)((()=>{c()}),[c]),o}({eventsWithReplaysView:t,location:n,organization:s});return(0,r.useEffect)((()=>{a(f?.message)}),[a,f]),m||!c?(0,k.tZ)(o.or,{fullWidth:!0,children:(0,k.tZ)(i.Z,{})}):p?(0,k.tZ)($,{eventView:c,isFetching:m,location:n,organization:s,pageLinks:l,replays:p}):(0,k.tZ)(r.Fragment,{children:null})}function W(e){return"string"==typeof e&&String(e).trim().length>0?[String(e).trim(),(0,c.t)("Replays")].join(" — "):[(0,c.t)("Summary"),(0,c.t)("Replays")].join(" — ")}function G(e){let{location:t,transactionName:n}=e;const r=["replayId","count()","transaction.duration","trace","timestamp"],s=(0,g.q0)(t);s!==g.f1.None?r.push(`spans.${s}`):r.push(...l.$4,l.zD);const a=(0,d.ro)(t.query.query,""),o=new m.MY(a);return o.addFilterValues("transaction",[n]),o.addFilterValues("!replayId",[""]),u.ZP.fromNewQueryWithLocation({id:"",name:"Replay events within a transaction",version:2,fields:r,query:o.formatString(),projects:[],orderby:(0,d.ro)(t.query.sort,"-timestamp")},t)}L.displayName="renderNoAccess",B.displayName="TransactionReplays";const Q=(0,v.Z)((0,f.Z)(B))},"./app/views/performance/transactionSummary/utils.tsx":(e,t,n)=>{"use strict";n.d(t,{K0:()=>u,MF:()=>g,PU:()=>d,Z6:()=>f,e1:()=>m,uI:()=>h,vd:()=>v,xf:()=>l});var r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("./app/styles/space.tsx"),a=n("./app/utils/discover/urls.tsx"),o=n("./app/utils/getRouteStringFromRoutes.tsx"),i=n("./app/utils/performance/urls.ts"),c=n("./app/utils/tokenizeSearch.tsx"),p=n("./app/views/performance/traceDetails/utils.tsx");let u;function l(e){const t=d(e);return t.removeFilter("transaction"),t}function d(e){const t=new c.MY(e);return t.removeFilter("event.type"),t}function m(e){let{orgSlug:t,transaction:n,projectID:r,query:s,unselectedSeries:a="p100()",display:o,trendFunction:i,trendColumn:c,showTransactions:p,additionalQuery:u}=e;const d=function(e){let{orgSlug:t}=e;return`/organizations/${t}/performance/summary/`}({orgSlug:t});let m;return m="string"==typeof s.query?l(s.query).formatString():s.query,{pathname:d,query:{transaction:n,project:r,environment:s.environment,statsPeriod:s.statsPeriod,start:s.start,end:s.end,query:m,unselectedSeries:a,showTransactions:p,display:o,trendFunction:i,trendColumn:c,...u}}}function f(e){return(t,n,r)=>{const s=`${n.trace}`;return s?(0,p.YA)(t,s,e,{}):{}}}function v(e){return(t,n,r,s)=>{const o=(0,a.JE)(n);return(0,i.D)(t.slug,o,e,r,s)}}function g(e){return(t,n,r)=>{const s=n.replayId;if(!s)return{};const a=`${n["project.name"]}:${s}`,i=encodeURIComponent((0,o.Z)(e));return{pathname:`/organizations/${t.slug}/replays/${a}`,query:{referrer:i}}}}!function(e){e.FASTEST="fastest",e.SLOW="slow",e.OUTLIER="outlier",e.RECENT="recent"}(u||(u={}));const h=(0,r.Z)("div",{target:"e1radvp0"})("margin-top:",(0,s.Z)(3),";")},"../node_modules/lodash/_baseExtremum.js":(e,t,n)=>{var r=n("../node_modules/lodash/isSymbol.js");e.exports=function(e,t,n){for(var s=-1,a=e.length;++s<a;){var o=e[s],i=t(o);if(null!=i&&(void 0===c?i==i&&!r(i):n(i,c)))var c=i,p=o}return p}},"../node_modules/lodash/_baseGt.js":e=>{e.exports=function(e,t){return e>t}}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_transactionSummary_transactionReplays_index_tsx-app_views_performance_t-69f76b.23572a90a826b87cbe09460626b82f17.js.map