"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_events_searchBar_tsx-app_utils_performance_contexts_metricsCardinality_tsx-app-9a3293"],{"./app/components/events/searchBar.tsx":(e,t,s)=>{s.d(t,{Z:()=>C}),s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/core-js/modules/es.error.cause.js");var n=s("../node_modules/react/index.js"),r=s("../node_modules/lodash/assign.js"),o=s.n(r),a=s("../node_modules/lodash/flatten.js"),i=s.n(a),l=s("../node_modules/lodash/memoize.js"),c=s.n(l),d=s("../node_modules/lodash/omit.js"),u=s.n(d),p=s("./app/actionCreators/tags.tsx"),m=s("./app/components/smartSearchBar/index.tsx"),h=s("./app/constants/index.tsx"),g=s("./app/types/index.tsx"),f=s("./app/utils.tsx"),y=s("./app/utils/discover/fields.tsx"),b=s("./app/utils/fields/index.ts"),x=s("./app/utils/measurements/measurements.tsx"),j=s("./app/utils/useApi.tsx"),v=s("./app/utils/withTags.tsx"),T=s("./app/views/dashboardsV2/utils.tsx"),Z=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const S=new RegExp(`^${h.c$}|\\${h.ir}`,"g");function w(e){const{maxSearchItems:t,organization:s,tags:r,omitTags:a,fields:l,projectIds:d,includeSessionTagsValues:h,maxMenuHeight:v,customMeasurements:w}=e,C=(0,j.Z)();(0,n.useEffect)((()=>{_.cache.clear?.()}),[d]);const _=c()(((e,t,n)=>{const r=d?.map(String);return(0,y.h1)(e.key)||(0,y.Xr)(e.key)?Promise.resolve([]):(0,p.Fo)(C,s.slug,e.key,t,r,n,!0,h).then((e=>i()(e.filter((e=>{let{name:t}=e;return(0,f.ri)(t)})).map((e=>{let{name:t}=e;return t})))),(()=>{throw new Error("Unable to fetch event field values")}))}),((e,t)=>{let{key:s}=e;return`${s}-${t}`})),P=e=>{const t=(e=>Object.fromEntries(e.filter((e=>!Object.keys(y.wZ).includes(e.field)&&!(0,y.GO)(e.field)&&!(0,T.nk)(e.field))).map((e=>[e.field,{key:e.field,name:e.field,kind:b.IV.FUNCTION}]))))(l??[]),n=Object.fromEntries(Object.keys(y.wZ).map((e=>[e,{...y.wZ[e],kind:b.IV.FIELD}]))),i=(e=>Object.fromEntries(Object.keys(e).map((t=>[t,{...e[t],kind:b.IV.MEASUREMENT}]))))(e),c=Object.fromEntries(y.$4.map((e=>[e,{key:e,name:e,kind:b.IV.METRICS}]))),d=Object.fromEntries(Object.keys(y.jg).map((e=>[e,{...y.jg[e],kind:b.IV.FIELD}]))),p=s.features.includes("performance-view")?Object.assign({},i,c,n,t):u()(n,y.J8),m=Object.fromEntries(Object.keys(r).map((e=>[e,{...r[e],kind:b.IV.TAG}])));o()(p,m,n,d);const h=Object.keys(p);return h.sort(((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase()))),p.has={key:b.Sh.HAS,name:"Has property",values:h,predefined:!0,kind:b.IV.FIELD},u()(p,a??[])};return(0,Z.tZ)(x.Z,{children:s=>{let{measurements:n}=s;return(0,Z.tZ)(m.Z,{hasRecentSearches:!0,savedSearchType:g.L4.EVENT,onGetTagValues:_,supportedTags:P({...n,...w??{}}),prepareQuery:e=>e.replace(S,""),maxSearchItems:t,excludedTags:["environment"],maxMenuHeight:v??300,customPerformanceMetrics:w,...e})}})}w.displayName="SearchBar";const C=(0,v.Z)(w)},"./app/utils/performance/contexts/metricsCardinality.tsx":(e,t,s)=>{s.d(t,{BT:()=>x,e0:()=>j});var n=s("../node_modules/react/index.js"),r=s("./app/utils/dates.tsx"),o=s("./app/utils/discover/eventView.tsx"),a=s("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),i=s("../node_modules/lodash/omit.js"),l=s.n(i),c=s("./app/utils/discover/genericDiscoverQuery.tsx"),d=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function u(e){let{eventView:t,location:s}=e;return l()(t.getEventsAPIPayload(s),["field","sort","per_page","query"])}function p(e){let{children:t,...s}=e;return(0,d.tZ)(c.ZP,{route:"metrics-compatibility-sums",getRequestPayload:u,...s,children:e=>{let{tableData:s,...n}=e;return t({tableData:s,...n})}})}function m(e){let{eventView:t,location:s}=e;return l()(t.getEventsAPIPayload(s),["field","sort","per_page","query"])}function h(e){let{children:t,...s}=e;return(0,d.tZ)(c.ZP,{route:"metrics-compatibility",getRequestPayload:m,...s,children:e=>{let{tableData:s,...n}=e;return t({tableData:s,...n})}})}p.displayName="MetricsCompatibilityQuery",h.displayName="MetricsCompatibilitySumsQuery";var g=s("./app/utils/performance/contexts/utils.tsx");const[f,y,b]=(0,g.n)({name:"MetricsCardinalityContext",strict:!1}),x=e=>{if(!(0,a.gp)(e.organization))return(0,d.tZ)(f,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:e.children});const t={location:e.location,orgSlug:e.organization.slug,cursor:"0:0:0"},s=o.ZP.fromLocation(e.location);s.fields=[{field:"tpm()"}];const i=function(e){const t=e.clone();return t.start||t.end||(t.statsPeriod?(0,r.YJ)(t.statsPeriod)>1&&(t.statsPeriod="1h",t.start=void 0,t.end=void 0):(t.statsPeriod="1h",t.start=void 0,t.end=void 0)),t}(s);return(0,d.tZ)(n.Fragment,{children:(0,d.tZ)(p,{eventView:i,...t,children:s=>(0,d.tZ)(h,{eventView:i,...t,children:t=>(0,d.tZ)(f,{value:{isLoading:s.isLoading||t.isLoading,outcome:s.isLoading||t.isLoading?void 0:v(s.tableData&&t.tableData?{...s.tableData,...t.tableData}:null,!!s.error&&!!t.error)},children:e.children})})})})};x.displayName="MetricsCardinalityProvider",b.Consumer;const j=y;function v(e,t){const s={forceTransactionsOnly:!0};if(!e)return s;const n=e.compatible_projects;return t?s:e?function(e){const t=T(e);return!e.dynamic_sampling_projects?.length||0===t.metricsCount}(e)||function(e){return!T(e).metricsCount}(e)?s:function(e){return T(e).nullCount>0}(e)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:n}:function(e){const t=T(e);return t.unparamCount>=t.metricsCount}(e)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:n}:function(e){return T(e).unparamCount>0}(e)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:n,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:s}function T(e){let{sum:t}=e;try{const e=Number(t.metrics);return{metricsCount:e,unparamCount:Number(t.metrics_unparam),nullCount:Number(t.metrics_null)}}catch(e){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/utils/performance/histogram/utils.tsx":(e,t,s)=>{s.d(t,{GT:()=>a,_W:()=>o,te:()=>r}),s("../node_modules/core-js/modules/es.error.cause.js");var n=s("./app/utils/formatters.tsx");function r(e){return e.length>=2?e[1].bin-e[0].bin:0}function o(e){const t=r(e);return e.map((e=>{const s=e.bin;return{start:s,end:s+t}}))}function a(e){let{precision:t,type:s,additionalFieldsFn:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=e=>{switch(s){case"duration":const r=t??(e<1e3?0:3);return(0,n.g9)(e/1e3,r,!0);case"number":const o=10**(t??0);return(Math.round((e+Number.EPSILON)*o)/o).toLocaleString();default:throw new Error(`Unable to format type: ${s}`)}};return e.map((e=>({value:e.count,name:o(e.bin),...r?.(e.bin)??{}})))}},"./app/utils/withTags.tsx":(e,t,s)=>{s.d(t,{Z:()=>l});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/react/index.js"),o=s("./app/stores/tagStore.tsx"),a=s("./app/utils/getDisplayName.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const l=function(e){class t extends r.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{tags:o.Z.getState()}),(0,n.Z)(this,"unsubscribe",o.Z.listen((e=>this.setState({tags:e})),void 0))}componentWillUnmount(){this.unsubscribe()}render(){const{tags:t,...s}=this.props;return(0,i.tZ)(e,{tags:t??this.state.tags,...s})}}return t.displayName="WithTags",(0,n.Z)(t,"displayName",`withTags(${(0,a.Z)(e)})`),t}},"./app/views/performance/transactionSummary/transactionEvents/utils.tsx":(e,t,s)=>{s.d(t,{Zq:()=>p,_S:()=>l,q3:()=>i,qg:()=>u,tb:()=>d,xr:()=>c}),s("../node_modules/core-js/modules/es.array.includes.js");var n=s("./app/locale.tsx"),r=s("./app/utils/queryString.tsx"),o=s("./app/views/performance/transactionSummary/filter.tsx"),a=s("./app/views/performance/transactionSummary/utils.tsx");let i;function l(e,t){const{p99:s,p95:r,p75:a,p50:l}=t||{p99:0,p95:0,p75:0,p50:0};return{[i.p50]:{name:i.p50,query:l?[["transaction.duration",`<=${l.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,o.T$)(e)||"transaction.duration"},label:(0,n.t)("p50")},[i.p75]:{name:i.p75,query:a?[["transaction.duration",`<=${a.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,o.T$)(e)||"transaction.duration"},label:(0,n.t)("p75")},[i.p95]:{name:i.p95,query:r?[["transaction.duration",`<=${r.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,o.T$)(e)||"transaction.duration"},label:(0,n.t)("p95")},[i.p99]:{name:i.p99,query:s?[["transaction.duration",`<=${s.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,o.T$)(e)||"transaction.duration"},label:(0,n.t)("p99")},[i.p100]:{name:i.p100,label:(0,n.t)("p100")}}}function c(e){let{orgSlug:t,transaction:s,projectID:n,query:r}=e;return{pathname:`/organizations/${t}/performance/summary/events/`,query:{transaction:s,project:n,environment:r.environment,statsPeriod:r.statsPeriod,start:r.start,end:r.end,query:r.query}}}function d(e){return t=(0,r.ro)(e.query.showTransactions,i.p100),Object.values(i).includes(t)?t:i.p100;var t}function u(e,t){const s=l(t),n=s[e].sort?.kind,r=s[e].sort?.field,o={showTransactions:e};return n&&r&&(o.sort=`${"desc"===n?"-":""}${r}`),o}function p(e){switch(e){case a.K0.OUTLIER:return i.p100;case a.K0.SLOW:return i.p95;default:return}}!function(e){e.p50="p50",e.p75="p75",e.p95="p95",e.p99="p99",e.p100="p100"}(i||(i={}))},"./app/views/performance/transactionSummary/transactionThresholdModal.tsx":(e,t,s)=>{s.d(t,{ZP:()=>k,fY:()=>P});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=s("../node_modules/react/index.js"),a=s("../node_modules/lodash/cloneDeep.js"),i=s.n(a),l=s("../node_modules/lodash/set.js"),c=s.n(l),d=s("./app/actionCreators/indicator.tsx"),u=s("./app/components/button.tsx"),p=s("./app/components/buttonBar.tsx"),m=s("./app/components/forms/controls/selectControl.tsx"),h=s("./app/components/forms/field/index.tsx"),g=s("./app/components/input.tsx"),f=s("./app/components/links/link.tsx"),y=s("./app/locale.tsx"),b=s("./app/styles/space.tsx"),x=s("./app/utils.tsx"),j=s("./app/utils/withApi.tsx"),v=s("./app/utils/withProjects.tsx"),T=s("./app/views/performance/transactionSummary/utils.tsx"),Z=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let S;!function(e){e.TRANSACTION_DURATION="duration",e.LARGEST_CONTENTFUL_PAINT="lcp"}(S||(S={}));const w=[{label:(0,y.t)("Transaction Duration"),value:"duration"},{label:(0,y.t)("Largest Contentful Paint"),value:"lcp"}];class C extends o.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{threshold:this.props.transactionThreshold,metric:this.props.transactionThresholdMetric,error:null}),(0,n.Z)(this,"handleApply",(e=>{e.preventDefault();const{api:t,closeModal:s,organization:n,transactionName:r,onApply:o}=this.props,a=this.getProject();if(!(0,x.ri)(a))return;const i=`/organizations/${n.slug}/project-transaction-threshold-override/`;t.requestPromise(i,{method:"POST",includeAllArgs:!0,query:{project:a.id},data:{transaction:r,threshold:this.state.threshold,metric:this.state.metric}}).then((()=>{s(),o&&o(this.state.threshold,this.state.metric)})).catch((e=>{this.setState({error:e});const t=e.responseJSON?.threshold??e.responseJSON?.non_field_errors??null;(0,d.Iw)(t)}))})),(0,n.Z)(this,"handleFieldChange",(e=>t=>{this.setState((s=>{const n=i()(s);return c()(n,e,t),{...n,errors:void 0}}))})),(0,n.Z)(this,"handleReset",(e=>{e.preventDefault();const{api:t,closeModal:s,organization:n,transactionName:r,onApply:o}=this.props,a=this.getProject();if(!(0,x.ri)(a))return;const i=`/organizations/${n.slug}/project-transaction-threshold-override/`;t.requestPromise(i,{method:"DELETE",includeAllArgs:!0,query:{project:a.id},data:{transaction:r}}).then((()=>{const e=`/projects/${n.slug}/${a.slug}/transaction-threshold/configure/`;this.props.api.requestPromise(e,{method:"GET",includeAllArgs:!0,query:{project:a.id}}).then((e=>{let[t]=e;this.setState({threshold:t.threshold,metric:t.metric}),s(),o&&o(this.state.threshold,this.state.metric)})).catch((e=>{const t=e.responseJSON?.threshold??null;(0,d.Iw)(t)}))})).catch((e=>{this.setState({error:e})}))}))}getProject(){const{projects:e,eventView:t,project:s}=this.props;if((0,x.ri)(s))return e.find((e=>e.id===s));const n=String(t.project[0]);return e.find((e=>e.id===n))}renderModalFields(){return(0,Z.BX)(o.Fragment,{children:[(0,Z.tZ)(h.Z,{"data-test-id":"response-metric",label:(0,y.t)("Calculation Method"),inline:!1,help:(0,y.t)("This determines which duration metric is used for the Response Time Threshold."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,Z.tZ)(m.Z,{required:!0,options:w.slice(),name:"responseMetric",label:(0,y.t)("Calculation Method"),value:this.state.metric,onChange:e=>{this.handleFieldChange("metric")(e.value)}})}),(0,Z.tZ)(h.Z,{"data-test-id":"response-time-threshold",label:(0,y.t)("Response Time Threshold (ms)"),inline:!1,help:(0,y.t)("The satisfactory response time for the calculation method defined above. This is used to calculate Apdex and User Misery scores."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,Z.tZ)(g.Z,{type:"number",name:"threshold",required:!0,pattern:"[0-9]*(\\.[0-9]*)?",onChange:e=>{this.handleFieldChange("threshold")(e.target.value)},value:this.state.threshold,step:100,min:100})})]})}render(){const{Header:e,Body:t,Footer:s,organization:n,transactionName:r,eventView:a}=this.props,i=this.getProject(),l=a.clone();l.query=l.getQueryWithAdditionalConditions();const c=(0,T.e1)({orgSlug:n.slug,transaction:r,query:l.generateQueryStringObject(),projectID:i?.id});return(0,Z.BX)(o.Fragment,{children:[(0,Z.tZ)(e,{closeButton:!0,children:(0,Z.tZ)("h4",{children:(0,y.t)("Transaction Settings")})}),(0,Z.BX)(t,{children:[(0,Z.tZ)(_,{children:(0,y._N)("The changes below will only be applied to [transaction]. To set it at a more global level, go to [projectSettings: Project Settings].",{transaction:(0,Z.tZ)(f.Z,{to:c,children:r}),projectSettings:(0,Z.tZ)(f.Z,{to:`/settings/${n.slug}/projects/${i?.slug}/performance/`})})}),this.renderModalFields()]}),(0,Z.tZ)(s,{children:(0,Z.BX)(p.ZP,{gap:1,children:[(0,Z.tZ)(u.ZP,{priority:"default",onClick:this.handleReset,"data-test-id":"reset-all",children:(0,y.t)("Reset All")}),(0,Z.tZ)(u.ZP,{"aria-label":(0,y.t)("Apply"),priority:"primary",onClick:this.handleApply,"data-test-id":"apply-threshold",children:(0,y.t)("Apply")})]})})]})}}C.displayName="TransactionThresholdModal";const _=(0,r.Z)("div",{target:"ezg6l150"})("margin-bottom:",(0,b.Z)(4),";"),P={name:"9w3zq5",styles:"width:100%;max-width:650px;margin:70px auto"},k=(0,j.Z)((0,v.Z)(C))}}]);
//# sourceMappingURL=../sourcemaps/app_components_events_searchBar_tsx-app_utils_performance_contexts_metricsCardinality_tsx-app-9a3293.5e5502e1bead3fe3b6fc400b1844b63c.js.map