"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_index_tsx"],{"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,r)=>{r.d(t,{AA:()=>f,JC:()=>x,ZP:()=>v,o:()=>m});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=(r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/react/index.js")),o=r("../node_modules/@tanstack/react-query/build/umd/index.production.js"),i=r("./app/api.tsx"),a=r("./app/locale.tsx"),c=r("./app/utils/discover/eventView.tsx"),u=r("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=r("./app/views/organizationContext.tsx"),d=r("./app/utils/useApi.tsx"),p=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class m{constructor(e,t){(0,n.Z)(this,"message",void 0),(0,n.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class h extends s.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new i.KU}),(0,n.Z)(this,"_shouldRefetchData",(e=>{const t=y(this.props),r=y(e);return!(0,c.ze)(t,r)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,n.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new m(t,e);const r=t?.message;return new m("string"==typeof r?r:(0,a.t)("An unknown error occurred."),e)})),(0,n.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:r,didFetch:n,eventView:s,orgSlug:o,route:i,setError:a}=this.props,{api:c}=this.state;if(!s.isValid())return;const u=`/organizations/${o}/${i}/`,l=Symbol("tableFetchID"),d=y(this.props);this.setState({isLoading:!0,tableFetchID:l}),a?.(void 0),t?.(c),c.clear();try{const[t,,s]=await f(c,u,d,e);if(this.state.tableFetchID!==l)return;const o=r?r(t,this.props):t;n?.(o),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:s?.getResponseHeader("Link")??e.pageLinks,tableData:o})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),a&&a(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),r=!1===e.eventView.isValid()&&this.props.eventView.isValid(),n=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||r||n)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:r,pageLinks:n}=this.state,s={isLoading:e,error:t,tableData:r,pageLinks:n};return(0,this.props.children)?.(s)}}function g(e){const t=(0,s.useContext)(l.g)?.slug,r=(0,s.useContext)(u.uL)?.eventView,n=e.orgSlug??t,o=e.eventView??r;if(void 0===n||void 0===o)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const i={...e,orgSlug:n,eventView:o};return(0,p.tZ)(h,{...i})}function f(e,t,r,n){return n?.batchRequest?n.batchRequest(e,t,{query:r,includeAllArgs:!0}):e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...r}})}function y(e){const{cursor:t,limit:r,noPagination:n,referrer:s,getRequestPayload:o,eventView:i,location:a,forceAppendRawQueryString:c}=e,u=o?o(e):i.getEventsAPIPayload(a,c);return t&&(u.cursor=t),r&&(u.per_page=r),n&&(u.noPagination=n),s&&(u.referrer=s),Object.assign(u,e.queryExtras??{}),u}function x(e){const t=(0,d.Z)(),{orgSlug:r,route:n}=e,s=`/organizations/${r}/${n}/`,i=y(e);return(0,o.useQuery)([n,i],(async()=>{const[r]=await f(t,s,i,e.queryBatching);return r}))}h.displayName="_GenericDiscoverQuery",g.displayName="GenericDiscoverQuery";const v=g},"./app/utils/performance/contexts/metricsCardinality.tsx":(e,t,r)=>{r.d(t,{BT:()=>v,e0:()=>b});var n=r("../node_modules/react/index.js"),s=r("./app/utils/dates.tsx"),o=r("./app/utils/discover/eventView.tsx"),i=r("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),a=r("../node_modules/lodash/omit.js"),c=r.n(a),u=r("./app/utils/discover/genericDiscoverQuery.tsx"),l=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{eventView:t,location:r}=e;return c()(t.getEventsAPIPayload(r),["field","sort","per_page","query"])}function p(e){let{children:t,...r}=e;return(0,l.tZ)(u.ZP,{route:"metrics-compatibility-sums",getRequestPayload:d,...r,children:e=>{let{tableData:r,...n}=e;return t({tableData:r,...n})}})}function m(e){let{eventView:t,location:r}=e;return c()(t.getEventsAPIPayload(r),["field","sort","per_page","query"])}function h(e){let{children:t,...r}=e;return(0,l.tZ)(u.ZP,{route:"metrics-compatibility",getRequestPayload:m,...r,children:e=>{let{tableData:r,...n}=e;return t({tableData:r,...n})}})}p.displayName="MetricsCompatibilityQuery",h.displayName="MetricsCompatibilitySumsQuery";var g=r("./app/utils/performance/contexts/utils.tsx");const[f,y,x]=(0,g.n)({name:"MetricsCardinalityContext",strict:!1}),v=e=>{if(!(0,i.gp)(e.organization))return(0,l.tZ)(f,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:e.children});const t={location:e.location,orgSlug:e.organization.slug,cursor:"0:0:0"},r=o.ZP.fromLocation(e.location);r.fields=[{field:"tpm()"}];const a=function(e){const t=e.clone();return t.start||t.end||(t.statsPeriod?(0,s.YJ)(t.statsPeriod)>1&&(t.statsPeriod="1h",t.start=void 0,t.end=void 0):(t.statsPeriod="1h",t.start=void 0,t.end=void 0)),t}(r);return(0,l.tZ)(n.Fragment,{children:(0,l.tZ)(p,{eventView:a,...t,children:r=>(0,l.tZ)(h,{eventView:a,...t,children:t=>(0,l.tZ)(f,{value:{isLoading:r.isLoading||t.isLoading,outcome:r.isLoading||t.isLoading?void 0:P(r.tableData&&t.tableData?{...r.tableData,...t.tableData}:null,!!r.error&&!!t.error)},children:e.children})})})})};v.displayName="MetricsCardinalityProvider",x.Consumer;const b=y;function P(e,t){const r={forceTransactionsOnly:!0};if(!e)return r;const n=e.compatible_projects;return t?r:e?function(e){const t=w(e);return!e.dynamic_sampling_projects?.length||0===t.metricsCount}(e)||function(e){return!w(e).metricsCount}(e)?r:function(e){return w(e).nullCount>0}(e)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:n}:function(e){const t=w(e);return t.unparamCount>=t.metricsCount}(e)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:n}:function(e){return w(e).unparamCount>0}(e)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:n,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:r}function w(e){let{sum:t}=e;try{const e=Number(t.metrics);return{metricsCount:e,unparamCount:Number(t.metrics_unparam),nullCount:Number(t.metrics_null)}}catch(e){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/utils/performance/contexts/metricsEnhancedSetting.tsx":(e,t,r)=>{r.d(t,{Ar:()=>g,Eg:()=>v,gp:()=>y,kP:()=>x,nP:()=>p,nl:()=>m,oR:()=>h,tm:()=>f}),r("../node_modules/core-js/modules/es.array.includes.js");var n=r("../node_modules/react/index.js"),s=r("../node_modules/react-router/es/index.js"),o=(r("./app/utils/localStorage.tsx"),r("./app/utils/queryString.tsx")),i=r("./app/utils/useOrganization.tsx"),a=r("./app/utils/performance/contexts/utils.tsx"),c=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const[u,l,d]=(0,a.n)({name:"MetricsEnhancedSettingContext"}),p=d.Consumer;let m,h;!function(e){e.unset="unset",e.metrics="metrics",e.transactions="transactions"}(m||(m={})),function(e){e.auto="auto",e.metricsOnly="metricsOnly",e.transactionsOnly="transactionsOnly"}(h||(h={}));const g="metricSetting",f="metricSearchSetting";function y(e){const t=function(e){return e.features.includes("performance-use-metrics")}(e),r=e.features.includes("performance-transaction-name-only-search"),n=e.features.includes("server-side-sampling")&&e.features.includes("mep-rollout-flag");return t||r||n}const x=e=>{let{children:t,location:r,_hasMEPState:a,forceTransactions:l}=e;const d=y((0,i.Z)()),p=[h.metricsOnly,h.transactionsOnly],f=r?(0,o.ro)(r.query[g]):h.metricsOnly;let x=h.metricsOnly;l&&(x=h.transactionsOnly);const v=p.find((e=>e===f))??x,b=void 0!==a,[P,w]=(0,n.useReducer)(((e,t)=>t),v),C=(0,n.useCallback)((e=>{r&&(s.browserHistory.replace({...r,query:{...r.query,[g]:e}}),w(e))}),[r,w]),[D,_]=(0,n.useReducer)(((e,t)=>t),m.unset),j=b?a:P,S=d&&j===h.auto,Z=d&&j===h.metricsOnly,E=d&&j===h.transactionsOnly,O=`${j}`;return(0,c.tZ)(u,{value:{autoSampleState:D,metricSettingState:j,shouldQueryProvideMEPAutoParams:S,shouldQueryProvideMEPMetricParams:Z,shouldQueryProvideMEPTransactionParams:E,memoizationKey:O,setMetricSettingState:C,setAutoSampleState:_},children:t})};x.displayName="MEPSettingProvider";const v=l},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,r)=>{r.d(t,{bq:()=>s,uL:()=>i});var n=r("./app/utils/performance/contexts/utils.tsx");const[s,o,i]=(0,n.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,r)=>{r.d(t,{n:()=>s}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js");function s(e){const{strict:t=!0,errorMessage:r=`useContext for "${e.name}" must be inside a Provider with a value`,name:s}=e,o=(0,n.createContext)(void 0);return o.displayName=s,[o.Provider,function(){const e=(0,n.useContext)(o);if(!e&&t)throw new Error(r);return e},o]}},"./app/views/performance/index.tsx":(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var n=r("../node_modules/@tanstack/react-query/build/umd/index.production.js"),s=r("./app/components/acl/feature.tsx"),o=r("./app/components/alert.tsx"),i=r("./app/locale.tsx"),a=r("./app/styles/organization.tsx"),c=r("./app/utils/performance/contexts/metricsCardinality.tsx"),u=r("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),l=r("./app/utils/withOrganization.tsx"),d=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const p=new n.QueryClient;function m(e){let{organization:t,location:r,children:l}=e;return(0,d.tZ)(s.Z,{hookName:"feature-disabled:performance-page",features:["performance-view"],organization:t,renderDisabled:function(){return(0,d.tZ)(a.JH,{children:(0,d.tZ)(o.Z,{type:"warning",children:(0,i.t)("You don't have access to this feature")})})},children:(0,d.tZ)(n.QueryClientProvider,{client:p,children:(0,d.tZ)(c.BT,{location:r,organization:t,children:(0,d.tZ)(u.kP,{children:l})})})})}m.displayName="PerformanceContainer";const h=(0,l.Z)(m)}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_index_tsx.209cae0e599ade8072a85f8c2a32a7d3.js.map