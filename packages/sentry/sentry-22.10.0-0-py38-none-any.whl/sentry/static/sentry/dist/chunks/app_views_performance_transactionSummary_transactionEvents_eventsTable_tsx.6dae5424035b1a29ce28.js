"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_transactionSummary_transactionEvents_eventsTable_tsx"],{"./app/utils/discover/discoverQuery.tsx":(e,t,n)=>{n.d(t,{Z:()=>l,_:()=>a});var s=n("./app/utils/discover/genericDiscoverQuery.tsx"),i=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function r(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function o(e){const t=e.useEvents?"events":"eventsv2",n=e.useEvents?(e,t)=>{const{fields:n,...s}=e.meta??{};return{...e,meta:{...n,...s}}}:void 0;return(0,i.tZ)(s.ZP,{route:t,shouldRefetchData:r,afterFetch:n,...e})}function a(e){const t=e.useEvents?"events":"eventsv2",n=e.useEvents?(e,t)=>{const{fields:n,...s}=e.meta??{};return{...e,meta:{...n,...s}}}:void 0;return(0,s.JC)({route:t,shouldRefetchData:r,afterFetch:n,...e})}o.displayName="DiscoverQuery";const l=o},"./app/views/performance/transactionSummary/transactionEvents/eventsTable.tsx":(e,t,n)=>{n.d(t,{Z:()=>F});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/react/index.js")),o=n("../node_modules/react-router/es/index.js"),a=n("./app/api.tsx"),l=n("./app/components/gridEditable/index.tsx"),d=n("./app/components/gridEditable/sortLink.tsx"),c=n("./app/components/links/link.tsx"),p=n("./app/components/pagination.tsx"),m=n("./app/components/questionTooltip.tsx"),u=n("./app/components/tooltip.tsx"),h=n("./app/locale.tsx"),v=n("./app/utils.tsx"),g=n("./app/utils/analytics.tsx"),f=n("./app/utils/discover/discoverQuery.tsx"),x=n("./app/utils/discover/eventView.tsx"),b=n("./app/utils/discover/fieldRenderers.tsx"),y=n("./app/utils/discover/fields.tsx"),Z=n("./app/utils/parseLinkHeader.tsx"),w=n("./app/views/eventsV2/table/cellAction.tsx"),C=n("./app/views/performance/data.tsx"),k=n("./app/views/performance/transactionSummary/utils.tsx"),E=n("../node_modules/react-dom/profiling.js"),S=n("../node_modules/react-popper/lib/esm/Popper.js"),_=n("../node_modules/react-popper/lib/esm/Manager.js"),z=n("../node_modules/react-popper/lib/esm/Reference.js"),O=n("./app/components/menuItem.tsx"),j=n("./app/components/radio.tsx"),M=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class T extends r.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{isOpen:!1}),(0,s.Z)(this,"menuEl",null),(0,s.Z)(this,"handleClickOutside",(e=>{this.menuEl&&e.target instanceof Element&&(this.menuEl.contains(e.target)||this.setState({isOpen:!1}))})),(0,s.Z)(this,"toggleOpen",(()=>{this.setState((e=>{let{isOpen:t}=e;return{isOpen:!t}}))}))}componentDidUpdate(e,t){this.state.isOpen&&!1===t.isOpen&&document.addEventListener("click",this.handleClickOutside,!0),!1===this.state.isOpen&&t.isOpen&&document.removeEventListener("click",this.handleClickOutside,!0)}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside,!0)}generateSortLink(e){const{eventView:t,tableMeta:n,location:s}=this.props;if(!n)return;const i=t.sortOnField(e,n,"desc").generateQueryStringObject();return{...s,query:{...s.query,sort:i.sort}}}renderMenuItem(e,t){const{eventView:n}=this.props;return(0,M.tZ)(A,{children:(0,M.tZ)(D,{children:(0,M.BX)(L,{children:[(0,M.tZ)(H,{readOnly:!0,radioSize:"small",checked:n.sorts.some((t=>{let{field:n}=t;return n===e})),onClick:()=>{const t=this.generateSortLink({field:e});t&&o.browserHistory.push(t)}}),(0,M.tZ)("span",{children:t})]})})})}renderMenuContent(){return(0,M.BX)(I,{children:[this.renderMenuItem("spans.http",(0,h.t)("Sort By HTTP")),this.renderMenuItem("spans.db",(0,h.t)("Sort By DB")),this.renderMenuItem("spans.resource",(0,h.t)("Sort By Resource")),this.renderMenuItem("spans.browser",(0,h.t)("Sort By Browser"))]})}renderMenu(){return(0,E.createPortal)((0,M.tZ)(S.r,{placement:"top",modifiers:[{name:"hide",enabled:!1},{name:"preventOverflow",enabled:!0,options:{padding:10}}],children:e=>{let{ref:t,style:n,placement:s}=e;return(0,M.tZ)(B,{ref:e=>{t(e),this.menuEl=e},style:n,"data-placement":s,children:this.renderMenuContent()})}}),document.body)}render(){const{title:e}=this.props,{isOpen:t}=this.state,n=t?this.renderMenu():null;return(0,M.BX)(_.dK,{children:[(0,M.tZ)(z.s,{children:t=>{let{ref:n}=t;return(0,M.tZ)(N,{ref:n,children:(0,M.tZ)(e,{onClick:this.toggleOpen})})}}),n]})}}T.displayName="OperationSort";const B=(0,i.Z)("div",{target:"e1pnio0z6"})("border:none;border-radius:2px;box-shadow:0 0 0 1px rgba(52, 60, 69, 0.2),0 1px 3px rgba(70, 82, 98, 0.25);background-clip:padding-box;background-color:",(e=>e.theme.background),";width:220px;overflow:visible;z-index:",(e=>e.theme.zIndex.tooltip),";&:before,&:after{width:0;height:0;content:'';display:block;position:absolute;right:auto;}&:before{border-left:9px solid transparent;border-right:9px solid transparent;left:calc(50% - 9px);z-index:-2;}&:after{border-left:8px solid transparent;border-right:8px solid transparent;left:calc(50% - 8px);z-index:-1;}&[data-placement*='bottom']{margin-top:9px;&:before{border-bottom:9px solid ",(e=>e.theme.border),";top:-9px;}&:after{border-bottom:8px solid ",(e=>e.theme.background),";top:-8px;}}&[data-placement*='top']{margin-bottom:9px;&:before{border-top:9px solid ",(e=>e.theme.border),";bottom:-9px;}&:after{border-top:8px solid ",(e=>e.theme.background),";bottom:-8px;}}"),A=(0,i.Z)(O.Z,{target:"e1pnio0z5"})("font-size:",(e=>e.theme.fontSizeMedium),";&:not(:last-child){border-bottom:1px solid ",(e=>e.theme.innerBorder),";}"),D=(0,i.Z)("div",{target:"e1pnio0z4"})({name:"1bxfgt5",styles:"display:flex;flex-direction:row;justify-content:flex-start;align-items:center;width:100%"}),L=(0,i.Z)("label",{target:"e1pnio0z3"})({name:"12ir9nx",styles:"display:grid;cursor:pointer;gap:0.25em 0.5em;grid-template-columns:max-content auto;align-items:center;outline:none;font-weight:normal;margin:0"}),H=(0,i.Z)(j.Z,{target:"e1pnio0z2"})({name:"ti75j2",styles:"margin:0"}),I=(0,i.Z)("div",{target:"e1pnio0z1"})({name:"1okymkx",styles:"max-height:250px;overflow-y:auto"}),N=(0,i.Z)("div",{target:"e1pnio0z0"})({name:"e0dnmk",styles:"cursor:pointer"}),R=T;class V extends r.Component{render(){const{onClick:e}=this.props;return(0,M.BX)("div",{onClick:e,children:[(0,M.tZ)("span",{children:(0,h.t)("operation duration")}),(0,M.tZ)(P,{size:"xs",position:"top",title:(0,h.t)("Span durations are summed over the course of an entire transaction. Any overlapping spans are only counted once.")})]})}}V.displayName="OperationTitle";class q extends r.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{widths:[],lastFetchedCursor:"",attachments:[],hasMinidumps:!0}),(0,s.Z)(this,"api",new a.KU),(0,s.Z)(this,"handleCellAction",(e=>(t,n)=>{const{eventView:s,location:i,organization:r,excludedTags:a}=this.props;(0,g.ec)({eventKey:"performance_views.transactionEvents.cellaction",eventName:"Performance Views: Transaction Events Tab Cell Action Clicked",organization_id:parseInt(r.id,10),action:t});const l=(0,k.xf)(s.query);a&&a.forEach((e=>{l.removeFilter(e)})),(0,w.rh)(l,t,e,n),o.browserHistory.push({pathname:i.pathname,query:{...i.query,cursor:void 0,query:l.formatString()}})})),(0,s.Z)(this,"renderBodyCellWithData",(e=>(t,n)=>this.renderBodyCell(e,t,n))),(0,s.Z)(this,"renderHeadCellWithMeta",(e=>{const t=this.props.columnTitles??C.hj;return(n,s)=>this.renderHeadCell(e,n,t[s])})),(0,s.Z)(this,"handleResizeColumn",((e,t)=>{const n=[...this.state.widths];n[e]=t.width?Number(t.width):l.z7,this.setState({...this.state,widths:n})}))}renderBodyCell(e,t,n){const{eventView:s,organization:i,location:r,transactionName:o}=this.props;if(!e||!e.meta)return n[t.key];const a=e.meta,l=String(t.key),d=(0,b.Js)(l,a)(n,{organization:i,location:r,eventView:s}),p=[w.eX.ADD,w.eX.EXCLUDE,w.eX.SHOW_GREATER_THAN,w.eX.SHOW_LESS_THAN];if(["attachments","minidump"].includes(l))return d;if("id"===l||"trace"===l){const{issueId:e}=this.props;let s={};return e&&"id"===l?s.pathname=`/organizations/${i.slug}/issues/${e}/events/${n.id}/`:s=("id"===l?k.vd:k.Z6)(o)(i,n,r.query),(0,M.tZ)(w.ZP,{column:t,dataRow:n,handleCellAction:this.handleCellAction(t),allowActions:p,children:(0,M.tZ)(c.Z,{to:s,children:d})})}const m=(0,y.LY)(l),h=n[m];return"integer"===a[m]&&(0,v.ri)(h)&&h>999?(0,M.tZ)(u.Z,{title:h.toLocaleString(),containerDisplayMode:"block",position:"right",children:(0,M.tZ)(w.ZP,{column:t,dataRow:n,handleCellAction:this.handleCellAction(t),allowActions:p,children:d})}):(0,M.tZ)(w.ZP,{column:t,dataRow:n,handleCellAction:this.handleCellAction(t),allowActions:p,children:d})}onSortClick(e,t){const{organization:n}=this.props;(0,g.ec)({eventKey:"performance_views.transactionEvents.sort",eventName:"Performance Views: Transaction Events Tab Sorted",organization_id:parseInt(n.id,10),field:t,direction:e})}renderHeadCell(e,t,n){const{eventView:s,location:i}=this.props,r=(0,y.qG)(t.name,t.type,e),o={field:t.name,width:t.width},a=s.sortForField(o,e),l="id"!==o.field&&"trace"!==o.field&&o.field!==y.zD&&(0,x.M3)(o,e),c=a?a.kind:void 0,p=a?a.field:void 0;return o.field===y.zD&&(n=(0,M.tZ)(R,{title:V,eventView:s,tableMeta:e,location:i})),(0,M.tZ)(d.Z,{align:r,title:n||o.field,direction:c,canSort:l,generateSortLink:function(){if(!e)return;const t=s.sortOnField(o,e).generateQueryStringObject();return{...i,query:{...i.query,sort:t.sort}}},onClick:()=>this.onSortClick(c,p)})}render(){const{eventView:e,organization:t,location:n,setError:s,totalEventCount:i}=this.props,o=e.clone();o.sorts=[],o.fields=[{field:"count()",width:-1}];const{widths:a}=this.state,d=e.getColumns().find((e=>e.name===y.zD)),c=e.getColumns().filter((e=>this.state.attachments.length?!!this.state.hasMinidumps||"minidump"!==e.key:"attachments"!==e.key&&"minidump"!==e.key)).filter((e=>!d||!(0,y.yK)(e.name))).map(((e,t)=>"number"==typeof a[t]?{...e,width:a[t]}:e)),m=e=>{let{data:n}=e;if(this.state.attachments.length){const{projectId:e}=this.props,s=this.state.attachments.map((n=>({...n,url:`/api/0/projects/${t.slug}/${e}/events/${n.event_id}/attachments/${n.id}/?download=1`}))),i={};n.forEach((e=>{e.attachments=[],i[e.id]=e})),s.forEach((e=>{const t=i[e.event_id]?.attachments;t&&t.push(e)}))}},u=async(e,t)=>{let{data:n}=e;const s=`event_id=${n.map((e=>e.id)).join("&event_id=")}`,i=await this.api.requestPromise(`/api/0/issues/${this.props.issueId}/attachments/?${s}`);let r=!1;i.forEach((e=>{"event.minidump"===e.type&&(r=!0)})),this.setState({...this.state,lastFetchedCursor:t,attachments:i,hasMinidumps:r})};return(0,M.tZ)("div",{children:(0,M.tZ)(f.Z,{eventView:e,orgSlug:t.slug,location:n,setError:e=>s(e?.message),referrer:"api.performance.transaction-events",useEvents:!0,children:t=>{let{pageLinks:s,isLoading:o,tableData:a}=t;a??={data:[]};const d=(0,Z.Z)(s),v=d?.next?.cursor,g=!!this.props.issueId;let f=v?.split(":")[1]??0;!d?.next?.results&&i&&(f=i);const x=i&&f?(0,h._N)("Showing [currentEvent] of [totalEventCount] events",{currentEvent:f,totalEventCount:i}):void 0;return g&&v&&this.state.lastFetchedCursor!==v&&u(a,v),m(a),(0,M.BX)(r.Fragment,{children:[(0,M.tZ)(l.ZP,{isLoading:o,data:a?.data??[],columnOrder:c,columnSortBy:e.getSorts(),grid:{onResizeColumn:this.handleResizeColumn,renderHeadCell:this.renderHeadCellWithMeta(a?.meta),renderBodyCell:this.renderBodyCellWithData(a)},location:n}),(0,M.tZ)(p.Z,{disabled:o,caption:x,pageLinks:s})]})}})})}}q.displayName="EventsTable";const P=(0,i.Z)(m.Z,{target:"e8p3pb0"})({name:"1dgfen9",styles:"position:relative;top:1px;left:4px"}),F=q}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_transactionSummary_transactionEvents_eventsTable_tsx.f483f9406d8e2536f5c475dcdfd3e9d1.js.map