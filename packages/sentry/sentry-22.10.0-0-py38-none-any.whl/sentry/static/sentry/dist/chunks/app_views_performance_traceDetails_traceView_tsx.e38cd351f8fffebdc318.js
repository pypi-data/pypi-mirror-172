"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_traceDetails_traceView_tsx"],{"./app/utils/discover/discoverQuery.tsx":(e,t,r)=>{r.d(t,{Z:()=>c,_:()=>o});var n=r("./app/utils/discover/genericDiscoverQuery.tsx"),s=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function a(e){const t=e.useEvents?"events":"eventsv2",r=e.useEvents?(e,t)=>{const{fields:r,...n}=e.meta??{};return{...e,meta:{...r,...n}}}:void 0;return(0,s.tZ)(n.ZP,{route:t,shouldRefetchData:i,afterFetch:r,...e})}function o(e){const t=e.useEvents?"events":"eventsv2",r=e.useEvents?(e,t)=>{const{fields:r,...n}=e.meta??{};return{...e,meta:{...r,...n}}}:void 0;return(0,n.JC)({route:t,shouldRefetchData:i,afterFetch:r,...e})}a.displayName="DiscoverQuery";const c=a},"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,r)=>{r.d(t,{AA:()=>f,JC:()=>x,ZP:()=>Z,o:()=>h});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=(r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/react/index.js")),i=r("../node_modules/@tanstack/react-query/build/umd/index.production.js"),a=r("./app/api.tsx"),o=r("./app/locale.tsx"),c=r("./app/utils/discover/eventView.tsx"),l=r("./app/utils/performance/contexts/performanceEventViewContext.tsx"),d=r("./app/views/organizationContext.tsx"),p=r("./app/utils/useApi.tsx"),u=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h{constructor(e,t){(0,n.Z)(this,"message",void 0),(0,n.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class m extends s.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new a.KU}),(0,n.Z)(this,"_shouldRefetchData",(e=>{const t=v(this.props),r=v(e);return!(0,c.ze)(t,r)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,n.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new h(t,e);const r=t?.message;return new h("string"==typeof r?r:(0,o.t)("An unknown error occurred."),e)})),(0,n.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:r,didFetch:n,eventView:s,orgSlug:i,route:a,setError:o}=this.props,{api:c}=this.state;if(!s.isValid())return;const l=`/organizations/${i}/${a}/`,d=Symbol("tableFetchID"),p=v(this.props);this.setState({isLoading:!0,tableFetchID:d}),o?.(void 0),t?.(c),c.clear();try{const[t,,s]=await f(c,l,p,e);if(this.state.tableFetchID!==d)return;const i=r?r(t,this.props):t;n?.(i),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:s?.getResponseHeader("Link")??e.pageLinks,tableData:i})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),o&&o(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),r=!1===e.eventView.isValid()&&this.props.eventView.isValid(),n=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||r||n)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:r,pageLinks:n}=this.state,s={isLoading:e,error:t,tableData:r,pageLinks:n};return(0,this.props.children)?.(s)}}function g(e){const t=(0,s.useContext)(d.g)?.slug,r=(0,s.useContext)(l.uL)?.eventView,n=e.orgSlug??t,i=e.eventView??r;if(void 0===n||void 0===i)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const a={...e,orgSlug:n,eventView:i};return(0,u.tZ)(m,{...a})}function f(e,t,r,n){return n?.batchRequest?n.batchRequest(e,t,{query:r,includeAllArgs:!0}):e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...r}})}function v(e){const{cursor:t,limit:r,noPagination:n,referrer:s,getRequestPayload:i,eventView:a,location:o,forceAppendRawQueryString:c}=e,l=i?i(e):a.getEventsAPIPayload(o,c);return t&&(l.cursor=t),r&&(l.per_page=r),n&&(l.noPagination=n),s&&(l.referrer=s),Object.assign(l,e.queryExtras??{}),l}function x(e){const t=(0,p.Z)(),{orgSlug:r,route:n}=e,s=`/organizations/${r}/${n}/`,a=v(e);return(0,i.useQuery)([n,a],(async()=>{const[r]=await f(t,s,a,e.queryBatching);return r}))}m.displayName="_GenericDiscoverQuery",g.displayName="GenericDiscoverQuery";const Z=g},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,r)=>{r.d(t,{bq:()=>s,uL:()=>a});var n=r("./app/utils/performance/contexts/utils.tsx");const[s,i,a]=(0,n.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,r)=>{r.d(t,{n:()=>s}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js");function s(e){const{strict:t=!0,errorMessage:r=`useContext for "${e.name}" must be inside a Provider with a value`,name:s}=e,i=(0,n.createContext)(void 0);return i.displayName=s,[i.Provider,function(){const e=(0,n.useContext)(i);if(!e&&t)throw new Error(r);return e},i]}},"./app/views/performance/traceDetails/styles.tsx":(e,t,r)=>{r.d(t,{$G:()=>T,CB:()=>m.wh,Iq:()=>f,LA:()=>b,RB:()=>y,W3:()=>Z,X2:()=>m.X2,Z9:()=>x,cC:()=>v,pH:()=>g,qD:()=>m.iF,uI:()=>w});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("./app/components/events/eventTags/eventTagsPill.tsx"),i=r("./app/components/events/interfaces/spans/header.tsx"),a=r("./app/components/panels/index.tsx"),o=r("./app/components/pills.tsx"),c=r("./app/components/searchBar.tsx"),l=r("./app/styles/space.tsx"),d=r("./app/utils.tsx"),p=r("./app/utils/queryString.tsx"),u=r("./app/views/performance/transactionSummary/utils.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js"),m=r("./app/components/events/interfaces/spans/spanDetail.tsx");const g=(0,n.Z)("div",{target:"euzgho58"})({name:"7whenc",styles:"display:flex;width:100%"}),f=(0,n.Z)(c.Z,{target:"euzgho57"})({name:"1ff36h2",styles:"flex-grow:1"}),v=(0,n.Z)(i.il,{target:"euzgho56"})("border-top:none;border-bottom:1px solid ",(e=>e.theme.border),";position:sticky;top:0;z-index:1;"),x=(0,n.Z)("div",{target:"euzgho55"})("display:grid;grid-template-columns:1fr;gap:",(0,l.Z)(3),";margin-bottom:",(0,l.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints.medium),"){grid-template-columns:max-content max-content;grid-row-gap:0;}"),Z=(0,n.Z)("div",{target:"euzgho54"})({name:"13udsys",styles:"height:100%"}),w=(0,n.Z)("div",{target:"euzgho53"})({name:"1wr20zt",styles:"overflow-x:hidden;border-bottom-left-radius:3px;border-bottom-right-radius:3px"}),b=(0,n.Z)(a.s_,{target:"euzgho52"})({name:"1vsyufa",styles:"height:100%;overflow:auto"}),y=(0,n.Z)("span",{target:"euzgho51"})("margin-right:",(0,l.Z)(.75),";display:flex;flex-direction:column;justify-content:center;"),D=(0,n.Z)(o.Z,{target:"euzgho50"})("padding-top:",(0,l.Z)(1.5),";");function T(e){let{location:t,organization:r,transaction:n}=e;const{tags:i}=n;if(!i||i.length<=0)return null;const a=r.slug;return(0,h.BX)("tr",{children:[(0,h.tZ)("td",{className:"key",children:"Tags"}),(0,h.tZ)("td",{className:"value",children:(0,h.tZ)(D,{children:i.map(((e,i)=>{const{pathname:o,query:c}=(0,u.e1)({orgSlug:a,transaction:n.transaction,projectID:String(n.project_id),query:{...t.query,query:(0,p.os)(t.query.query,e.key,e.value)}});return(0,h.tZ)(s.Z,{tag:e,projectId:n.project_slug,organization:r,query:c,streamPath:o},(0,d.ri)(e.key)?e.key:`tag-pill-${i}`)}))})})]})}T.displayName="Tags"},"./app/views/performance/traceDetails/traceNotFound.tsx":(e,t,r)=>{r.d(t,{Z:()=>f});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("../node_modules/react/index.js"),i=r("./app/components/alert.tsx"),a=r("./app/components/links/link.tsx"),o=r("./app/components/loadingError.tsx"),c=r("./app/components/loadingIndicator.tsx"),l=r("./app/components/performance/waterfall/rowDetails.tsx"),d=r("./app/locale.tsx"),p=r("./app/styles/space.tsx"),u=r("./app/utils/discover/discoverQuery.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(e){let{meta:t,traceEventView:r,traceSlug:n,organization:p,location:m}=e;if(0===(t?.transactions??0)&&(t?.errors??0)>0){const e=r.withColumns([{kind:"field",field:"project"},{kind:"field",field:"title"},{kind:"field",field:"issue.id"},{kind:"field",field:"level"}]);return e.query=`trace:${n} !event.type:transaction `,(0,h.tZ)(u.Z,{eventView:e,orgSlug:p.slug,location:m,referrer:"api.trace-view.errors-view",useEvents:!0,children:e=>{let{isLoading:t,tableData:r,error:n}=e;return t?(0,h.tZ)(c.Z,{}):n?(0,h.tZ)(i.Z,{type:"error",showIcon:!0,children:(0,h.tZ)(g,{children:(0,d._N)("The trace cannot be shown when all events are errors. An error occurred when attempting to fetch these error events: [error]",{error:n.message})})}):(0,h.BX)(i.Z,{type:"error",showIcon:!0,children:[(0,h.tZ)(g,{children:(0,d.t)("The trace cannot be shown when all events are errors.")}),(0,h.tZ)(l.TV,{"data-test-id":"trace-view-errors",children:r?.data.map((e=>(0,h.BX)(s.Fragment,{children:[(0,h.tZ)(l._U,{level:e.level}),(0,h.tZ)(l.wE,{children:e.level}),(0,h.tZ)(l.St,{children:(0,h.tZ)(a.Z,{to:`/organizations/${p.slug}/issues/${e["issue.id"]}/events/${e.id}`,children:e.title})})]},e.id)))})]})}})}return(0,h.tZ)(o.Z,{message:(0,d.t)("The trace you are looking for was not found.")})}m.displayName="TraceNotFound";const g=(0,n.Z)("div",{target:"etqb06g0"})("margin-bottom:",(0,p.Z)(1),";"),f=m},"./app/views/performance/traceDetails/traceView.tsx":(e,t,r)=>{r.d(t,{Z:()=>pe});var n=r("../node_modules/react/index.js"),s=r("../node_modules/@sentry/core/esm/hub.js"),i=r("./app/components/events/interfaces/spans/anchorLinkManager.tsx"),a=r("./app/components/events/interfaces/spans/dividerHandlerManager.tsx"),o=r("./app/components/events/interfaces/spans/scrollbarManager.tsx"),c=r("./app/components/performance/waterfall/messageRow.tsx"),l=r("./app/components/performance/waterfall/miniHeader.tsx"),d=r("./app/components/performance/waterfall/utils.tsx"),p=r("./app/locale.tsx"),u=r("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),h=r("./app/views/performance/traceDetails/styles.tsx"),m=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),g=r("./app/components/assistant/guideAnchor.tsx"),f=r("./app/components/count.tsx"),v=r("./app/components/idBadge/projectBadge.tsx"),x=r("./app/components/performance/waterfall/constants.tsx"),Z=r("./app/components/performance/waterfall/row.tsx"),w=r("./app/components/performance/waterfall/rowBar.tsx"),b=r("./app/components/performance/waterfall/rowDivider.tsx"),y=r("./app/components/performance/waterfall/rowTitle.tsx"),D=r("./app/components/performance/waterfall/treeConnector.tsx"),T=r("./app/components/tooltip.tsx"),_=r("./app/utils/performance/quickTrace/utils.tsx"),C=r("./app/utils/projects.tsx"),E=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),j=r("../node_modules/react-router/es/index.js"),S=r("../node_modules/lodash/omit.js"),B=r.n(S),I=r("./app/components/alert.tsx"),V=r("./app/components/button.tsx"),k=r("./app/components/clipboard.tsx"),z=r("./app/components/dateTime.tsx"),O=r("./app/components/events/interfaces/spans/utils.tsx"),A=r("./app/components/links/link.tsx"),$=r("./app/components/performance/waterfall/rowDetails.tsx"),X=r("./app/components/quickTrace/utils.tsx"),L=r("./app/constants/pageFilters.tsx"),R=r("./app/icons/index.tsx"),q=r("./app/styles/space.tsx"),H=r("./app/utils/discover/urls.tsx"),M=r("./app/utils/getDynamicText.tsx"),N=r("./app/utils/performance/urls.ts"),F=r("./app/utils/performance/vitals/constants.tsx"),P=r("./app/utils/performanceForSentry.tsx"),G=r("./app/views/performance/transactionSummary/utils.tsx"),Q=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class U extends n.Component{constructor(){super(...arguments),(0,m.Z)(this,"scrollBarIntoView",(e=>t=>{t.preventDefault();const r=`#txn-${e}`;this.props.scrollToHash(r),j.browserHistory.push({...this.props.location,hash:r})}))}componentDidMount(){const{organization:e,transaction:t}=this.props;(0,u.Z)("performance_views.trace_view.open_transaction_details",{organization:e,operation:t["transaction.op"],transaction:t.transaction})}renderTransactionErrors(){const{organization:e,transaction:t}=this.props,{errors:r}=t;return 0===r.length?null:(0,Q.tZ)(I.Z,{system:!0,type:"error",expand:r.map((t=>(0,Q.BX)($.TV,{children:[(0,Q.tZ)($._U,{level:t.level}),(0,Q.tZ)($.wE,{children:t.level}),(0,Q.tZ)($.St,{children:(0,Q.tZ)(A.Z,{to:(0,X.F7)(t,e),children:t.title})})]},t.event_id))),children:(0,Q.tZ)($.CM,{children:(0,p.tn)("An error event occurred in this transaction.","%s error events occurred in this transaction.",r.length)})})}renderGoToTransactionButton(){const{location:e,organization:t,transaction:r}=this.props,n=(0,H.JE)({id:r.event_id,project:r.project_slug}),s=(0,N.D)(t.slug,n,r.transaction,B()(e.query,Object.values(L.V)));return(0,Q.tZ)(K,{size:"xs",to:s,children:(0,p.t)("View Event")})}renderGoToSummaryButton(){const{location:e,organization:t,transaction:r}=this.props,n=(0,G.e1)({orgSlug:t.slug,transaction:r.transaction,query:B()(e.query,Object.values(L.V)),projectID:String(r.project_id)});return(0,Q.tZ)(K,{size:"xs",to:n,children:(0,p.t)("View Summary")})}renderMeasurements(){const{transaction:e}=this.props,{measurements:t={}}=e,r=Object.keys(t).filter((e=>Boolean(F.r9[`measurements.${e}`]))).sort();return r.length<=0?null:(0,Q.tZ)(n.Fragment,{children:r.map((e=>(0,Q.tZ)(h.X2,{title:F.r9[`measurements.${e}`]?.name,children:`${Number(t[e].value.toFixed(3)).toLocaleString()}ms`},e)))})}renderTransactionDetail(){const{location:e,organization:t,transaction:r}=this.props,s=Math.min(r.start_timestamp,r.timestamp),i=Math.max(r.start_timestamp,r.timestamp),{start:a,end:o}=(0,O.Zv)(s,i),c=`${Number((1e3*(i-s)).toFixed(3)).toLocaleString()}ms`;return(0,Q.tZ)(h.qD,{children:(0,Q.tZ)("table",{className:"table key-value",children:(0,Q.BX)("tbody",{children:[(0,Q.tZ)(h.X2,{title:(0,Q.BX)(J,{onClick:this.scrollBarIntoView(r.event_id),children:[(0,p.t)("Event ID"),(0,Q.tZ)(k.Z,{value:`${window.location.href.replace(window.location.hash,"")}#txn-${r.event_id}`,children:(0,Q.tZ)(W,{})})]}),extra:this.renderGoToTransactionButton(),children:r.event_id}),(0,Q.tZ)(h.X2,{title:"Transaction",extra:this.renderGoToSummaryButton(),children:r.transaction}),(0,Q.tZ)(h.X2,{title:"Transaction Status",children:r["transaction.status"]}),(0,Q.tZ)(h.X2,{title:"Span ID",children:r.span_id}),(0,Q.tZ)(h.X2,{title:"Project",children:r.project_slug}),(0,Q.tZ)(h.X2,{title:"Start Date",children:(0,M.Z)({fixed:"Mar 19, 2021 11:06:27 AM UTC",value:(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(z.Z,{date:1e3*s}),` (${a})`]})})}),(0,Q.tZ)(h.X2,{title:"End Date",children:(0,M.Z)({fixed:"Mar 19, 2021 11:06:28 AM UTC",value:(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(z.Z,{date:1e3*i}),` (${o})`]})})}),(0,Q.tZ)(h.X2,{title:"Duration",children:c}),(0,Q.tZ)(h.X2,{title:"Operation",children:r["transaction.op"]||""}),this.renderMeasurements(),(0,Q.tZ)(h.$G,{location:e,organization:t,transaction:r})]})})})}render(){return(0,Q.tZ)(P.BZ,{id:"TransactionDetail",children:(0,Q.BX)(h.CB,{onClick:e=>{e.stopPropagation()},children:[this.renderTransactionErrors(),this.renderTransactionDetail()]})})}}U.displayName="TransactionDetail";const J=(0,E.Z)("a",{target:"eykqe522"})("display:flex;color:",(e=>e.theme.textColor),";:hover{color:",(e=>e.theme.textColor),";}"),W=(0,E.Z)(R.JH,{target:"eykqe521"})("display:block;color:",(e=>e.theme.gray300),";margin-left:",(0,q.Z)(1),";"),K=(0,E.Z)(V.ZP,{target:"eykqe520"})("position:absolute;top:",(0,q.Z)(.75),";right:",(0,q.Z)(.5),";"),Y=U;class ee extends n.Component{constructor(){super(...arguments),(0,m.Z)(this,"state",{showDetail:!1}),(0,m.Z)(this,"transactionRowDOMRef",(0,n.createRef)()),(0,m.Z)(this,"toggleDisplayDetail",(()=>{const{transaction:e}=this.props;(0,_.Ci)(e)&&this.setState((e=>({showDetail:!e.showDetail})))})),(0,m.Z)(this,"scrollIntoView",(()=>{const e=this.transactionRowDOMRef.current;if(!e)return;const t=e.getBoundingClientRect().top+window.scrollY;this.setState({showDetail:!0},(()=>window.scrollTo(0,t)))}))}getCurrentOffset(){const{transaction:e}=this.props,{generation:t}=e;return te(t)}renderConnector(e){const{continuingDepths:t,isExpanded:r,isOrphan:n,isLast:s,transaction:i}=this.props,{generation:a}=i,o=(0,_.Ci)(i)?i.event_id:i.traceSlug;if(0===a)return e?(0,Q.tZ)(D.UV,{style:{right:"15px",height:"10px",bottom:"-5px",top:"auto"},orphanBranch:!1}):null;const c=t.map((e=>{let{depth:t,isOrphanDepth:r}=e;if(a-t<=1)return null;const n=-1*te(a-t-1)-2;return(0,Q.tZ)(D.UV,{style:{left:n},orphanBranch:r},`${o}-${t}`)}));return e&&r&&c.push((0,Q.tZ)(D.UV,{style:{right:"15px",height:"10px",bottom:s?`-${x.dN/2+1}px`:"0",top:"auto"},orphanBranch:!1},`${o}-last`)),(0,Q.tZ)(D.DN,{isLast:s,hasToggler:e,orphanBranch:n,children:c})}renderToggle(e){const{isExpanded:t,transaction:r,toggleExpandedState:n}=this.props,{children:s,generation:i}=r,a=this.getCurrentOffset();if(s.length<=0)return(0,Q.tZ)(D.rw,{style:{left:`${a}px`},children:this.renderConnector(!1)});const o=0===i;return(0,Q.BX)(D.rw,{style:{left:`${a}px`},hasToggler:!0,children:[this.renderConnector(!0),(0,Q.BX)(D.U1,{disabled:o,isExpanded:t,errored:e,onClick:e=>{e.stopPropagation(),o||n()},children:[(0,Q.tZ)(f.Z,{value:s.length}),!o&&(0,Q.tZ)("div",{children:(0,Q.tZ)(D.jd,{direction:t?"up":"down"})})]})]})}renderTitle(e){const{generateContentSpanBarRef:t}=e,{organization:r,transaction:s}=this.props,i=this.getCurrentOffset(),a=!!(0,_.Ci)(s)&&s.errors.length>0,o=(0,_.Ci)(s)?(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(C.Z,{orgId:r.slug,slugs:[s.project_slug],children:e=>{let{projects:t}=e;const r=t.find((e=>e.slug===s.project_slug));return(0,Q.tZ)(h.RB,{children:(0,Q.tZ)(T.Z,{title:s.project_slug,children:(0,Q.tZ)(v.Z,{project:r||{slug:s.project_slug},avatarSize:16,hideName:!0})})})}}),(0,Q.BX)(y.rv,{errored:a,children:[(0,Q.BX)("strong",{children:[s["transaction.op"]," — "]}),s.transaction]})]}):(0,Q.BX)(y.rv,{errored:!1,children:[(0,Q.tZ)("strong",{children:"Trace — "}),s.traceSlug]});return(0,Q.BX)(y.mw,{ref:t(),children:[this.renderToggle(a),(0,Q.tZ)(y.Wh,{style:{left:`${i}px`,width:"100%"},children:o})]})}renderDivider(e){if(this.state.showDetail)return(0,Q.tZ)(b.xN,{showDetail:!0,style:{position:"absolute"}});const{addDividerLineRef:t}=e;return(0,Q.tZ)(b.xN,{ref:t(),style:{position:"absolute"},onMouseEnter:()=>{e.setHover(!0)},onMouseLeave:()=>{e.setHover(!1)},onMouseOver:()=>{e.setHover(!0)},onMouseDown:e.onDragStart,onClick:e=>{e.stopPropagation()}})}renderGhostDivider(e){const{dividerPosition:t,addGhostDividerLineRef:r}=e;return(0,Q.tZ)(b.Hr,{style:{width:`calc(${(0,d.yI)(t)} + 0.5px)`,display:"none"},children:(0,Q.tZ)(b.xN,{ref:r(),style:{right:0},className:"hovering",onClick:e=>{e.stopPropagation()}})})}renderErrorBadge(){const{transaction:e}=this.props;return(0,_.Ci)(e)&&e.errors.length?(0,Q.tZ)(b.cS,{}):null}renderRectangle(){const{transaction:e,traceInfo:t,barColor:r}=this.props,{showDetail:n}=this.state,s=Math.abs(t.endTimestamp-t.startTimestamp)||1,i=Math.abs(e.start_timestamp-t.startTimestamp)/s,a=Math.abs(e.timestamp-e.start_timestamp),o=a/s;return(0,Q.tZ)(w.e,{style:{backgroundColor:r,left:`min(${(0,d.yI)(i||0)}, calc(100% - 1px))`,width:(0,d.yI)(o||0)},children:(0,Q.tZ)(w.R,{durationDisplay:(0,d.ud)({left:i,width:o}),showDetail:n,children:(0,d.bQ)(a)})})}renderHeader(e){let{dividerHandlerChildrenProps:t,scrollbarManagerChildrenProps:r}=e;const{hasGuideAnchor:n,index:s}=this.props,{showDetail:i}=this.state,{dividerPosition:a}=t;return(0,Q.BX)(Z.Qc,{showDetail:i,children:[(0,Q.tZ)(Z.E5,{"data-test-id":"transaction-row-title","data-type":"span-row-cell",style:{width:`calc(${(0,d.yI)(a)} - 0.5px)`,paddingTop:0},showDetail:i,onClick:this.toggleDisplayDetail,children:(0,Q.tZ)(g.Z,{target:"trace_view_guide_row",disabled:!n,children:this.renderTitle(r)})}),(0,Q.BX)(b.kP,{children:[this.renderDivider(t),this.renderErrorBadge()]}),(0,Q.tZ)(Z.E5,{"data-test-id":"transaction-row-duration","data-type":"span-row-cell",showStriping:s%2!=0,style:{width:`calc(${(0,d.yI)(1-a)} - 0.5px)`,paddingTop:0},showDetail:i,onClick:this.toggleDisplayDetail,children:(0,Q.tZ)(g.Z,{target:"trace_view_guide_row_details",disabled:!n,children:this.renderRectangle()})}),!i&&this.renderGhostDivider(t)]})}renderDetail(){const{location:e,organization:t,isVisible:r,transaction:n}=this.props,{showDetail:s}=this.state;return(0,Q.tZ)(i.$,{children:i=>{let{registerScrollFn:a,scrollToHash:o}=i;return(0,_.Ci)(n)?(a(`#txn-${n.event_id}`,this.scrollIntoView,!1),r&&s?(0,Q.tZ)(Y,{location:e,organization:t,transaction:n,scrollToHash:o}):null):null}})}render(){const{isVisible:e,transaction:t}=this.props,{showDetail:r}=this.state;return(0,Q.BX)(Z.X2,{ref:this.transactionRowDOMRef,visible:e,showBorder:r,cursor:(0,_.Ci)(t)?"pointer":"default",children:[(0,Q.tZ)(o.$6,{children:e=>(0,Q.tZ)(a.$,{children:t=>this.renderHeader({dividerHandlerChildrenProps:t,scrollbarManagerChildrenProps:e})})}),this.renderDetail()]})}}function te(e){return e*(D.Ll/2)+0}ee.displayName="TransactionBar";const re=ee;class ne extends n.Component{constructor(){super(...arguments),(0,m.Z)(this,"state",{isExpanded:!0}),(0,m.Z)(this,"toggleExpandedState",(()=>{this.setState((e=>{let{isExpanded:t}=e;return{isExpanded:!t}}))}))}componentDidUpdate(e,t){t.isExpanded!==this.state.isExpanded&&this.props.updateScrollState()}render(){const{location:e,organization:t,transaction:r,traceInfo:s,continuingDepths:i,isOrphan:a,isLast:o,index:c,isVisible:l,hasGuideAnchor:d,renderedChildren:p,barColor:u}=this.props,{isExpanded:h}=this.state;return(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(re,{location:e,organization:t,index:c,transaction:r,traceInfo:s,continuingDepths:i,isOrphan:a,isLast:o,isExpanded:h,toggleExpandedState:this.toggleExpandedState,isVisible:l,hasGuideAnchor:d,barColor:u}),h&&p]})}}ne.displayName="TransactionGroup";const se=(0,o.Iw)(ne);var ie=r("./app/views/performance/traceDetails/utils.tsx"),ae=r("./app/components/discover/discoverFeature.tsx");function oe(e){let{traceInfo:t,traceEventView:r,organization:n,meta:s}=e;const i=t.transactions.size,a=s?.transactions??i;if(null===a||i>=a)return null;const o=r.getResultsViewUrlTarget(n.slug);return(0,Q.tZ)(c.V,{children:(0,p._N)("Limited to a view of [count] transactions. To view the full list, [discover].",{count:i,discover:(0,Q.tZ)(ae.Z,{children:e=>{let{hasFeature:t}=e;return(0,Q.tZ)(A.Z,{disabled:!t,to:o,children:(0,p.t)("Open in Discover")})}})})})}oe.displayName="LimitExceededMessage";const ce=oe;var le=r("./app/views/performance/traceDetails/traceNotFound.tsx");function de(e){let{isVisible:t,numberOfHiddenTransactionsAbove:r}=e;return!t||r<1?null:(0,Q.tZ)(c.V,{children:(0,Q.tZ)("span",{children:1===r?(0,p._N)("[numOfTransaction] hidden transaction",{numOfTransaction:(0,Q.tZ)("strong",{children:r})}):(0,p._N)("[numOfTransaction] hidden transactions",{numOfTransaction:(0,Q.tZ)("strong",{children:r})})},"trace-info-message")})}function pe(e){let{location:t,meta:r,organization:c,traces:p,traceSlug:m,traceEventView:g,filteredTransactionIds:f,...v}=e;const x=s.Gd().getScope()?.getTransaction(),Z=x?.startChild({op:"trace.render",description:"trace-view-content"});function w(e,r){let{continuingDepths:s,isOrphan:i,isLast:a,index:o,numberOfHiddenTransactionsAbove:l,traceInfo:p,hasGuideAnchor:u}=r;const{children:h,event_id:m}=e,g=e.generation+1,v=function(e,t){return!t||t.has(e.event_id)}(e,f),x=h.reduce(((e,t,r)=>{const n=r===h.length-1,a=t.children.length>0,o=w(t,{continuingDepths:!n&&a?[...s,{depth:g,isOrphanDepth:i}]:s,isOrphan:i,isLast:n,index:e.lastIndex+1,numberOfHiddenTransactionsAbove:e.numberOfHiddenTransactionsAbove,traceInfo:p,hasGuideAnchor:!1});return e.lastIndex=o.lastIndex,e.numberOfHiddenTransactionsAbove=o.numberOfHiddenTransactionsAbove,e.renderedChildren.push(o.transactionGroup),e}),{renderedChildren:[],lastIndex:o,numberOfHiddenTransactionsAbove:v?0:l+1});return{transactionGroup:(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(de,{isVisible:v,numberOfHiddenTransactionsAbove:l}),(0,Q.tZ)(se,{location:t,organization:c,traceInfo:p,transaction:{...e,generation:g},continuingDepths:s,isOrphan:i,isLast:a,index:o,isVisible:v,hasGuideAnchor:u,renderedChildren:x.renderedChildren,barColor:(0,d.hd)(e["transaction.op"])})]},m),lastIndex:x.lastIndex,numberOfHiddenTransactionsAbove:x.numberOfHiddenTransactionsAbove}}(0,n.useEffect)((()=>{(0,u.Z)("performance_views.trace_view.view",{organization:c})}),[c]);const b=(0,n.createRef)(),y=(0,n.createRef)();if(null===p||p.length<=0)return(0,Q.tZ)(le.Z,{meta:r,traceEventView:g,traceSlug:m,location:t,organization:c});const D=v.traceInfo||(0,ie.Rg)(p),T={index:1,numberOfHiddenTransactionsAbove:0,traceInfo:D,transactionGroups:[]},{transactionGroups:_,numberOfHiddenTransactionsAbove:C}=p.reduce(((e,t,r)=>{const n=r===p.length-1,s=t.children.length>0,i=!n&&null!==p[r+1].parent_span_id,a=w(t,{...e,isOrphan:!(0,ie.uM)(t),isLast:n,continuingDepths:!n&&s?[{depth:0,isOrphanDepth:i}]:[],hasGuideAnchor:0===r});return e.index=a.lastIndex+1,e.numberOfHiddenTransactionsAbove=a.numberOfHiddenTransactionsAbove,e.transactionGroups.push(a.transactionGroup),e}),T),E=(0,Q.tZ)(h.W3,{children:(0,Q.tZ)(a.z,{interactiveLayerRef:b,children:(0,Q.tZ)(a.$,{children:e=>{let{dividerPosition:n}=e;return(0,Q.tZ)(o.zt,{dividerPosition:n,interactiveLayerRef:y,children:(0,Q.BX)(h.LA,{children:[(0,Q.BX)(h.cC,{children:[(0,Q.tZ)(o.$6,{children:e=>{let{virtualScrollbarRef:t,scrollBarAreaRef:r,onDragStart:s,onScroll:i}=e;return(0,Q.BX)(l.cs,{ref:y,style:{width:`calc(${(0,d.yI)(n)} - 0.5px)`},onScroll:i,children:[(0,Q.tZ)("div",{style:{width:0,height:"1px"},ref:r}),(0,Q.tZ)(l.Qk,{"data-type":"virtual-scrollbar",ref:t,onMouseDown:s,children:(0,Q.tZ)(l.v6,{})})]})}}),(0,Q.tZ)(l._i,{})]}),(0,Q.BX)(h.uI,{ref:b,children:[(0,Q.tZ)(i.z,{children:(0,Q.tZ)(se,{location:t,organization:c,traceInfo:D,transaction:{traceSlug:m,generation:0,"transaction.duration":D.endTimestamp-D.startTimestamp,children:p,start_timestamp:D.startTimestamp,timestamp:D.endTimestamp},continuingDepths:[],isOrphan:!1,isLast:!1,index:0,isVisible:!0,hasGuideAnchor:!1,renderedChildren:_,barColor:(0,d.hd)("")})}),(0,Q.tZ)(de,{isVisible:!0,numberOfHiddenTransactionsAbove:C}),(0,Q.tZ)(ce,{traceInfo:D,organization:c,traceEventView:g,meta:r})]})]})})}})})});return Z?.finish(),E}de.displayName="TraceHiddenMessage"}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_traceDetails_traceView_tsx.ec476039b99e5cd5d2ebac745c6b0fff.js.map